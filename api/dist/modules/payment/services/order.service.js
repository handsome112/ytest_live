'use strict';const a277_0x147e=['deliveryStatus','decorate','sellerInfo','update','PENDING','1DPSTNj','sellerId','PerformerService','1kmyvcQ','metadata','Injectable','design:paramtypes','EntityNotFoundException','DELIVERY_STATUS','1635734DapVmo','../../../kernel','_id','__metadata','Inject','CREATED','20901cdFijC','1113913bcAtuD','getDetails','userService','buyerId','ORDER_MODEL_PROVIDER','function','mongoose','queueEventService','tokens','tokenService','996658OopVrn','TOKEN','784578FtRrmx','object','performerService','../../performer/services','price','../constants','879738jZlOLt','findByIds','OrderDto','../../user/services','user','@nestjs/common','\x20tokens','QueueEventService','forwardRef','defineProperty','UPDATED','findById','length','Order','__param','buyerInfo','username','PRODUCT_TYPE','1dBynDD','__esModule','TokenPackageService','shippingCode','name','UserService','toObject','save','sellerSource','OrderService','ORDER_UPDATE_CHANNEL','../dtos','map','system','729815kbOTDd','PAYMENT_STATUS','createTokenOrderFromPayload','getOwnPropertyDescriptor'];const a277_0x24a603=a277_0x1574;(function(_0x4b1cb4,_0x268c5c){const _0x2c95f6=a277_0x1574;while(!![]){try{const _0x1dfb8a=parseInt(_0x2c95f6(0x154))+-parseInt(_0x2c95f6(0x188))*parseInt(_0x2c95f6(0x194))+-parseInt(_0x2c95f6(0x15c))+-parseInt(_0x2c95f6(0x156))+parseInt(_0x2c95f6(0x17c))+-parseInt(_0x2c95f6(0x195))*parseInt(_0x2c95f6(0x16e))+-parseInt(_0x2c95f6(0x185))*-parseInt(_0x2c95f6(0x18e));if(_0x1dfb8a===_0x268c5c)break;else _0x4b1cb4['push'](_0x4b1cb4['shift']());}catch(_0xd10cf7){_0x4b1cb4['push'](_0x4b1cb4['shift']());}}}(a277_0x147e,0x89785));var __decorate=this&&this['__decorate']||function(_0x3bd3e8,_0x2dcdc2,_0x2640d6,_0x4f351c){const _0x25a6cf=a277_0x1574;var _0x417b34=arguments[_0x25a6cf(0x168)],_0xd3166d=_0x417b34<0x3?_0x2dcdc2:_0x4f351c===null?_0x4f351c=Object[_0x25a6cf(0x17f)](_0x2dcdc2,_0x2640d6):_0x4f351c,_0x6afca5;if(typeof Reflect===_0x25a6cf(0x157)&&typeof Reflect['decorate']===_0x25a6cf(0x14f))_0xd3166d=Reflect[_0x25a6cf(0x181)](_0x3bd3e8,_0x2dcdc2,_0x2640d6,_0x4f351c);else{for(var _0x4f2878=_0x3bd3e8['length']-0x1;_0x4f2878>=0x0;_0x4f2878--)if(_0x6afca5=_0x3bd3e8[_0x4f2878])_0xd3166d=(_0x417b34<0x3?_0x6afca5(_0xd3166d):_0x417b34>0x3?_0x6afca5(_0x2dcdc2,_0x2640d6,_0xd3166d):_0x6afca5(_0x2dcdc2,_0x2640d6))||_0xd3166d;}return _0x417b34>0x3&&_0xd3166d&&Object[_0x25a6cf(0x165)](_0x2dcdc2,_0x2640d6,_0xd3166d),_0xd3166d;},__metadata=this&&this[a277_0x24a603(0x191)]||function(_0x3ebe4b,_0x42472f){const _0x11e502=a277_0x24a603;if(typeof Reflect===_0x11e502(0x157)&&typeof Reflect[_0x11e502(0x189)]==='function')return Reflect[_0x11e502(0x189)](_0x3ebe4b,_0x42472f);},__param=this&&this[a277_0x24a603(0x16a)]||function(_0x54c2a9,_0x42919f){return function(_0x53c8e3,_0x3688e1){_0x42919f(_0x53c8e3,_0x3688e1,_0x54c2a9);};};function a277_0x1574(_0x1a0aa1,_0x3d2bb7){return a277_0x1574=function(_0x147e5a,_0x157412){_0x147e5a=_0x147e5a-0x14e;let _0x34f056=a277_0x147e[_0x147e5a];return _0x34f056;},a277_0x1574(_0x1a0aa1,_0x3d2bb7);}Object[a277_0x24a603(0x165)](exports,a277_0x24a603(0x16f),{'value':!![]}),exports[a277_0x24a603(0x177)]=void 0x0;const common_1=require(a277_0x24a603(0x161)),dtos_1=require('../../user/dtos'),kernel_1=require(a277_0x24a603(0x18f)),mongoose_1=require(a277_0x24a603(0x150)),services_1=require('../../token-package/services'),services_2=require(a277_0x24a603(0x159)),services_3=require(a277_0x24a603(0x15f)),constants_1=require('../../../kernel/constants'),providers_1=require('../providers'),constants_2=require(a277_0x24a603(0x15b)),dtos_2=require(a277_0x24a603(0x179));let OrderService=class OrderService{constructor(_0x1eaabe,_0x1fd33b,_0x1b439d,_0x7af235,_0x40b98b){const _0x320547=a277_0x24a603;this[_0x320547(0x169)]=_0x1eaabe,this[_0x320547(0x153)]=_0x1fd33b,this['performerService']=_0x1b439d,this[_0x320547(0x197)]=_0x7af235,this[_0x320547(0x151)]=_0x40b98b;}async[a277_0x24a603(0x17e)](_0x268533,_0x243243,_0x483d2e=constants_2['ORDER_STATUS'][a277_0x24a603(0x193)]){const _0x1232c8=a277_0x24a603,_0x146b18=await this[_0x1232c8(0x153)]['findById'](_0x268533);if(!_0x146b18)throw new kernel_1[(_0x1232c8(0x18c))]();const _0x48be03='TP'+new Date()['getTime'](),_0x19895f=new this[(_0x1232c8(0x169))]({'orderNumber':_0x48be03,'buyerId':_0x243243[_0x1232c8(0x190)],'buyerSource':_0x1232c8(0x160),'sellerId':null,'sellerSource':_0x1232c8(0x17b),'type':constants_2[_0x1232c8(0x16d)][_0x1232c8(0x155)],'productType':constants_2[_0x1232c8(0x16d)][_0x1232c8(0x155)],'productId':_0x146b18[_0x1232c8(0x190)],'name':_0x146b18[_0x1232c8(0x172)],'description':_0x146b18[_0x1232c8(0x15a)]['toFixed'](0x2)+'\x20for\x20'+_0x146b18[_0x1232c8(0x152)]+_0x1232c8(0x162),'unitPrice':_0x146b18[_0x1232c8(0x15a)],'quantity':0x1,'originalPrice':_0x146b18[_0x1232c8(0x15a)],'totalPrice':_0x146b18[_0x1232c8(0x15a)],'status':_0x483d2e,'deliveryStatus':constants_2[_0x1232c8(0x18d)]['CREATED'],'deliveryAddress':'','paymentStatus':constants_2[_0x1232c8(0x17d)][_0x1232c8(0x184)],'payBy':'money','couponInfo':null,'shippingCode':null,'extraInfo':null});return _0x19895f[_0x1232c8(0x175)]();}async[a277_0x24a603(0x167)](_0xb63dc2){const _0x2de9c1=a277_0x24a603,_0x3cef6d=await this[_0x2de9c1(0x169)][_0x2de9c1(0x167)](_0xb63dc2);return _0x3cef6d?new dtos_2[(_0x2de9c1(0x15e))](_0x3cef6d[_0x2de9c1(0x174)]()):null;}async[a277_0x24a603(0x15d)](_0x2141b1){const _0x1ccc9c=a277_0x24a603,_0x4361ed=await this['Order']['find']({'_id':{'$in':_0x2141b1}});return _0x4361ed[_0x1ccc9c(0x17a)](_0x4f8bed=>new dtos_2[(_0x1ccc9c(0x15e))](_0x4f8bed));}async[a277_0x24a603(0x196)](_0x398bf1){const _0x26cfc1=a277_0x24a603,_0x2edea4=_0x398bf1 instanceof dtos_2[_0x26cfc1(0x15e)]?_0x398bf1:await this[_0x26cfc1(0x167)](_0x398bf1);if(!_0x2edea4)throw new kernel_1['EntityNotFoundException']();if(_0x2edea4[_0x26cfc1(0x176)]==='performer'){const _0x4db434=await this[_0x26cfc1(0x158)][_0x26cfc1(0x167)](_0x2edea4[_0x26cfc1(0x186)]);_0x2edea4[_0x26cfc1(0x182)]=_0x4db434===null||_0x4db434===void 0x0?void 0x0:_0x4db434['toResponse']();}const _0x39cb63=await this[_0x26cfc1(0x197)][_0x26cfc1(0x167)](_0x2edea4[_0x26cfc1(0x198)]);return _0x2edea4[_0x26cfc1(0x16b)]={'_id':_0x39cb63[_0x26cfc1(0x190)],'username':_0x39cb63[_0x26cfc1(0x16c)]},_0x2edea4;}async[a277_0x24a603(0x183)](_0x51fdc5,_0x250b9b){const _0x3f256e=a277_0x24a603,_0x4fee89=await this[_0x3f256e(0x169)][_0x3f256e(0x167)](_0x51fdc5),_0x15753b=_0x4fee89['deliveryStatus'];if(_0x250b9b[_0x3f256e(0x180)])_0x4fee89[_0x3f256e(0x180)]=_0x250b9b[_0x3f256e(0x180)];if(_0x250b9b[_0x3f256e(0x171)])_0x4fee89['shippingCode']=_0x250b9b[_0x3f256e(0x171)];return await _0x4fee89[_0x3f256e(0x175)](),await this[_0x3f256e(0x151)]['publish'](new kernel_1['QueueEvent']({'channel':constants_2[_0x3f256e(0x178)],'eventName':constants_1['EVENT'][_0x3f256e(0x166)],'data':{'oldValue':{'deliveryStatus':_0x15753b},'newValue':new dtos_2[(_0x3f256e(0x15e))](_0x4fee89)}})),_0x4fee89;}};OrderService=__decorate([common_1[a277_0x24a603(0x18a)](),__param(0x0,common_1['Inject'](providers_1[a277_0x24a603(0x14e)])),__param(0x1,common_1['Inject'](common_1[a277_0x24a603(0x164)](()=>services_1['TokenPackageService']))),__param(0x2,common_1['Inject'](common_1['forwardRef'](()=>services_2[a277_0x24a603(0x187)]))),__param(0x3,common_1[a277_0x24a603(0x192)](common_1['forwardRef'](()=>services_3['UserService']))),__metadata(a277_0x24a603(0x18b),[mongoose_1['Model'],services_1[a277_0x24a603(0x170)],services_2[a277_0x24a603(0x187)],services_3[a277_0x24a603(0x173)],kernel_1[a277_0x24a603(0x163)]])],OrderService),exports['OrderService']=OrderService;