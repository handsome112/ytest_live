'use strict';const a97_0x1557=['getOwnPropertyDescriptor','forgot','3oSWbDB','send','email','UserDto','findOne','19Qgxpqx','176089MbKLuL','PerformerService','metadata','env','_id','studioService','120681vcZzoZ','../exceptions','config','expiresIn','studio','userService','decode','26835vXzCQm','verify','../../user/dtos','value','220667MzHAlW','crypto','defineProperty','decodeJWT','app.baseUrl','generateJWT','source','payload','UserService','set','Model','AUTH_MODEL_PROVIDER','findBySource','__param','../../../kernel','save','ForgotModel','findById','performerService','../../performer/dtos','randomString','AuthService','mailService','generateSalt','type','changeNewKey','getSourceFromJWT','Injectable','__decorate','AuthModel','length','getForgot','sign','AuthErrorException','base64','StringHelper','isPerformer','user','../../performer/services','sourceId','encryptPassword','StudioDto','get','find','12149ZZvyIy','FORGOT_MODEL_PROVIDER','object','sha1','includes','all','function','username','../../studio/services','Inject','toString','../../studio/dtos','pbkdf2Sync','MailerService','href','salt','decorate','PerformerDto','64717TlWrqa','1nptYdo','design:paramtypes','10159BnxwXB','create','mongoose','StudioService','key','../providers/auth.provider','randomBytes'];const a97_0x338632=a97_0x4313;(function(_0x25e40b,_0x1edc1b){const _0x5522e3=a97_0x4313;while(!![]){try{const _0x48776c=parseInt(_0x5522e3(0x1f2))*-parseInt(_0x5522e3(0x200))+parseInt(_0x5522e3(0x20e))*parseInt(_0x5522e3(0x1f0))+parseInt(_0x5522e3(0x1ef))+-parseInt(_0x5522e3(0x201))+parseInt(_0x5522e3(0x207))+parseInt(_0x5522e3(0x1dd))*parseInt(_0x5522e3(0x1fb))+parseInt(_0x5522e3(0x212));if(_0x48776c===_0x1edc1b)break;else _0x25e40b['push'](_0x25e40b['shift']());}catch(_0xe14866){_0x25e40b['push'](_0x25e40b['shift']());}}}(a97_0x1557,0x1878d));function a97_0x4313(_0x2b8535,_0x8ea08a){return a97_0x4313=function(_0x15573f,_0x43138a){_0x15573f=_0x15573f-0x1bf;let _0x5a780e=a97_0x1557[_0x15573f];return _0x5a780e;},a97_0x4313(_0x2b8535,_0x8ea08a);}var __decorate=this&&this[a97_0x338632(0x1cd)]||function(_0x55d02d,_0x45b40d,_0x83adb8,_0xe7de7c){const _0x332572=a97_0x338632;var _0x5eb4aa=arguments[_0x332572(0x1cf)],_0x304938=_0x5eb4aa<0x3?_0x45b40d:_0xe7de7c===null?_0xe7de7c=Object[_0x332572(0x1f9)](_0x45b40d,_0x83adb8):_0xe7de7c,_0x3ce048;if(typeof Reflect===_0x332572(0x1df)&&typeof Reflect['decorate']===_0x332572(0x1e3))_0x304938=Reflect[_0x332572(0x1ed)](_0x55d02d,_0x45b40d,_0x83adb8,_0xe7de7c);else{for(var _0x47dd97=_0x55d02d['length']-0x1;_0x47dd97>=0x0;_0x47dd97--)if(_0x3ce048=_0x55d02d[_0x47dd97])_0x304938=(_0x5eb4aa<0x3?_0x3ce048(_0x304938):_0x5eb4aa>0x3?_0x3ce048(_0x45b40d,_0x83adb8,_0x304938):_0x3ce048(_0x45b40d,_0x83adb8))||_0x304938;}return _0x5eb4aa>0x3&&_0x304938&&Object[_0x332572(0x214)](_0x45b40d,_0x83adb8,_0x304938),_0x304938;},__metadata=this&&this['__metadata']||function(_0x2c4e54,_0x3edfdb){const _0x150e33=a97_0x338632;if(typeof Reflect===_0x150e33(0x1df)&&typeof Reflect[_0x150e33(0x203)]===_0x150e33(0x1e3))return Reflect[_0x150e33(0x203)](_0x2c4e54,_0x3edfdb);},__param=this&&this[a97_0x338632(0x21f)]||function(_0x8b37b0,_0x4ad349){return function(_0x32e6e4,_0x551ca0){_0x4ad349(_0x32e6e4,_0x551ca0,_0x8b37b0);};};Object[a97_0x338632(0x214)](exports,'__esModule',{'value':!![]}),exports[a97_0x338632(0x1c6)]=void 0x0;const common_1=require('@nestjs/common'),crypto=require(a97_0x338632(0x213)),jwt=require('jsonwebtoken'),mongoose_1=require(a97_0x338632(0x1f4)),dtos_1=require(a97_0x338632(0x210)),dtos_2=require(a97_0x338632(0x1c4)),services_1=require('../../user/services'),services_2=require(a97_0x338632(0x1d7)),kernel_1=require(a97_0x338632(0x1bf)),mailer_1=require('../../mailer'),nestjs_config_1=require('nestjs-config'),services_3=require(a97_0x338632(0x1e5)),dtos_3=require(a97_0x338632(0x1e8)),exceptions_1=require(a97_0x338632(0x208)),auth_provider_1=require(a97_0x338632(0x1f7));let AuthService=class AuthService{constructor(_0x98a6a4,_0x3abf4a,_0xb1a355,_0x30dcfa,_0x37ef79,_0x32d3c4,_0x46fc23){const _0x482340=a97_0x338632;this[_0x482340(0x1ce)]=_0x98a6a4,this[_0x482340(0x1c1)]=_0x3abf4a,this[_0x482340(0x20c)]=_0xb1a355,this[_0x482340(0x1c3)]=_0x30dcfa,this[_0x482340(0x1c7)]=_0x37ef79,this[_0x482340(0x209)]=_0x32d3c4,this[_0x482340(0x206)]=_0x46fc23;}[a97_0x338632(0x1c8)](_0x57089f=0x10){const _0x1c3e36=a97_0x338632;return crypto[_0x1c3e36(0x1f8)](_0x57089f)['toString']('base64');}[a97_0x338632(0x1d9)](_0x42c03a,_0x4c0ef0){const _0x319a8a=a97_0x338632,_0x3afc59=0x2710,_0x453ca6=0x40;return crypto[_0x319a8a(0x1e9)](_0x42c03a,_0x4c0ef0,_0x3afc59,_0x453ca6,_0x319a8a(0x1e0))[_0x319a8a(0x1e7)](_0x319a8a(0x1d3));}async[a97_0x338632(0x1f3)](_0x37f309){const _0x18160a=a97_0x338632,_0x28d6f6=this[_0x18160a(0x1c8)]();let _0x2e94f9=_0x37f309[_0x18160a(0x211)];['email',_0x18160a(0x1e4)][_0x18160a(0x1e1)](_0x37f309[_0x18160a(0x1c9)])&&_0x2e94f9&&(_0x2e94f9=this[_0x18160a(0x1d9)](_0x2e94f9,_0x28d6f6));let _0x4cda2f=await this[_0x18160a(0x1ce)][_0x18160a(0x1ff)]({'type':_0x37f309[_0x18160a(0x1c9)],'source':_0x37f309[_0x18160a(0x218)],'sourceId':_0x37f309[_0x18160a(0x1d8)]});return!_0x4cda2f&&(_0x4cda2f=new this[(_0x18160a(0x1ce))]({'type':_0x37f309[_0x18160a(0x1c9)],'source':_0x37f309[_0x18160a(0x218)],'sourceId':_0x37f309[_0x18160a(0x1d8)]})),_0x4cda2f[_0x18160a(0x1ec)]=_0x28d6f6,_0x4cda2f[_0x18160a(0x211)]=_0x2e94f9,_0x4cda2f[_0x18160a(0x1f6)]=_0x37f309[_0x18160a(0x1f6)],_0x4cda2f[_0x18160a(0x1c0)]();}async[a97_0x338632(0x1ca)](_0x7f3fda,_0x63b329,_0x1bc7fb){const _0x559d2c=a97_0x338632,_0x292c99=await this['AuthModel'][_0x559d2c(0x1ff)]({'type':_0x63b329,'sourceId':_0x7f3fda});if(!_0x292c99)return null;return _0x292c99[_0x559d2c(0x1f6)]=_0x1bc7fb,_0x292c99[_0x559d2c(0x1c0)]();}async['update'](_0x2562b3){const _0x241a2e=a97_0x338632,_0x53e167=await this[_0x241a2e(0x1ce)][_0x241a2e(0x1dc)]({'source':_0x2562b3[_0x241a2e(0x218)],'sourceId':_0x2562b3[_0x241a2e(0x1d8)]});let _0x1a000e;switch(_0x2562b3[_0x241a2e(0x218)]){case _0x241a2e(0x1d6):_0x1a000e=await this[_0x241a2e(0x20c)][_0x241a2e(0x1c2)](_0x2562b3[_0x241a2e(0x1d8)]);break;case _0x241a2e(0x20b):_0x1a000e=await this['studioService']['findById'](_0x2562b3['sourceId']);break;case'performer':_0x1a000e=await this[_0x241a2e(0x1c3)][_0x241a2e(0x1c2)](_0x2562b3[_0x241a2e(0x1d8)]);break;default:break;}if(!_0x1a000e)throw new kernel_1['EntityNotFoundException']();const _0x4f09c1=_0x53e167[_0x241a2e(0x1dc)](_0x56ae82=>_0x56ae82[_0x241a2e(0x1c9)]===_0x241a2e(0x1fd));!_0x4f09c1&&_0x1a000e[_0x241a2e(0x1fd)]&&await this[_0x241a2e(0x1f3)]({'source':_0x2562b3['source'],'sourceId':_0x2562b3[_0x241a2e(0x1d8)],'type':_0x241a2e(0x1fd),'key':_0x1a000e['email'],'value':_0x2562b3[_0x241a2e(0x211)]});const _0x55dfb7=_0x53e167[_0x241a2e(0x1dc)](_0x32df89=>_0x32df89[_0x241a2e(0x1c9)]===_0x241a2e(0x1e4));return!_0x55dfb7&&_0x1a000e[_0x241a2e(0x1e4)]&&await this[_0x241a2e(0x1f3)]({'source':_0x2562b3[_0x241a2e(0x218)],'sourceId':_0x2562b3[_0x241a2e(0x1d8)],'type':'username','key':_0x1a000e[_0x241a2e(0x1e4)],'value':_0x2562b3[_0x241a2e(0x211)]}),await Promise[_0x241a2e(0x1e2)](_0x53e167['map'](_0x1ed4fe=>{const _0x5d494c=_0x241a2e;let _0x3bffaf=_0x2562b3[_0x5d494c(0x211)];const _0x73c2ee=this[_0x5d494c(0x1c8)]();return _0x3bffaf=this[_0x5d494c(0x1d9)](_0x2562b3[_0x5d494c(0x211)],_0x73c2ee),_0x1ed4fe[_0x5d494c(0x21b)]('salt',_0x73c2ee),_0x1ed4fe[_0x5d494c(0x21b)](_0x5d494c(0x211),_0x3bffaf),_0x1ed4fe[_0x5d494c(0x1c0)]();})),!![];}async[a97_0x338632(0x21e)](_0x1c9f3a){const _0x19fba8=a97_0x338632;return this[_0x19fba8(0x1ce)][_0x19fba8(0x1ff)](_0x1c9f3a);}['verifyPassword'](_0x25b41e,_0x4b7772){const _0x2d8e3c=a97_0x338632;return this[_0x2d8e3c(0x1d9)](_0x25b41e,_0x4b7772[_0x2d8e3c(0x1ec)])===_0x4b7772[_0x2d8e3c(0x211)];}[a97_0x338632(0x217)](_0x5530dc,_0x3195a1={}){const _0x2e9f69=a97_0x338632,_0x490c8d=Object['assign']({'expiresIn':0x3c*0x3c*0x18},_0x3195a1||{});return jwt[_0x2e9f69(0x1d1)]({'authId':_0x5530dc[_0x2e9f69(0x205)],'source':_0x5530dc[_0x2e9f69(0x218)],'sourceId':_0x5530dc[_0x2e9f69(0x1d8)]},process[_0x2e9f69(0x204)]['TOKEN_SECRET'],{'expiresIn':_0x490c8d[_0x2e9f69(0x20a)]});}['verifyJWT'](_0x2f7471){const _0x381e6f=a97_0x338632;try{return jwt[_0x381e6f(0x20f)](_0x2f7471,process[_0x381e6f(0x204)]['TOKEN_SECRET']);}catch(_0x4a7fca){return![];}}[a97_0x338632(0x215)](_0x33dd99){const _0x505a0b=a97_0x338632;try{const _0x448748=jwt[_0x505a0b(0x20d)](_0x33dd99,{'complete':!![]});return _0x448748[_0x505a0b(0x219)];}catch(_0x168851){return![];}}async[a97_0x338632(0x1cb)](_0x5ca1a1){const _0x11cbc1=a97_0x338632,_0x14fc34=this['verifyJWT'](_0x5ca1a1);if(!_0x14fc34)throw new exceptions_1[(_0x11cbc1(0x1d2))]();if(_0x14fc34[_0x11cbc1(0x218)]==='user'){const _0x24f31e=await this[_0x11cbc1(0x20c)]['findById'](_0x14fc34[_0x11cbc1(0x1d8)]);return new dtos_1[(_0x11cbc1(0x1fe))](_0x24f31e);}if(_0x14fc34['source']==='performer'){const _0x248f48=await this['performerService'][_0x11cbc1(0x1c2)](_0x14fc34['sourceId']);return _0x248f48&&(_0x248f48[_0x11cbc1(0x1d5)]=!![]),new dtos_2[(_0x11cbc1(0x1ee))](_0x248f48);}if(_0x14fc34[_0x11cbc1(0x218)]===_0x11cbc1(0x20b)){const _0x2b685d=await this[_0x11cbc1(0x206)][_0x11cbc1(0x1c2)](_0x14fc34[_0x11cbc1(0x1d8)]);return new dtos_3[(_0x11cbc1(0x1da))](_0x2b685d);}return null;}async[a97_0x338632(0x1fa)](_0x180619,_0x2cdd61){const _0x3d7d08=a97_0x338632,_0x387638=kernel_1[_0x3d7d08(0x1d4)][_0x3d7d08(0x1c5)](0xe);await this[_0x3d7d08(0x1c1)]['create']({'token':_0x387638,'source':_0x180619[_0x3d7d08(0x218)],'sourceId':_0x2cdd61[_0x3d7d08(0x205)],'authId':_0x180619[_0x3d7d08(0x205)],'createdAt':new Date(),'updatedAt':new Date()});const _0x1092f7=new URL('auth/password-change?token='+_0x387638,this['config'][_0x3d7d08(0x1db)](_0x3d7d08(0x216)))[_0x3d7d08(0x1eb)];return await this[_0x3d7d08(0x1c7)][_0x3d7d08(0x1fc)]({'subject':'Recover\x20password','to':_0x2cdd61[_0x3d7d08(0x1fd)],'data':{'forgotLink':_0x1092f7},'template':_0x3d7d08(0x1fa)}),!![];}async[a97_0x338632(0x1d0)](_0x107f32){const _0x34370d=a97_0x338632;return this[_0x34370d(0x1c1)][_0x34370d(0x1ff)]({'token':_0x107f32});}};AuthService=__decorate([common_1[a97_0x338632(0x1cc)](),__param(0x0,common_1['Inject'](auth_provider_1[a97_0x338632(0x21d)])),__param(0x1,common_1[a97_0x338632(0x1e6)](auth_provider_1[a97_0x338632(0x1de)])),__metadata(a97_0x338632(0x1f1),[mongoose_1[a97_0x338632(0x21c)],mongoose_1[a97_0x338632(0x21c)],services_1[a97_0x338632(0x21a)],services_2[a97_0x338632(0x202)],mailer_1[a97_0x338632(0x1ea)],nestjs_config_1['ConfigService'],services_3[a97_0x338632(0x1f5)]])],AuthService),exports[a97_0x338632(0x1c6)]=AuthService;