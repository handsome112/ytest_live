'use strict';const a52_0x3892=['3051CtpVxV','Res','userService','UseGuards','AccountNotFoundxception','Get','getOwnPropertyDescriptor','../../performer/services','type','1177735UNaiWU','performerService','../../../kernel','Body','defineProperty','../services','@nestjs/common','metadata','findByEmail','PasswordController','password','AuthUpdateDto','day','length','update','verifyPassword','../payloads','user','../../user/services','email','CurrentUser','PasswordChangePayload','users/password','source','token','studio','Put','HttpCode','../../studio/services','prePassword','89OeqgnP','AuthService','password-change','studioService','Query','function','remove','_id','password-change.html','../decorators','2ujRwye','802151KUYmUD','userId','Roles','../guards','object','updatePassword','render','auth','633937myxKbq','moment','getForgot','8182pyzjAH','DataResponse','EmailOrPasswordIncorrectException','renderUpdatePassword','../../user/dtos','404.html','__esModule','admin','PerformerService','Post','prototype','605DFeNeg','UserDto','441iQIWbn','performer','PasswordUserChangePayload','design:returntype','authService','StudioService','add','users/forgot','3HWzUft','__decorate','../exceptions','design:type','Controller','users/me/password','design:paramtypes','updatePasswordForm','createdAt','RoleGuard','updateUserPassword','sourceId','decorate','HttpStatus','findBySource','forgot','373eoWmuR','2161sdcypO','isAfter','ForgotPayload','1wXldSh'];function a52_0x43ba(_0x596e35,_0x1f4cd9){return a52_0x43ba=function(_0x3892a5,_0x43bac3){_0x3892a5=_0x3892a5-0x1f3;let _0x125776=a52_0x3892[_0x3892a5];return _0x125776;},a52_0x43ba(_0x596e35,_0x1f4cd9);}const a52_0x2cccb8=a52_0x43ba;(function(_0x23c7e8,_0x3999f6){const _0x5f511f=a52_0x43ba;while(!![]){try{const _0x950f27=-parseInt(_0x5f511f(0x20d))*parseInt(_0x5f511f(0x1f7))+-parseInt(_0x5f511f(0x222))*parseInt(_0x5f511f(0x233))+-parseInt(_0x5f511f(0x21a))*-parseInt(_0x5f511f(0x218))+-parseInt(_0x5f511f(0x237))*parseInt(_0x5f511f(0x232))+-parseInt(_0x5f511f(0x202))+parseInt(_0x5f511f(0x20a))*parseInt(_0x5f511f(0x236))+parseInt(_0x5f511f(0x240))*parseInt(_0x5f511f(0x201));if(_0x950f27===_0x3999f6)break;else _0x23c7e8['push'](_0x23c7e8['shift']());}catch(_0x2d370b){_0x23c7e8['push'](_0x23c7e8['shift']());}}}(a52_0x3892,0x8deed));var __decorate=this&&this[a52_0x2cccb8(0x223)]||function(_0x3f12a4,_0x19e2a5,_0x45b827,_0x296f32){const _0x55231d=a52_0x2cccb8;var _0x2a2ecc=arguments[_0x55231d(0x24d)],_0x4bedb2=_0x2a2ecc<0x3?_0x19e2a5:_0x296f32===null?_0x296f32=Object[_0x55231d(0x23d)](_0x19e2a5,_0x45b827):_0x296f32,_0x4b8fab;if(typeof Reflect===_0x55231d(0x206)&&typeof Reflect[_0x55231d(0x22e)]===_0x55231d(0x1fc))_0x4bedb2=Reflect[_0x55231d(0x22e)](_0x3f12a4,_0x19e2a5,_0x45b827,_0x296f32);else{for(var _0xe6de6a=_0x3f12a4['length']-0x1;_0xe6de6a>=0x0;_0xe6de6a--)if(_0x4b8fab=_0x3f12a4[_0xe6de6a])_0x4bedb2=(_0x2a2ecc<0x3?_0x4b8fab(_0x4bedb2):_0x2a2ecc>0x3?_0x4b8fab(_0x19e2a5,_0x45b827,_0x4bedb2):_0x4b8fab(_0x19e2a5,_0x45b827))||_0x4bedb2;}return _0x2a2ecc>0x3&&_0x4bedb2&&Object[_0x55231d(0x244)](_0x19e2a5,_0x45b827,_0x4bedb2),_0x4bedb2;},__metadata=this&&this['__metadata']||function(_0x362bec,_0x12b025){const _0x1ede95=a52_0x2cccb8;if(typeof Reflect===_0x1ede95(0x206)&&typeof Reflect['metadata']===_0x1ede95(0x1fc))return Reflect[_0x1ede95(0x247)](_0x362bec,_0x12b025);},__param=this&&this['__param']||function(_0x35c730,_0x53b64c){return function(_0xbcba64,_0x8bbd95){_0x53b64c(_0xbcba64,_0x8bbd95,_0x35c730);};};Object[a52_0x2cccb8(0x244)](exports,a52_0x2cccb8(0x213),{'value':!![]}),exports[a52_0x2cccb8(0x249)]=void 0x0;const common_1=require(a52_0x2cccb8(0x246)),moment=require(a52_0x2cccb8(0x20b)),services_1=require(a52_0x2cccb8(0x252)),services_2=require(a52_0x2cccb8(0x23e)),services_3=require(a52_0x2cccb8(0x1f5)),dtos_1=require(a52_0x2cccb8(0x211)),kernel_1=require(a52_0x2cccb8(0x242)),services_4=require(a52_0x2cccb8(0x245)),guards_1=require(a52_0x2cccb8(0x205)),decorators_1=require(a52_0x2cccb8(0x200)),payloads_1=require(a52_0x2cccb8(0x250)),dtos_2=require('../dtos'),exceptions_1=require(a52_0x2cccb8(0x224));let PasswordController=class PasswordController{constructor(_0x1fc7c1,_0x3df7b8,_0x560b10,_0x4ae868){const _0x4fb6c7=a52_0x2cccb8;this[_0x4fb6c7(0x239)]=_0x1fc7c1,this[_0x4fb6c7(0x21e)]=_0x3df7b8,this[_0x4fb6c7(0x241)]=_0x560b10,this['studioService']=_0x4ae868;}async[a52_0x2cccb8(0x207)](_0x3e5a02,_0xbe9476){const _0x5e88c6=a52_0x2cccb8,_0x50e044=await this['authService'][_0x5e88c6(0x230)]({'source':_0xbe9476['source']||_0x5e88c6(0x251),'sourceId':_0x3e5a02[_0x5e88c6(0x1fe)],'type':_0xbe9476[_0x5e88c6(0x23f)]||'email'});if(!_0x50e044)throw new exceptions_1[(_0x5e88c6(0x23b))]();if(!this[_0x5e88c6(0x21e)][_0x5e88c6(0x24f)](_0xbe9476[_0x5e88c6(0x1f6)],_0x50e044))throw new exceptions_1[(_0x5e88c6(0x20f))]();return await this['authService']['update'](new dtos_2[(_0x5e88c6(0x24b))]({'source':_0xbe9476['source']||_0x5e88c6(0x251),'sourceId':_0x3e5a02[_0x5e88c6(0x1fe)],'type':_0xbe9476['type']||_0x5e88c6(0x253),'value':_0xbe9476[_0x5e88c6(0x24a)]})),kernel_1[_0x5e88c6(0x20e)]['ok'](!![]);}async['updateUserPassword'](_0x580453,_0x184690){const _0x51d34d=a52_0x2cccb8;return await this['authService']['update'](new dtos_2[(_0x51d34d(0x24b))]({'source':_0x580453[_0x51d34d(0x257)]||_0x51d34d(0x251),'sourceId':_0x580453[_0x51d34d(0x203)]||_0x184690['_id'],'value':_0x580453[_0x51d34d(0x24a)]})),kernel_1['DataResponse']['ok'](!![]);}async['forgotPassword'](_0x9d02b2){const _0x1150db=a52_0x2cccb8;let _0x5424a5=null;_0x9d02b2[_0x1150db(0x23f)]==='user'&&(_0x5424a5=await this[_0x1150db(0x239)][_0x1150db(0x248)](_0x9d02b2[_0x1150db(0x253)]));_0x9d02b2[_0x1150db(0x23f)]===_0x1150db(0x21b)&&(_0x5424a5=await this[_0x1150db(0x241)][_0x1150db(0x248)](_0x9d02b2[_0x1150db(0x253)]));_0x9d02b2[_0x1150db(0x23f)]===_0x1150db(0x259)&&(_0x5424a5=await this[_0x1150db(0x1fa)][_0x1150db(0x248)](_0x9d02b2[_0x1150db(0x253)]));if(!_0x5424a5)throw new exceptions_1['AccountNotFoundxception']();let _0x570316=null;_0x9d02b2[_0x1150db(0x23f)]===_0x1150db(0x251)&&(_0x570316=await this[_0x1150db(0x21e)][_0x1150db(0x230)]({'source':_0x1150db(0x251),'sourceId':_0x5424a5[_0x1150db(0x1fe)],'type':_0x1150db(0x253)}));_0x9d02b2['type']===_0x1150db(0x21b)&&(_0x570316=await this[_0x1150db(0x21e)][_0x1150db(0x230)]({'source':_0x1150db(0x21b),'sourceId':_0x5424a5[_0x1150db(0x1fe)],'type':_0x1150db(0x253)}));_0x9d02b2[_0x1150db(0x23f)]==='studio'&&(_0x570316=await this[_0x1150db(0x21e)][_0x1150db(0x230)]({'source':'studio','sourceId':_0x5424a5[_0x1150db(0x1fe)],'type':_0x1150db(0x253)}));if(!_0x570316)throw new exceptions_1[(_0x1150db(0x23b))]();return await this[_0x1150db(0x21e)][_0x1150db(0x231)](_0x570316,{'_id':_0x5424a5[_0x1150db(0x1fe)],'email':_0x5424a5[_0x1150db(0x253)]}),kernel_1[_0x1150db(0x20e)]['ok']({'success':!![]});}async[a52_0x2cccb8(0x210)](_0x1b6a6f,_0x11a3db){const _0x2a2f91=a52_0x2cccb8;if(!_0x11a3db)return _0x1b6a6f[_0x2a2f91(0x208)](_0x2a2f91(0x212));const _0x2b9399=await this[_0x2a2f91(0x21e)]['getForgot'](_0x11a3db);if(!_0x2b9399)return _0x1b6a6f[_0x2a2f91(0x208)]('404.html');if(moment(_0x2b9399[_0x2a2f91(0x22a)])[_0x2a2f91(0x234)](moment()[_0x2a2f91(0x220)](0x1,_0x2a2f91(0x24c))))return await _0x2b9399[_0x2a2f91(0x1fd)](),_0x1b6a6f['render'](_0x2a2f91(0x212));return _0x1b6a6f['render'](_0x2a2f91(0x1ff));}async[a52_0x2cccb8(0x229)](_0x78ab01,_0x3f7ff8,_0x2cc880){const _0x3226ec=a52_0x2cccb8;if(!_0x3f7ff8||!_0x2cc880||_0x2cc880[_0x3226ec(0x24d)]<0x6)return _0x78ab01[_0x3226ec(0x208)]('404.html');const _0x33b0a4=await this[_0x3226ec(0x21e)][_0x3226ec(0x20c)](_0x3f7ff8);if(!_0x33b0a4)return _0x78ab01[_0x3226ec(0x208)](_0x3226ec(0x212));return await this[_0x3226ec(0x21e)][_0x3226ec(0x24e)](new dtos_2[(_0x3226ec(0x24b))]({'source':_0x33b0a4[_0x3226ec(0x257)],'sourceId':_0x33b0a4[_0x3226ec(0x22d)],'value':_0x2cc880})),await _0x33b0a4[_0x3226ec(0x1fd)](),_0x78ab01[_0x3226ec(0x208)]('password-change.html',{'done':!![]});}};__decorate([common_1[a52_0x2cccb8(0x1f3)](a52_0x2cccb8(0x227)),common_1[a52_0x2cccb8(0x23a)](guards_1['AuthGuard']),__param(0x0,decorators_1[a52_0x2cccb8(0x254)]()),__param(0x1,common_1['Body']()),__metadata(a52_0x2cccb8(0x225),Function),__metadata(a52_0x2cccb8(0x228),[dtos_1[a52_0x2cccb8(0x219)],payloads_1[a52_0x2cccb8(0x255)]]),__metadata(a52_0x2cccb8(0x21d),Promise)],PasswordController['prototype'],a52_0x2cccb8(0x207),null),__decorate([common_1[a52_0x2cccb8(0x1f3)](a52_0x2cccb8(0x256)),decorators_1[a52_0x2cccb8(0x204)](a52_0x2cccb8(0x214)),common_1[a52_0x2cccb8(0x23a)](guards_1[a52_0x2cccb8(0x22b)]),__param(0x0,common_1[a52_0x2cccb8(0x243)]()),__param(0x1,decorators_1[a52_0x2cccb8(0x254)]()),__metadata(a52_0x2cccb8(0x225),Function),__metadata(a52_0x2cccb8(0x228),[payloads_1[a52_0x2cccb8(0x21c)],dtos_1[a52_0x2cccb8(0x219)]]),__metadata(a52_0x2cccb8(0x21d),Promise)],PasswordController[a52_0x2cccb8(0x217)],a52_0x2cccb8(0x22c),null),__decorate([common_1[a52_0x2cccb8(0x216)](a52_0x2cccb8(0x221)),common_1[a52_0x2cccb8(0x1f4)](common_1[a52_0x2cccb8(0x22f)]['OK']),__param(0x0,common_1[a52_0x2cccb8(0x243)]()),__metadata(a52_0x2cccb8(0x225),Function),__metadata(a52_0x2cccb8(0x228),[payloads_1[a52_0x2cccb8(0x235)]]),__metadata(a52_0x2cccb8(0x21d),Promise)],PasswordController[a52_0x2cccb8(0x217)],'forgotPassword',null),__decorate([common_1[a52_0x2cccb8(0x23c)](a52_0x2cccb8(0x1f9)),__param(0x0,common_1[a52_0x2cccb8(0x238)]()),__param(0x1,common_1[a52_0x2cccb8(0x1fb)](a52_0x2cccb8(0x258))),__metadata(a52_0x2cccb8(0x225),Function),__metadata('design:paramtypes',[Object,String]),__metadata(a52_0x2cccb8(0x21d),Promise)],PasswordController[a52_0x2cccb8(0x217)],a52_0x2cccb8(0x210),null),__decorate([common_1[a52_0x2cccb8(0x216)](a52_0x2cccb8(0x1f9)),__param(0x0,common_1[a52_0x2cccb8(0x238)]()),__param(0x1,common_1[a52_0x2cccb8(0x1fb)]('token')),__param(0x2,common_1['Body'](a52_0x2cccb8(0x24a))),__metadata(a52_0x2cccb8(0x225),Function),__metadata(a52_0x2cccb8(0x228),[Object,String,String]),__metadata('design:returntype',Promise)],PasswordController[a52_0x2cccb8(0x217)],a52_0x2cccb8(0x229),null),PasswordController=__decorate([common_1[a52_0x2cccb8(0x226)](a52_0x2cccb8(0x209)),__metadata('design:paramtypes',[services_1['UserService'],services_4[a52_0x2cccb8(0x1f8)],services_2[a52_0x2cccb8(0x215)],services_3[a52_0x2cccb8(0x21f)]])],PasswordController),exports[a52_0x2cccb8(0x249)]=PasswordController;