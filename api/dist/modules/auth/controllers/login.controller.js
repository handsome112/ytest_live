'use strict';const a51_0x547e=['design:paramtypes','userService','decorate','Controller','generateJWT','AccountInactiveException','HttpStatus','prototype','users/login/username','length','LoginByUsernamePayload','email','654053wULcIt','UserService','../../user/constants','users/login','object','authService','defineProperty','__metadata','2FvxVKh','function','emailVerified','1092521FsZYzW','STATUS_PENDING','username','LoginByEmailPayload','__decorate','remember','../../user/services','verifyPassword','403513RKyOYK','findByUsername','@nestjs/common','../../settings','__param','2wnFHSu','AuthService','EmailNotVerifiedException','AccountNotFoundxception','design:returntype','requireEmailVerification','331643JmjohO','status','Body','STATUS_INACTIVE','getValueByKey','HttpCode','design:type','163411vyotgt','metadata','199546YZILGU','_id','loginByEmail','loginByUsername','367cbkwOC','Post','findByEmail','148FZUAYw','auth','LoginController','UsernameOrPasswordIncorrectException','user','../exceptions','findBySource','password','EmailOrPasswordIncorrectException','SettingService','3APpTmH'];const a51_0x41c8e9=a51_0x57b5;(function(_0x1c4ab6,_0x37267c){const _0x4d6566=a51_0x57b5;while(!![]){try{const _0x26c67f=parseInt(_0x4d6566(0x1f0))*-parseInt(_0x4d6566(0x1df))+parseInt(_0x4d6566(0x1e6))*parseInt(_0x4d6566(0x1e3))+-parseInt(_0x4d6566(0x1fd))+parseInt(_0x4d6566(0x205))*parseInt(_0x4d6566(0x1dd))+parseInt(_0x4d6566(0x1d0))*parseInt(_0x4d6566(0x1d6))+-parseInt(_0x4d6566(0x1cb))+parseInt(_0x4d6566(0x208));if(_0x26c67f===_0x37267c)break;else _0x1c4ab6['push'](_0x1c4ab6['shift']());}catch(_0x34927d){_0x1c4ab6['push'](_0x1c4ab6['shift']());}}}(a51_0x547e,0x755e5));var __decorate=this&&this[a51_0x41c8e9(0x1c7)]||function(_0x3bf4ab,_0x1ffbfa,_0x55ef17,_0xf250df){const _0x5f20db=a51_0x41c8e9;var _0x3fea32=arguments[_0x5f20db(0x1fa)],_0x4b51c3=_0x3fea32<0x3?_0x1ffbfa:_0xf250df===null?_0xf250df=Object['getOwnPropertyDescriptor'](_0x1ffbfa,_0x55ef17):_0xf250df,_0x4c138b;if(typeof Reflect==='object'&&typeof Reflect[_0x5f20db(0x1f3)]===_0x5f20db(0x206))_0x4b51c3=Reflect['decorate'](_0x3bf4ab,_0x1ffbfa,_0x55ef17,_0xf250df);else{for(var _0x498f42=_0x3bf4ab['length']-0x1;_0x498f42>=0x0;_0x498f42--)if(_0x4c138b=_0x3bf4ab[_0x498f42])_0x4b51c3=(_0x3fea32<0x3?_0x4c138b(_0x4b51c3):_0x3fea32>0x3?_0x4c138b(_0x1ffbfa,_0x55ef17,_0x4b51c3):_0x4c138b(_0x1ffbfa,_0x55ef17))||_0x4b51c3;}return _0x3fea32>0x3&&_0x4b51c3&&Object[_0x5f20db(0x203)](_0x1ffbfa,_0x55ef17,_0x4b51c3),_0x4b51c3;},__metadata=this&&this[a51_0x41c8e9(0x204)]||function(_0x3499fa,_0x522e01){const _0x16b485=a51_0x41c8e9;if(typeof Reflect===_0x16b485(0x201)&&typeof Reflect['metadata']==='function')return Reflect[_0x16b485(0x1de)](_0x3499fa,_0x522e01);},__param=this&&this[a51_0x41c8e9(0x1cf)]||function(_0x134f00,_0x19a92e){return function(_0x4b5f7f,_0x2e75af){_0x19a92e(_0x4b5f7f,_0x2e75af,_0x134f00);};};Object[a51_0x41c8e9(0x203)](exports,'__esModule',{'value':!![]}),exports[a51_0x41c8e9(0x1e8)]=void 0x0;function a51_0x57b5(_0x5ce751,_0x52889d){return a51_0x57b5=function(_0x547ea9,_0x57b57a){_0x547ea9=_0x547ea9-0x1c5;let _0x935516=a51_0x547e[_0x547ea9];return _0x935516;},a51_0x57b5(_0x5ce751,_0x52889d);}const common_1=require(a51_0x41c8e9(0x1cd)),services_1=require(a51_0x41c8e9(0x1c9)),kernel_1=require('../../../kernel'),settings_1=require(a51_0x41c8e9(0x1ce)),constants_1=require(a51_0x41c8e9(0x1ff)),payloads_1=require('../payloads'),services_2=require('../services'),exceptions_1=require(a51_0x41c8e9(0x1eb));let LoginController=class LoginController{constructor(_0x508af0,_0xfed9f5){const _0xf91fb0=a51_0x41c8e9;this[_0xf91fb0(0x1f2)]=_0x508af0,this[_0xf91fb0(0x202)]=_0xfed9f5;}async[a51_0x41c8e9(0x1e1)](_0x230d81){const _0x4bb5aa=a51_0x41c8e9,_0x229eb6=await this[_0x4bb5aa(0x1f2)][_0x4bb5aa(0x1e5)](_0x230d81['email']);if(!_0x229eb6)throw new exceptions_1['EmailOrPasswordIncorrectException']();if(settings_1[_0x4bb5aa(0x1ef)]['getValueByKey'](_0x4bb5aa(0x1d5))&&_0x229eb6[_0x4bb5aa(0x1d7)]===constants_1[_0x4bb5aa(0x209)]||settings_1['SettingService']['getValueByKey']('requireEmailVerification')&&!_0x229eb6['emailVerified'])throw new exceptions_1[(_0x4bb5aa(0x1d2))]();if(_0x229eb6[_0x4bb5aa(0x1d7)]===constants_1[_0x4bb5aa(0x1d9)])throw new exceptions_1['AccountInactiveException']();const _0x36ccd9=await this[_0x4bb5aa(0x202)][_0x4bb5aa(0x1ec)]({'source':_0x4bb5aa(0x1ea),'sourceId':_0x229eb6['_id'],'type':_0x4bb5aa(0x1fc)});if(!_0x36ccd9)throw new exceptions_1['AccountNotFoundxception']();if(!this[_0x4bb5aa(0x202)][_0x4bb5aa(0x1ca)](_0x230d81[_0x4bb5aa(0x1ed)],_0x36ccd9))throw new exceptions_1[(_0x4bb5aa(0x1ee))]();return kernel_1['DataResponse']['ok']({'token':this[_0x4bb5aa(0x202)][_0x4bb5aa(0x1f5)](_0x36ccd9,{'expiresIn':_0x230d81['remember']?0x3c*0x3c*0x16d:0x3c*0x3c*0x18})});}async[a51_0x41c8e9(0x1e2)](_0x1a7c96){const _0x4d14d1=a51_0x41c8e9,_0x2ca78c=await this['userService'][_0x4d14d1(0x1cc)](_0x1a7c96[_0x4d14d1(0x1c5)]);if(!_0x2ca78c)throw new exceptions_1[(_0x4d14d1(0x1e9))]();if(settings_1['SettingService'][_0x4d14d1(0x1da)](_0x4d14d1(0x1d5))&&_0x2ca78c['status']===constants_1['STATUS_PENDING']||settings_1[_0x4d14d1(0x1ef)]['getValueByKey'](_0x4d14d1(0x1d5))&&!_0x2ca78c[_0x4d14d1(0x207)])throw new exceptions_1[(_0x4d14d1(0x1d2))]();if(_0x2ca78c[_0x4d14d1(0x1d7)]===constants_1['STATUS_INACTIVE'])throw new exceptions_1[(_0x4d14d1(0x1f6))]();const _0x472c09=await this[_0x4d14d1(0x202)][_0x4d14d1(0x1ec)]({'source':_0x4d14d1(0x1ea),'sourceId':_0x2ca78c[_0x4d14d1(0x1e0)],'type':'username'});if(!_0x472c09)throw new exceptions_1[(_0x4d14d1(0x1d3))]();if(!this[_0x4d14d1(0x202)][_0x4d14d1(0x1ca)](_0x1a7c96[_0x4d14d1(0x1ed)],_0x472c09))throw new exceptions_1[(_0x4d14d1(0x1e9))]();if(settings_1[_0x4d14d1(0x1ef)][_0x4d14d1(0x1da)]('requireEmailVerification')&&_0x2ca78c[_0x4d14d1(0x1d7)]===constants_1[_0x4d14d1(0x209)])throw new exceptions_1[(_0x4d14d1(0x1d2))]();return kernel_1['DataResponse']['ok']({'token':this[_0x4d14d1(0x202)][_0x4d14d1(0x1f5)](_0x472c09,{'expiresIn':_0x1a7c96[_0x4d14d1(0x1c8)]?0x3c*0x3c*0x16d:0x3c*0x3c*0x18})});}};__decorate([common_1[a51_0x41c8e9(0x1e4)](a51_0x41c8e9(0x200)),common_1['HttpCode'](common_1[a51_0x41c8e9(0x1f7)]['OK']),__param(0x0,common_1[a51_0x41c8e9(0x1d8)]()),__metadata('design:type',Function),__metadata(a51_0x41c8e9(0x1f1),[payloads_1[a51_0x41c8e9(0x1c6)]]),__metadata(a51_0x41c8e9(0x1d4),Promise)],LoginController[a51_0x41c8e9(0x1f8)],a51_0x41c8e9(0x1e1),null),__decorate([common_1[a51_0x41c8e9(0x1e4)](a51_0x41c8e9(0x1f9)),common_1[a51_0x41c8e9(0x1db)](common_1['HttpStatus']['OK']),__param(0x0,common_1[a51_0x41c8e9(0x1d8)]()),__metadata(a51_0x41c8e9(0x1dc),Function),__metadata(a51_0x41c8e9(0x1f1),[payloads_1[a51_0x41c8e9(0x1fb)]]),__metadata('design:returntype',Promise)],LoginController['prototype'],a51_0x41c8e9(0x1e2),null),LoginController=__decorate([common_1[a51_0x41c8e9(0x1f4)](a51_0x41c8e9(0x1e7)),__metadata(a51_0x41c8e9(0x1f1),[services_1[a51_0x41c8e9(0x1fe)],services_2[a51_0x41c8e9(0x1d1)]])],LoginController),exports[a51_0x41c8e9(0x1e8)]=LoginController;