'use strict';const a217_0x3201=['message_created_conversation_','../../stream/constant','_id','@nestjs/common','CONVERSATION_INITIALIZE','../../performer/services','MESSAGE_EVENT','2TiJBmo','178mBvuVE','1314859yGGpHZ','../../../kernel','PERFORMER_CHANNEL','SocketUserService','design:paramtypes','StreamService','QueueEventService','queueEventService','../../../kernel/constants','StreamDto','Logger','28933bqcLiM','defineProperty','../../stream/services','PerformerService','../../performer/constants','emitToRoom','createStreamConversation','858001XkzwBy','ConversationService','create','handleNotify','type','length','90011hKnypG','__metadata','logger','serializeConversation','handleMessage','data','__decorate','performerService','1CkpPLe','object','handleNotifyDelete','1822860FYknGP','metadata','conversationService','DELETED','subscribe','MESSAGE_PRIVATE_STREAM_CHANNEL','stream_','handleConversation','socketUserService','decorate','CREATED','findById','eventName','748918ShmIDn','includes','Injectable','1151769FTIglM','conversationId','streamService','function','../services','uuid','StreamMessageListener'];const a217_0x32d81d=a217_0x54f9;(function(_0x53a354,_0x2b2aca){const _0x27e2d1=a217_0x54f9;while(!![]){try{const _0x2f0832=-parseInt(_0x27e2d1(0x12f))*-parseInt(_0x27e2d1(0x10f))+parseInt(_0x27e2d1(0x132))+parseInt(_0x27e2d1(0x121))+-parseInt(_0x27e2d1(0x127))*-parseInt(_0x27e2d1(0x10d))+parseInt(_0x27e2d1(0xfc))+parseInt(_0x27e2d1(0xff))+parseInt(_0x27e2d1(0x10e))*-parseInt(_0x27e2d1(0x11a));if(_0x2f0832===_0x2b2aca)break;else _0x53a354['push'](_0x53a354['shift']());}catch(_0x13144d){_0x53a354['push'](_0x53a354['shift']());}}}(a217_0x3201,0xe2293));function a217_0x54f9(_0x356667,_0x321cb5){return a217_0x54f9=function(_0x3201fa,_0x54f94b){_0x3201fa=_0x3201fa-0xf0;let _0x39f2eb=a217_0x3201[_0x3201fa];return _0x39f2eb;},a217_0x54f9(_0x356667,_0x321cb5);}var __decorate=this&&this[a217_0x32d81d(0x12d)]||function(_0x1f7636,_0x30ed04,_0x2f2d5f,_0x2a5049){const _0x5d5503=a217_0x32d81d;var _0x12f605=arguments[_0x5d5503(0x126)],_0x25d2b8=_0x12f605<0x3?_0x30ed04:_0x2a5049===null?_0x2a5049=Object['getOwnPropertyDescriptor'](_0x30ed04,_0x2f2d5f):_0x2a5049,_0x34268a;if(typeof Reflect===_0x5d5503(0x130)&&typeof Reflect[_0x5d5503(0xf8)]===_0x5d5503(0x102))_0x25d2b8=Reflect[_0x5d5503(0xf8)](_0x1f7636,_0x30ed04,_0x2f2d5f,_0x2a5049);else{for(var _0x2ad709=_0x1f7636[_0x5d5503(0x126)]-0x1;_0x2ad709>=0x0;_0x2ad709--)if(_0x34268a=_0x1f7636[_0x2ad709])_0x25d2b8=(_0x12f605<0x3?_0x34268a(_0x25d2b8):_0x12f605>0x3?_0x34268a(_0x30ed04,_0x2f2d5f,_0x25d2b8):_0x34268a(_0x30ed04,_0x2f2d5f))||_0x25d2b8;}return _0x12f605>0x3&&_0x25d2b8&&Object[_0x5d5503(0x11b)](_0x30ed04,_0x2f2d5f,_0x25d2b8),_0x25d2b8;},__metadata=this&&this[a217_0x32d81d(0x128)]||function(_0x5358dd,_0x2ae614){const _0x1e263c=a217_0x32d81d;if(typeof Reflect===_0x1e263c(0x130)&&typeof Reflect[_0x1e263c(0xf0)]===_0x1e263c(0x102))return Reflect['metadata'](_0x5358dd,_0x2ae614);};Object[a217_0x32d81d(0x11b)](exports,'__esModule',{'value':!![]}),exports[a217_0x32d81d(0x105)]=void 0x0;const common_1=require(a217_0x32d81d(0x109)),kernel_1=require(a217_0x32d81d(0x110)),constants_1=require(a217_0x32d81d(0x117)),constants_2=require(a217_0x32d81d(0x11e)),services_1=require(a217_0x32d81d(0x10b)),socket_user_service_1=require('../../socket/services/socket-user.service'),constant_1=require(a217_0x32d81d(0x107)),dtos_1=require('../../stream/dtos'),services_2=require(a217_0x32d81d(0x11c)),uuid_1=require(a217_0x32d81d(0x104)),constants_3=require('../constants'),services_3=require(a217_0x32d81d(0x103)),MESSAGE_STREAM_NOTIFY='MESSAGE_STREAM_NOTIFY',CONVERSATION_INITIALIZE=a217_0x32d81d(0x10a);let StreamMessageListener=class StreamMessageListener{constructor(_0x4f934d,_0x293006,_0x490d6a,_0x1b6f0e,_0x514c59){const _0x68a92d=a217_0x32d81d;this[_0x68a92d(0x116)]=_0x4f934d,this[_0x68a92d(0xf7)]=_0x293006,this[_0x68a92d(0xf1)]=_0x490d6a,this[_0x68a92d(0x12e)]=_0x1b6f0e,this['streamService']=_0x514c59,this[_0x68a92d(0x129)]=new common_1[(_0x68a92d(0x119))](),this[_0x68a92d(0x116)][_0x68a92d(0xf3)](constants_3[_0x68a92d(0xf4)],MESSAGE_STREAM_NOTIFY,this['handleMessage']['bind'](this)),this[_0x68a92d(0x116)][_0x68a92d(0xf3)](constants_2[_0x68a92d(0x111)],CONVERSATION_INITIALIZE,this[_0x68a92d(0xf6)]['bind'](this));}async[a217_0x32d81d(0x12b)](_0x40c8e2){const _0x3fb3ed=a217_0x32d81d;if(![constants_3[_0x3fb3ed(0x10c)][_0x3fb3ed(0xf9)],constants_3[_0x3fb3ed(0x10c)][_0x3fb3ed(0xf2)]]['includes'](_0x40c8e2[_0x3fb3ed(0xfb)]))return;const _0x4afc79=_0x40c8e2[_0x3fb3ed(0x12c)],_0x12bdfa=await this[_0x3fb3ed(0xf1)][_0x3fb3ed(0xfa)](_0x4afc79[_0x3fb3ed(0x100)]);if(!(_0x12bdfa===null||_0x12bdfa===void 0x0?void 0x0:_0x12bdfa[_0x3fb3ed(0x125)][_0x3fb3ed(0xfd)](_0x3fb3ed(0xf5))))return;_0x40c8e2[_0x3fb3ed(0xfb)]===constants_3[_0x3fb3ed(0x10c)][_0x3fb3ed(0xf9)]&&await this[_0x3fb3ed(0x124)](_0x12bdfa,_0x4afc79),_0x40c8e2[_0x3fb3ed(0xfb)]===constants_3[_0x3fb3ed(0x10c)]['DELETED']&&await this['handleNotifyDelete'](_0x12bdfa,_0x4afc79);}async['handleNotify'](_0xb5be6e,_0x39c46c){const _0x12bcd0=a217_0x32d81d,_0x7194ce=this[_0x12bcd0(0xf1)]['serializeConversation'](_0xb5be6e[_0x12bcd0(0x108)],_0xb5be6e[_0x12bcd0(0x125)]);await this['socketUserService'][_0x12bcd0(0x11f)](_0x7194ce,_0x12bcd0(0x106)+_0xb5be6e['_id'],_0x39c46c);}async[a217_0x32d81d(0x131)](_0x2cf81d,_0x24b2b7){const _0x566aab=a217_0x32d81d,_0x22c937=this[_0x566aab(0xf1)][_0x566aab(0x12a)](_0x2cf81d[_0x566aab(0x108)],_0x2cf81d[_0x566aab(0x125)]);await this[_0x566aab(0xf7)]['emitToRoom'](_0x22c937,'message_deleted_conversation_'+_0x2cf81d['_id'],_0x24b2b7);}async[a217_0x32d81d(0xf6)](_0x1e282a){const _0x4fbeca=a217_0x32d81d;try{const {eventName:_0x53757f,data:_0x36bc54}=_0x1e282a;if(_0x53757f!==constants_1['EVENT']['CREATED'])return;const _0x5322=await this[_0x4fbeca(0x12e)][_0x4fbeca(0xfa)](_0x36bc54['id']);if(!_0x5322)return;const _0x47c635=await this[_0x4fbeca(0x101)][_0x4fbeca(0x123)]({'sessionId':uuid_1['v4'](),'performerId':_0x5322['_id'],'type':constant_1['PUBLIC_CHAT']});await this[_0x4fbeca(0xf1)][_0x4fbeca(0x120)](new dtos_1[(_0x4fbeca(0x118))](_0x47c635));}catch(_0x1b8337){this[_0x4fbeca(0x129)]['error'](_0x1b8337);}}};StreamMessageListener=__decorate([common_1[a217_0x32d81d(0xfe)](),__metadata(a217_0x32d81d(0x113),[kernel_1[a217_0x32d81d(0x115)],socket_user_service_1[a217_0x32d81d(0x112)],services_3[a217_0x32d81d(0x122)],services_1[a217_0x32d81d(0x11d)],services_2[a217_0x32d81d(0x114)]])],StreamMessageListener),exports[a217_0x32d81d(0x105)]=StreamMessageListener;