'use strict';const a210_0x50eb=['length','Delete','authUser','__decorate','/stream/public/conversations/:conversationId','561483bbPrOC','NotificationMessageReadPayload','Body','createPublicStreamMessage','@nestjs/common','messageService','conversationId','notificationMessageService','../../file','prototype','UseGuards','getOwnPropertyDescriptor','loadPublicMessages','MultiFileUploadInterceptor','sourceId','__param','MessageListRequest','../../../kernel','Injectable','/private/file','/read-all','../../auth/decorators','HttpCode','createStreamMessage','84962qEOUYZ','/conversations/:conversationId','/conversations/public/:conversationId','createPrivateFileMessage','recipientReadAllMessageInConversation','1oIVdrS','source','loadMessages','229574yvawin','4FhCgNq','../../performer/dtos','/:messageId','/counting-not-read-messages','DataResponse','2164564pfJvtr','Query','deleteMessage','UsePipes','deletePublicMessage','toString','message-photo','design:paramtypes','FilesUploaded','Post','Param','UserDto','MessageCreatePayload','getConfig','recipientType','224104HgEyWc','deleteAllPublicMessage','file','AuthGuard','427176jfGJnU','sendMessageToAllFollowers','createStreamMessageFromConversation','Roles','defineProperty','Request','recipientId','object','../../auth/guards','countTotalNotReadMessage','createMessage','HttpStatus','/follower','metadata','RoleGuard','function','_id','messageId','design:returntype','createPrivateMessageFromConversation','PerformerDto','ForbiddenException','Get','CurrentUser','createPublicStreamMessageFromConversation','../services','PrivateMessageCreatePayload','design:type','/:conversationId/remove-all-message','MessageController','performer','ValidationPipe','decorate','78424sULZuT','__esModule'];const a210_0x20235d=a210_0xa3b8;(function(_0x5229be,_0x3ef6e7){const _0x856a68=a210_0xa3b8;while(!![]){try{const _0x1a1972=-parseInt(_0x856a68(0xe4))+-parseInt(_0x856a68(0x110))+-parseInt(_0x856a68(0x109))+parseInt(_0x856a68(0x128))*-parseInt(_0x856a68(0xd0))+-parseInt(_0x856a68(0xcf))+-parseInt(_0x856a68(0xe8))+-parseInt(_0x856a68(0xcc))*-parseInt(_0x856a68(0xd5));if(_0x1a1972===_0x3ef6e7)break;else _0x5229be['push'](_0x5229be['shift']());}catch(_0x319fa8){_0x5229be['push'](_0x5229be['shift']());}}}(a210_0x50eb,0x4a353));var __decorate=this&&this[a210_0x20235d(0x10e)]||function(_0x22bb35,_0x2bb0e4,_0x14bea7,_0x28a5ff){const _0x36b8c6=a210_0x20235d;var _0x16720f=arguments['length'],_0x256a65=_0x16720f<0x3?_0x2bb0e4:_0x28a5ff===null?_0x28a5ff=Object[_0x36b8c6(0x11b)](_0x2bb0e4,_0x14bea7):_0x28a5ff,_0x398ce4;if(typeof Reflect===_0x36b8c6(0xef)&&typeof Reflect[_0x36b8c6(0x108)]==='function')_0x256a65=Reflect[_0x36b8c6(0x108)](_0x22bb35,_0x2bb0e4,_0x14bea7,_0x28a5ff);else{for(var _0x409185=_0x22bb35[_0x36b8c6(0x10b)]-0x1;_0x409185>=0x0;_0x409185--)if(_0x398ce4=_0x22bb35[_0x409185])_0x256a65=(_0x16720f<0x3?_0x398ce4(_0x256a65):_0x16720f>0x3?_0x398ce4(_0x2bb0e4,_0x14bea7,_0x256a65):_0x398ce4(_0x2bb0e4,_0x14bea7))||_0x256a65;}return _0x16720f>0x3&&_0x256a65&&Object[_0x36b8c6(0xec)](_0x2bb0e4,_0x14bea7,_0x256a65),_0x256a65;},__metadata=this&&this['__metadata']||function(_0x3d9790,_0x2bccab){const _0x45ac75=a210_0x20235d;if(typeof Reflect===_0x45ac75(0xef)&&typeof Reflect[_0x45ac75(0xf5)]===_0x45ac75(0xf7))return Reflect[_0x45ac75(0xf5)](_0x3d9790,_0x2bccab);},__param=this&&this[a210_0x20235d(0x11f)]||function(_0x41b6bd,_0x4d5a4b){return function(_0x45b952,_0x2a83c5){_0x4d5a4b(_0x45b952,_0x2a83c5,_0x41b6bd);};};Object['defineProperty'](exports,a210_0x20235d(0x10a),{'value':!![]}),exports[a210_0x20235d(0x105)]=void 0x0;function a210_0xa3b8(_0x125b30,_0x5a1dcd){return a210_0xa3b8=function(_0x50eb55,_0xa3b86d){_0x50eb55=_0x50eb55-0xca;let _0x350c8f=a210_0x50eb[_0x50eb55];return _0x350c8f;},a210_0xa3b8(_0x125b30,_0x5a1dcd);}const common_1=require(a210_0x20235d(0x114)),kernel_1=require(a210_0x20235d(0x121)),guards_1=require(a210_0x20235d(0xf0)),file_1=require(a210_0x20235d(0x118)),decorators_1=require(a210_0x20235d(0x125)),dtos_1=require('../../user/dtos'),dtos_2=require(a210_0x20235d(0xd1)),services_1=require(a210_0x20235d(0x101)),payloads_1=require('../payloads');let MessageController=class MessageController{constructor(_0x298b3e,_0x68c6b9){const _0x2f124b=a210_0x20235d;this[_0x2f124b(0x115)]=_0x298b3e,this[_0x2f124b(0x117)]=_0x68c6b9;}async['createPrivateFileMessage'](_0x18832a,_0xfe17c1,_0x4efb69){const _0x3d7aa3=a210_0x20235d;if(_0x4efb69['authUser'][_0x3d7aa3(0x11e)][_0x3d7aa3(0xda)]()===_0xfe17c1[_0x3d7aa3(0xee)][_0x3d7aa3(0xda)]())throw new common_1[(_0x3d7aa3(0xfd))]();const _0x2e98ca=await this[_0x3d7aa3(0x115)][_0x3d7aa3(0xca)]({'source':_0x4efb69[_0x3d7aa3(0x10d)]['source'],'sourceId':_0x4efb69[_0x3d7aa3(0x10d)][_0x3d7aa3(0x11e)]},{'source':_0xfe17c1[_0x3d7aa3(0xe3)],'sourceId':_0xfe17c1[_0x3d7aa3(0xee)]},_0x18832a[_0x3d7aa3(0xdb)],_0xfe17c1,_0x4efb69);return kernel_1[_0x3d7aa3(0xd4)]['ok'](_0x2e98ca);}async['readAllMessage'](_0x196ce6,_0x407f1a){const _0x3c5dfb=a210_0x20235d;if(_0x407f1a[_0x3c5dfb(0x10d)][_0x3c5dfb(0x11e)][_0x3c5dfb(0xda)]()!==_0x196ce6['recipientId']['toString']())throw new common_1['ForbiddenException']();const _0x560d7e=await this[_0x3c5dfb(0x117)][_0x3c5dfb(0xcb)](_0x407f1a[_0x3c5dfb(0x10d)][_0x3c5dfb(0x11e)],_0x196ce6['conversationId']);return kernel_1[_0x3c5dfb(0xd4)]['ok'](_0x560d7e);}async[a210_0x20235d(0xf1)](_0x439128){const _0x372e18=a210_0x20235d,_0x35f370=await this[_0x372e18(0x117)][_0x372e18(0xf1)](_0x439128);return kernel_1[_0x372e18(0xd4)]['ok'](_0x35f370);}async['loadMessages'](_0x5d8434,_0xc1d92e,_0x2a48ea){const _0x16aa21=a210_0x20235d;_0x5d8434['conversationId']=_0xc1d92e;const _0x6e4a1f=await this['messageService'][_0x16aa21(0xce)](_0x5d8434,_0x2a48ea);return kernel_1[_0x16aa21(0xd4)]['ok'](_0x6e4a1f);}async[a210_0x20235d(0x11c)](_0x33e376,_0x26d8b2){const _0x40b66c=a210_0x20235d;_0x33e376[_0x40b66c(0x116)]=_0x26d8b2;const _0x9d619e=await this[_0x40b66c(0x115)][_0x40b66c(0x11c)](_0x33e376);return kernel_1[_0x40b66c(0xd4)]['ok'](_0x9d619e);}async['createMessage'](_0x3b10f7,_0x1f2834,_0xa1395d){const _0x1e5c89=a210_0x20235d,_0x51f0f4=await this[_0x1e5c89(0x115)][_0x1e5c89(0xfb)](_0x1f2834,_0x3b10f7,{'source':_0xa1395d['authUser']['source'],'sourceId':_0xa1395d[_0x1e5c89(0x10d)][_0x1e5c89(0x11e)]},_0xa1395d);return kernel_1['DataResponse']['ok'](_0x51f0f4);}async['createStreamMessage'](_0x1700cf,_0x13f362,_0x29ae17){const _0x2c11ad=a210_0x20235d,_0x1f1aab=await this['messageService'][_0x2c11ad(0xea)](_0x13f362,_0x1700cf,{'source':_0x29ae17['authUser'][_0x2c11ad(0xcd)],'sourceId':_0x29ae17['authUser'][_0x2c11ad(0x11e)]},_0x29ae17);return kernel_1[_0x2c11ad(0xd4)]['ok'](_0x1f1aab);}async[a210_0x20235d(0x113)](_0x3e2a2c,_0x4af056,_0x4610f2,_0xecd9){const _0x42412b=a210_0x20235d,_0x5924d1=await this['messageService'][_0x42412b(0x100)](_0x4af056,_0x3e2a2c,{'source':_0x4610f2[_0x42412b(0x10d)][_0x42412b(0xcd)],'sourceId':_0x4610f2[_0x42412b(0x10d)][_0x42412b(0x11e)]},_0xecd9,_0x4610f2);return kernel_1[_0x42412b(0xd4)]['ok'](_0x5924d1);}async[a210_0x20235d(0xd9)](_0x4424eb,_0x560db0){const _0x408bbe=a210_0x20235d,_0x456e2b=await this[_0x408bbe(0x115)][_0x408bbe(0xd7)](_0x4424eb,_0x560db0);return kernel_1['DataResponse']['ok'](_0x456e2b);}async[a210_0x20235d(0xe5)](_0x37fa05,_0x1d1ab9){const _0x37eea7=a210_0x20235d,_0x452a5=await this[_0x37eea7(0x115)]['deleteAllMessageInConversation'](_0x37fa05,_0x1d1ab9);return kernel_1['DataResponse']['ok'](_0x452a5);}async[a210_0x20235d(0xe9)](_0x269621,_0x209eb5){const _0x2261f6=a210_0x20235d;return await this[_0x2261f6(0x115)][_0x2261f6(0xe9)](_0x209eb5[_0x2261f6(0xf8)],_0x269621),kernel_1['DataResponse']['ok']({'success':!![]});}};__decorate([common_1[a210_0x20235d(0xde)](a210_0x20235d(0x123)),common_1[a210_0x20235d(0x126)](common_1['HttpStatus']['OK']),common_1[a210_0x20235d(0x11a)](guards_1[a210_0x20235d(0xe7)]),common_1['UseInterceptors'](file_1[a210_0x20235d(0x11d)]([{'type':a210_0x20235d(0xdb),'fieldName':a210_0x20235d(0xdb),'options':{'destination':kernel_1[a210_0x20235d(0xe2)](a210_0x20235d(0xe6))['photoProtectedDir'],'replaceWithoutExif':!![]}}])),__param(0x0,file_1[a210_0x20235d(0xdd)]()),__param(0x1,common_1[a210_0x20235d(0x112)]()),__param(0x2,common_1[a210_0x20235d(0xed)]()),__metadata(a210_0x20235d(0x103),Function),__metadata('design:paramtypes',[Object,payloads_1[a210_0x20235d(0x102)],Object]),__metadata('design:returntype',Promise)],MessageController[a210_0x20235d(0x119)],a210_0x20235d(0xca),null),__decorate([common_1[a210_0x20235d(0xde)](a210_0x20235d(0x124)),common_1[a210_0x20235d(0x126)](common_1[a210_0x20235d(0xf3)]['OK']),common_1[a210_0x20235d(0x11a)](guards_1['AuthGuard']),common_1[a210_0x20235d(0xd8)](new common_1[(a210_0x20235d(0x107))]({'transform':!![]})),__param(0x0,common_1[a210_0x20235d(0x112)]()),__param(0x1,common_1['Request']()),__metadata(a210_0x20235d(0x103),Function),__metadata(a210_0x20235d(0xdc),[payloads_1[a210_0x20235d(0x111)],Object]),__metadata(a210_0x20235d(0xfa),Promise)],MessageController['prototype'],'readAllMessage',null),__decorate([common_1['Get'](a210_0x20235d(0xd3)),common_1[a210_0x20235d(0x126)](common_1['HttpStatus']['OK']),common_1[a210_0x20235d(0x11a)](guards_1['AuthGuard']),common_1[a210_0x20235d(0xd8)](new common_1[(a210_0x20235d(0x107))]({'transform':!![]})),__param(0x0,decorators_1[a210_0x20235d(0xff)]()),__metadata(a210_0x20235d(0x103),Function),__metadata(a210_0x20235d(0xdc),[dtos_1[a210_0x20235d(0xe0)]]),__metadata(a210_0x20235d(0xfa),Promise)],MessageController['prototype'],a210_0x20235d(0xf1),null),__decorate([common_1[a210_0x20235d(0xfe)](a210_0x20235d(0x129)),common_1[a210_0x20235d(0x126)](common_1['HttpStatus']['OK']),common_1[a210_0x20235d(0x11a)](guards_1[a210_0x20235d(0xe7)]),common_1['UsePipes'](new common_1[(a210_0x20235d(0x107))]({'transform':!![]})),__param(0x0,common_1[a210_0x20235d(0xd6)]()),__param(0x1,common_1[a210_0x20235d(0xdf)](a210_0x20235d(0x116))),__param(0x2,decorators_1['CurrentUser']()),__metadata(a210_0x20235d(0x103),Function),__metadata('design:paramtypes',[payloads_1['MessageListRequest'],String,dtos_1[a210_0x20235d(0xe0)]]),__metadata(a210_0x20235d(0xfa),Promise)],MessageController[a210_0x20235d(0x119)],a210_0x20235d(0xce),null),__decorate([common_1[a210_0x20235d(0xfe)](a210_0x20235d(0x12a)),common_1[a210_0x20235d(0x126)](common_1[a210_0x20235d(0xf3)]['OK']),common_1['UsePipes'](new common_1[(a210_0x20235d(0x107))]({'transform':!![]})),__param(0x0,common_1[a210_0x20235d(0xd6)]()),__param(0x1,common_1['Param'](a210_0x20235d(0x116))),__metadata(a210_0x20235d(0x103),Function),__metadata(a210_0x20235d(0xdc),[payloads_1[a210_0x20235d(0x120)],String]),__metadata(a210_0x20235d(0xfa),Promise)],MessageController[a210_0x20235d(0x119)],'loadPublicMessages',null),__decorate([common_1[a210_0x20235d(0xde)](a210_0x20235d(0x129)),common_1[a210_0x20235d(0x126)](common_1[a210_0x20235d(0xf3)]['OK']),common_1[a210_0x20235d(0x11a)](guards_1[a210_0x20235d(0xe7)]),common_1[a210_0x20235d(0xd8)](new common_1[(a210_0x20235d(0x107))]({'transform':!![]})),__param(0x0,common_1[a210_0x20235d(0x112)]()),__param(0x1,common_1[a210_0x20235d(0xdf)](a210_0x20235d(0x116))),__param(0x2,common_1[a210_0x20235d(0xed)]()),__metadata(a210_0x20235d(0x103),Function),__metadata(a210_0x20235d(0xdc),[payloads_1['MessageCreatePayload'],String,Object]),__metadata(a210_0x20235d(0xfa),Promise)],MessageController[a210_0x20235d(0x119)],a210_0x20235d(0xf2),null),__decorate([common_1[a210_0x20235d(0xde)]('/stream/conversations/:conversationId'),common_1[a210_0x20235d(0x126)](common_1[a210_0x20235d(0xf3)]['OK']),common_1[a210_0x20235d(0x11a)](guards_1[a210_0x20235d(0xe7)]),common_1['UsePipes'](new common_1['ValidationPipe']({'transform':!![]})),__param(0x0,common_1[a210_0x20235d(0x112)]()),__param(0x1,common_1['Param'](a210_0x20235d(0x116))),__param(0x2,common_1[a210_0x20235d(0xed)]()),__metadata(a210_0x20235d(0x103),Function),__metadata(a210_0x20235d(0xdc),[payloads_1['MessageCreatePayload'],String,Object]),__metadata(a210_0x20235d(0xfa),Promise)],MessageController['prototype'],a210_0x20235d(0x127),null),__decorate([common_1[a210_0x20235d(0xde)](a210_0x20235d(0x10f)),common_1[a210_0x20235d(0x126)](common_1[a210_0x20235d(0xf3)]['OK']),common_1[a210_0x20235d(0x11a)](guards_1['AuthGuard']),common_1[a210_0x20235d(0xd8)](new common_1['ValidationPipe']({'transform':!![]})),__param(0x0,common_1['Body']()),__param(0x1,common_1[a210_0x20235d(0xdf)](a210_0x20235d(0x116))),__param(0x2,common_1['Request']()),__param(0x3,decorators_1[a210_0x20235d(0xff)]()),__metadata('design:type',Function),__metadata(a210_0x20235d(0xdc),[payloads_1[a210_0x20235d(0xe1)],String,Object,dtos_1[a210_0x20235d(0xe0)]]),__metadata(a210_0x20235d(0xfa),Promise)],MessageController['prototype'],'createPublicStreamMessage',null),__decorate([common_1[a210_0x20235d(0x10c)](a210_0x20235d(0xd2)),common_1[a210_0x20235d(0x126)](common_1[a210_0x20235d(0xf3)]['OK']),common_1[a210_0x20235d(0x11a)](guards_1[a210_0x20235d(0xe7)]),common_1['UsePipes'](new common_1[(a210_0x20235d(0x107))]({'transform':!![]})),__param(0x0,common_1[a210_0x20235d(0xdf)](a210_0x20235d(0xf9))),__param(0x1,decorators_1[a210_0x20235d(0xff)]()),__metadata(a210_0x20235d(0x103),Function),__metadata(a210_0x20235d(0xdc),[String,dtos_1['UserDto']]),__metadata(a210_0x20235d(0xfa),Promise)],MessageController[a210_0x20235d(0x119)],a210_0x20235d(0xd9),null),__decorate([common_1[a210_0x20235d(0x10c)](a210_0x20235d(0x104)),common_1[a210_0x20235d(0x126)](common_1[a210_0x20235d(0xf3)]['OK']),common_1[a210_0x20235d(0x11a)](guards_1[a210_0x20235d(0xe7)]),common_1[a210_0x20235d(0xd8)](new common_1['ValidationPipe']({'transform':!![]})),__param(0x0,common_1[a210_0x20235d(0xdf)](a210_0x20235d(0x116))),__param(0x1,decorators_1[a210_0x20235d(0xff)]()),__metadata(a210_0x20235d(0x103),Function),__metadata('design:paramtypes',[String,dtos_1[a210_0x20235d(0xe0)]]),__metadata('design:returntype',Promise)],MessageController[a210_0x20235d(0x119)],'deleteAllPublicMessage',null),__decorate([common_1[a210_0x20235d(0xde)](a210_0x20235d(0xf4)),common_1[a210_0x20235d(0x126)](common_1[a210_0x20235d(0xf3)]['OK']),decorators_1[a210_0x20235d(0xeb)](a210_0x20235d(0x106)),common_1[a210_0x20235d(0x11a)](guards_1[a210_0x20235d(0xf6)]),common_1['UsePipes'](new common_1[(a210_0x20235d(0x107))]({'transform':!![]})),__param(0x0,common_1['Body']()),__param(0x1,decorators_1['CurrentUser']()),__metadata(a210_0x20235d(0x103),Function),__metadata(a210_0x20235d(0xdc),[payloads_1[a210_0x20235d(0xe1)],dtos_2[a210_0x20235d(0xfc)]]),__metadata(a210_0x20235d(0xfa),Promise)],MessageController['prototype'],a210_0x20235d(0xe9),null),MessageController=__decorate([common_1[a210_0x20235d(0x122)](),common_1['Controller']('messages'),__metadata('design:paramtypes',[services_1['MessageService'],services_1['NotificationMessageService']])],MessageController),exports[a210_0x20235d(0x105)]=MessageController;