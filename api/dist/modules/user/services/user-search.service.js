'use strict';const a624_0x54a5=['defineProperty','Inject','getOwnPropertyDescriptor','sort','status','UserSearchService','804446HsbLrS','__esModule','9028wOumlC','../../../kernel/constants','mongoose','object','replace','metadata','lean','roles','338248cRgzIf','$or','find','Model','__metadata','push','__param','924746SvFgxI','length','searchByKeyword','$and','search','design:paramtypes','__decorate','map','596517sfReHw','../../../kernel/common','toLowerCase','limit','2FxzhRT','539973gAuKsI','skip','decorate','userModel','2iXpPfr','1VKAifk','Injectable','437804iXMcYa','sortBy','UserDto','../providers','all','offset','STATUS','function','role'];const a624_0x3a152f=a624_0x3072;(function(_0x3f0b99,_0x3f7c14){const _0x1b16db=a624_0x3072;while(!![]){try{const _0x49be16=parseInt(_0x1b16db(0x90))+parseInt(_0x1b16db(0x92))*-parseInt(_0x1b16db(0xb2))+parseInt(_0x1b16db(0xa1))+-parseInt(_0x1b16db(0x9a))+parseInt(_0x1b16db(0xa9))*parseInt(_0x1b16db(0xb3))+-parseInt(_0x1b16db(0xae))+parseInt(_0x1b16db(0xb5))*-parseInt(_0x1b16db(0xad));if(_0x49be16===_0x3f7c14)break;else _0x3f0b99['push'](_0x3f0b99['shift']());}catch(_0x2af431){_0x3f0b99['push'](_0x3f0b99['shift']());}}}(a624_0x54a5,0x87360));function a624_0x3072(_0x50a8a3,_0x31ef85){return a624_0x3072=function(_0x54a526,_0x307266){_0x54a526=_0x54a526-0x8b;let _0x2e0210=a624_0x54a5[_0x54a526];return _0x2e0210;},a624_0x3072(_0x50a8a3,_0x31ef85);}var __decorate=this&&this[a624_0x3a152f(0xa7)]||function(_0x309b14,_0x1c8e99,_0x420dad,_0x91835f){const _0x125e94=a624_0x3a152f;var _0xf5b933=arguments[_0x125e94(0xa2)],_0x2aed57=_0xf5b933<0x3?_0x1c8e99:_0x91835f===null?_0x91835f=Object[_0x125e94(0x8c)](_0x1c8e99,_0x420dad):_0x91835f,_0x276dab;if(typeof Reflect===_0x125e94(0x95)&&typeof Reflect[_0x125e94(0xb0)]===_0x125e94(0xbc))_0x2aed57=Reflect[_0x125e94(0xb0)](_0x309b14,_0x1c8e99,_0x420dad,_0x91835f);else{for(var _0x35af6e=_0x309b14[_0x125e94(0xa2)]-0x1;_0x35af6e>=0x0;_0x35af6e--)if(_0x276dab=_0x309b14[_0x35af6e])_0x2aed57=(_0xf5b933<0x3?_0x276dab(_0x2aed57):_0xf5b933>0x3?_0x276dab(_0x1c8e99,_0x420dad,_0x2aed57):_0x276dab(_0x1c8e99,_0x420dad))||_0x2aed57;}return _0xf5b933>0x3&&_0x2aed57&&Object[_0x125e94(0xbe)](_0x1c8e99,_0x420dad,_0x2aed57),_0x2aed57;},__metadata=this&&this[a624_0x3a152f(0x9e)]||function(_0xf881af,_0x45024f){const _0x29167c=a624_0x3a152f;if(typeof Reflect==='object'&&typeof Reflect[_0x29167c(0x97)]==='function')return Reflect[_0x29167c(0x97)](_0xf881af,_0x45024f);},__param=this&&this[a624_0x3a152f(0xa0)]||function(_0x58fe71,_0x31c2a9){return function(_0x21f1ef,_0x3ed088){_0x31c2a9(_0x21f1ef,_0x3ed088,_0x58fe71);};};Object[a624_0x3a152f(0xbe)](exports,a624_0x3a152f(0x91),{'value':!![]}),exports['UserSearchService']=void 0x0;const common_1=require('@nestjs/common'),mongoose_1=require(a624_0x3a152f(0x94)),common_2=require(a624_0x3a152f(0xaa)),constants_1=require(a624_0x3a152f(0x93)),providers_1=require(a624_0x3a152f(0xb8)),dtos_1=require('../dtos');let UserSearchService=class UserSearchService{constructor(_0x2d6031){this['userModel']=_0x2d6031;}async[a624_0x3a152f(0xa5)](_0x30b589){const _0xcec696=a624_0x3a152f,_0x4f1049={};if(_0x30b589['q']){const _0x236822=new RegExp(_0x30b589['q']['toLowerCase']()[_0xcec696(0x96)](/[^a-zA-Z0-9]/g,''),'i');_0x4f1049[_0xcec696(0x9b)]=[{'name':{'$regex':_0x236822}},{'username':{'$regex':_0x236822}},{'email':{'$regex':_0x236822}}];}_0x30b589[_0xcec696(0xbd)]&&(_0x4f1049[_0xcec696(0x99)]=_0x30b589['role']);let _0x1bd665={};_0x30b589['sort']&&_0x30b589['sortBy']&&(_0x1bd665={[_0x30b589[_0xcec696(0xb6)]]:_0x30b589[_0xcec696(0x8d)]});_0x30b589[_0xcec696(0x8e)]&&(_0x30b589[_0xcec696(0x8e)]===constants_1[_0xcec696(0xbb)]['PENDING']?(!_0x4f1049['$and']&&(_0x4f1049[_0xcec696(0xa4)]=[]),_0x4f1049[_0xcec696(0xa4)][_0xcec696(0x9f)]({'$or':[{'status':_0x30b589['status']},{'emailVerified':![]}]})):_0x4f1049[_0xcec696(0x8e)]=_0x30b589[_0xcec696(0x8e)]);const [_0x2c0fcc,_0x499d6b]=await Promise[_0xcec696(0xb9)]([this[_0xcec696(0xb1)][_0xcec696(0x9c)](_0x4f1049)['sort'](_0x1bd665)[_0xcec696(0xac)](parseInt(_0x30b589[_0xcec696(0xac)],0xa))[_0xcec696(0xaf)](parseInt(_0x30b589[_0xcec696(0xba)],0xa)),this[_0xcec696(0xb1)]['countDocuments'](_0x4f1049)]);return{'data':_0x2c0fcc[_0xcec696(0xa8)](_0x12c91f=>new dtos_1[(_0xcec696(0xb7))](_0x12c91f)),'total':_0x499d6b};}async[a624_0x3a152f(0xa3)](_0x3d5188){const _0xdabe72=a624_0x3a152f,_0x3c6042={};if(_0x3d5188['q']){const _0xfdc764=new RegExp(_0x3d5188['q'][_0xdabe72(0xab)]()[_0xdabe72(0x96)](/[^a-zA-Z0-9]/g,''),'i');_0x3c6042[_0xdabe72(0x9b)]=[{'name':{'$regex':_0xfdc764}},{'username':{'$regex':_0xfdc764}},{'email':{'$regex':_0xfdc764}}];}const _0x21d663=await this[_0xdabe72(0xb1)][_0xdabe72(0x9c)](_0x3c6042)[_0xdabe72(0x98)]();return _0x21d663;}};UserSearchService=__decorate([common_1[a624_0x3a152f(0xb4)](),__param(0x0,common_1[a624_0x3a152f(0x8b)](providers_1['USER_MODEL_PROVIDER'])),__metadata(a624_0x3a152f(0xa6),[mongoose_1[a624_0x3a152f(0x9d)]])],UserSearchService),exports[a624_0x3a152f(0x8f)]=UserSearchService;