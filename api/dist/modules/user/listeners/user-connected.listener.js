'use strict';const a609_0x30f6=['bind','subscribe','../../../kernel','157948pvGcwe','DISCONNECTED','QueueEventService','defineProperty','25YIBupG','__decorate','Inject','updateOne','1wayXMz','decorate','getTime','user','Injectable','CONNECTED','4223UOAzfW','31372TunxsH','userModel','9128upHFsc','metadata','419GhQyfs','2975iSZIvJ','31hFAOna','__metadata','object','design:paramtypes','USER_SOCKET_EVENT','handleOnlineOffline','HANDLE_USER_ONLINE_OFFLINE','18257FQMlQR','../providers','eventName','USER_SOCKET_CONNECTED_CHANNEL','__param','round','Model','function','queueEventService','length','__esModule','UserConnectedListener'];const a609_0x3ee58b=a609_0x12d0;(function(_0x34f96a,_0x40de38){const _0x1b98b0=a609_0x12d0;while(!![]){try{const _0x220073=parseInt(_0x1b98b0(0x16c))+parseInt(_0x1b98b0(0x15d))*parseInt(_0x1b98b0(0x174))+parseInt(_0x1b98b0(0x17f))+parseInt(_0x1b98b0(0x17d))+parseInt(_0x1b98b0(0x17a))*parseInt(_0x1b98b0(0x170))+parseInt(_0x1b98b0(0x155))*-parseInt(_0x1b98b0(0x156))+-parseInt(_0x1b98b0(0x17b));if(_0x220073===_0x40de38)break;else _0x34f96a['push'](_0x34f96a['shift']());}catch(_0x44ba04){_0x34f96a['push'](_0x34f96a['shift']());}}}(a609_0x30f6,0x28f32));function a609_0x12d0(_0xf10104,_0x33f0dc){return a609_0x12d0=function(_0x30f677,_0x12d01b){_0x30f677=_0x30f677-0x155;let _0x31468e=a609_0x30f6[_0x30f677];return _0x31468e;},a609_0x12d0(_0xf10104,_0x33f0dc);}var __decorate=this&&this[a609_0x3ee58b(0x171)]||function(_0x287aa7,_0x37de69,_0x12fac3,_0x94dc2d){const _0x12dd6c=a609_0x3ee58b;var _0x48f38c=arguments[_0x12dd6c(0x166)],_0x40fb3f=_0x48f38c<0x3?_0x37de69:_0x94dc2d===null?_0x94dc2d=Object['getOwnPropertyDescriptor'](_0x37de69,_0x12fac3):_0x94dc2d,_0x3caa07;if(typeof Reflect===_0x12dd6c(0x158)&&typeof Reflect[_0x12dd6c(0x175)]===_0x12dd6c(0x164))_0x40fb3f=Reflect['decorate'](_0x287aa7,_0x37de69,_0x12fac3,_0x94dc2d);else{for(var _0x14788c=_0x287aa7['length']-0x1;_0x14788c>=0x0;_0x14788c--)if(_0x3caa07=_0x287aa7[_0x14788c])_0x40fb3f=(_0x48f38c<0x3?_0x3caa07(_0x40fb3f):_0x48f38c>0x3?_0x3caa07(_0x37de69,_0x12fac3,_0x40fb3f):_0x3caa07(_0x37de69,_0x12fac3))||_0x40fb3f;}return _0x48f38c>0x3&&_0x40fb3f&&Object[_0x12dd6c(0x16f)](_0x37de69,_0x12fac3,_0x40fb3f),_0x40fb3f;},__metadata=this&&this[a609_0x3ee58b(0x157)]||function(_0x40c985,_0x39016d){const _0xc4a5fd=a609_0x3ee58b;if(typeof Reflect===_0xc4a5fd(0x158)&&typeof Reflect[_0xc4a5fd(0x17e)]==='function')return Reflect['metadata'](_0x40c985,_0x39016d);},__param=this&&this[a609_0x3ee58b(0x161)]||function(_0x3d1075,_0x44e319){return function(_0xd26864,_0x326a46){_0x44e319(_0xd26864,_0x326a46,_0x3d1075);};};Object['defineProperty'](exports,a609_0x3ee58b(0x167),{'value':!![]}),exports[a609_0x3ee58b(0x168)]=void 0x0;const common_1=require('@nestjs/common'),kernel_1=require(a609_0x3ee58b(0x16b)),mongoose_1=require('mongoose'),constants_1=require('../../socket/constants'),providers_1=require(a609_0x3ee58b(0x15e)),HANDLE_USER_ONLINE_OFFLINE=a609_0x3ee58b(0x15c);let UserConnectedListener=class UserConnectedListener{constructor(_0x5e0805,_0x102c6c){const _0x5c35ee=a609_0x3ee58b;this[_0x5c35ee(0x165)]=_0x5e0805,this['userModel']=_0x102c6c,this[_0x5c35ee(0x165)][_0x5c35ee(0x16a)](constants_1[_0x5c35ee(0x160)],HANDLE_USER_ONLINE_OFFLINE,this['handleOnlineOffline'][_0x5c35ee(0x169)](this));}async[a609_0x3ee58b(0x15b)](_0x2a5256){const _0x214d0a=a609_0x3ee58b,{source:_0x2437cb,sourceId:_0x173f02}=_0x2a5256['data'];if(_0x2437cb!==_0x214d0a(0x177))return;const _0x4519da=await this[_0x214d0a(0x17c)]['findById'](_0x173f02);if(!_0x4519da)return;let _0x30a1eb=0x0;if(_0x2a5256[_0x214d0a(0x15f)]===constants_1['USER_SOCKET_EVENT']['DISCONNECTED']&&_0x4519da['onlineAt']){const _0x25b800=new Date(),_0x506d56=new Date(''+_0x4519da['onlineAt']);_0x30a1eb=Math[_0x214d0a(0x162)]((_0x25b800['getTime']()-_0x506d56[_0x214d0a(0x176)]())/0x3e8);}let _0x308234={};switch(_0x2a5256[_0x214d0a(0x15f)]){case constants_1[_0x214d0a(0x15a)][_0x214d0a(0x179)]:_0x308234={'isOnline':!![],'onlineAt':new Date(),'offlineAt':null};break;case constants_1[_0x214d0a(0x15a)][_0x214d0a(0x16d)]:_0x308234={'isOnline':![],'onlineAt':null,'offlineAt':new Date(),'$inc':{'totalOnlineTime':_0x30a1eb}};break;default:return;}await this[_0x214d0a(0x17c)][_0x214d0a(0x173)]({'_id':_0x173f02},_0x308234,{'upsert':![]});}};UserConnectedListener=__decorate([common_1[a609_0x3ee58b(0x178)](),__param(0x1,common_1[a609_0x3ee58b(0x172)](providers_1['USER_MODEL_PROVIDER'])),__metadata(a609_0x3ee58b(0x159),[kernel_1[a609_0x3ee58b(0x16e)],mongoose_1[a609_0x3ee58b(0x163)]])],UserConnectedListener),exports[a609_0x3ee58b(0x168)]=UserConnectedListener;