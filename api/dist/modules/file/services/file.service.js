'use strict';const a173_0x120e=['status','findById','1zVhztT','logger','EntityNotFoundException','ASSETS_ITEM_DELETED','../../performer-assets/dtos','removeIfNotHaveRef','NoFileException','StringHelper','map','Logger','FileService','DELETE_FILE_TYPE','VideoService','join','eventName','convert2Mp4','thumbnails','deleteMediaFileIfUpdated','nestjs-config','data','../providers','uploader','Inject','length','writeFileSync','fileId','9751lFtSZT','get','toPath','subscribe','createThumbs','getConfig','imageService','decorate','_id','env','getDuration','files/download','findOne','bind','Model','ImageService','__esModule','publishChannel','generateThumbnail','MEDIA_FILE_CHANNEL','file.photoDir','assign','464732vWBIUQ','thumbnailSize','processPhoto','_thumb','processing','key','create','284OCAbeB','href','PROCESS_PHOTO','FILE_EVENT','PROCESS_VIDEO','fileModel','mongoose','VideoDto','jsonwebtoken','TOKEN_SECRET','banner','Injectable','VIDEO_PROCSSED','171657EDLylM','PhotoDto','randomString','326209MOtebV','PHOTO_PROCESS','deleteMediaFileIfAssetsDeleted','file.publicDir','getMetaData','mimetype','design:paramtypes','../dtos','_processVideo','../exceptions/no-file.exception','width','createReadStream','metadata','findByIds','concat','getStreamToDownload','unlinkSync','videoService','app','verify','remove','append','getExt','config','object','absolutePath','function','refItems','FileDto','updateOne','error','publish','meta','generateJwt','14557bJsFga','baseUrl','generateDownloadLink','options','filename','913JstjiK','@nestjs/common','38mTfaRw','all','FILE_MODEL_PROVIDER','gallery','ProductDto','existsSync','33QJWgqI','path','height','FILE_PATH','sign','finished','QueueEventService','queueProcessVideo','./video.service','size','ConfigService','replace','replaceWithoutExif','createThumbnail','photo','file.videoDir','BannerDto','createFromMulter','defineProperty','replaceWithThumbail','_processPhoto','getOwnPropertyDescriptor','FILEID','file','video','QueueEvent','searchParams','411485pixbzq','DELETE_MEDIA_FILE_IF_ASSETS_DELETED','PHOTO_PROCESSED','FILE_RELATED_MODULE_UPDATED','queueEventService','../../banner/dtos'];const a173_0x2e0e6f=a173_0x37ec;(function(_0x38ff84,_0x2efd3f){const _0x355842=a173_0x37ec;while(!![]){try{const _0x38b45f=-parseInt(_0x355842(0x221))*parseInt(_0x355842(0x25e))+parseInt(_0x355842(0x23c))+-parseInt(_0x355842(0x274))+-parseInt(_0x355842(0x1f2))*parseInt(_0x355842(0x244))+parseInt(_0x355842(0x1ef))+parseInt(_0x355842(0x21b))*parseInt(_0x355842(0x214))+-parseInt(_0x355842(0x1e2))*-parseInt(_0x355842(0x219));if(_0x38b45f===_0x2efd3f)break;else _0x38ff84['push'](_0x38ff84['shift']());}catch(_0x34d459){_0x38ff84['push'](_0x38ff84['shift']());}}}(a173_0x120e,0x450fc));var __decorate=this&&this['__decorate']||function(_0x5792bc,_0x3d2d2c,_0x33cbb6,_0x1ef846){const _0x3ddca4=a173_0x37ec;var _0x282e35=arguments['length'],_0x40f839=_0x282e35<0x3?_0x3d2d2c:_0x1ef846===null?_0x1ef846=Object[_0x3ddca4(0x236)](_0x3d2d2c,_0x33cbb6):_0x1ef846,_0x21347a;if(typeof Reflect===_0x3ddca4(0x20a)&&typeof Reflect[_0x3ddca4(0x265)]===_0x3ddca4(0x20c))_0x40f839=Reflect[_0x3ddca4(0x265)](_0x5792bc,_0x3d2d2c,_0x33cbb6,_0x1ef846);else{for(var _0x3ae20e=_0x5792bc[_0x3ddca4(0x25b)]-0x1;_0x3ae20e>=0x0;_0x3ae20e--)if(_0x21347a=_0x5792bc[_0x3ae20e])_0x40f839=(_0x282e35<0x3?_0x21347a(_0x40f839):_0x282e35>0x3?_0x21347a(_0x3d2d2c,_0x33cbb6,_0x40f839):_0x21347a(_0x3d2d2c,_0x33cbb6))||_0x40f839;}return _0x282e35>0x3&&_0x40f839&&Object[_0x3ddca4(0x233)](_0x3d2d2c,_0x33cbb6,_0x40f839),_0x40f839;},__metadata=this&&this['__metadata']||function(_0x1e9457,_0xc8487a){const _0x57b5f0=a173_0x37ec;if(typeof Reflect===_0x57b5f0(0x20a)&&typeof Reflect['metadata']===_0x57b5f0(0x20c))return Reflect[_0x57b5f0(0x1fe)](_0x1e9457,_0xc8487a);},__param=this&&this['__param']||function(_0x1ba36b,_0x361f69){return function(_0x26e424,_0x2acb3b){_0x361f69(_0x26e424,_0x2acb3b,_0x1ba36b);};};Object[a173_0x2e0e6f(0x233)](exports,a173_0x2e0e6f(0x26e),{'value':!![]}),exports[a173_0x2e0e6f(0x24e)]=exports['DELETE_FILE_TYPE']=exports[a173_0x2e0e6f(0x1e5)]=exports['MEDIA_FILE_CHANNEL']=void 0x0;const common_1=require(a173_0x2e0e6f(0x21a)),mongoose_1=require(a173_0x2e0e6f(0x1e8)),nestjs_config_1=require(a173_0x2e0e6f(0x256)),kernel_1=require('../../../kernel'),fs_1=require('fs'),jwt=require(a173_0x2e0e6f(0x1ea)),path_1=require(a173_0x2e0e6f(0x222)),dtos_1=require(a173_0x2e0e6f(0x248)),dtos_2=require(a173_0x2e0e6f(0x241)),providers_1=require(a173_0x2e0e6f(0x258)),dtos_3=require(a173_0x2e0e6f(0x1f9)),image_service_1=require('./image.service'),video_service_1=require(a173_0x2e0e6f(0x229)),no_file_exception_1=require(a173_0x2e0e6f(0x1fb)),VIDEO_QUEUE_CHANNEL='VIDEO_PROCESS',PHOTO_QUEUE_CHANNEL=a173_0x2e0e6f(0x1f3);exports['MEDIA_FILE_CHANNEL']=a173_0x2e0e6f(0x271),exports[a173_0x2e0e6f(0x1e5)]={'VIDEO_PROCSSED':a173_0x2e0e6f(0x1ee),'PHOTO_PROCESSED':a173_0x2e0e6f(0x23e),'FILE_RELATED_MODULE_UPDATED':a173_0x2e0e6f(0x23f),'ASSETS_ITEM_DELETED':a173_0x2e0e6f(0x247)},exports[a173_0x2e0e6f(0x24f)]={'FILEID':a173_0x2e0e6f(0x237),'FILE_PATH':'FILE_PATH'};function a173_0x37ec(_0x254f53,_0x4b603b){return a173_0x37ec=function(_0x120e7d,_0x37ecb5){_0x120e7d=_0x120e7d-0x1dc;let _0x58736b=a173_0x120e[_0x120e7d];return _0x58736b;},a173_0x37ec(_0x254f53,_0x4b603b);}let FileService=class FileService{constructor(_0x9e73d8,_0x50ea83,_0x4db6ac,_0x37f595,_0xebaf3d){const _0x295820=a173_0x2e0e6f;this[_0x295820(0x209)]=_0x9e73d8,this[_0x295820(0x1e7)]=_0x50ea83,this['imageService']=_0x4db6ac,this['videoService']=_0x37f595,this[_0x295820(0x240)]=_0xebaf3d,this[_0x295820(0x245)]=new common_1[(_0x295820(0x24d))](_0x295820(0x24e)),this['queueEventService'][_0x295820(0x261)](VIDEO_QUEUE_CHANNEL,_0x295820(0x1e6),this[_0x295820(0x1fa)]['bind'](this)),this[_0x295820(0x240)][_0x295820(0x261)](PHOTO_QUEUE_CHANNEL,_0x295820(0x1e4),this[_0x295820(0x235)][_0x295820(0x26b)](this)),this['queueEventService']['subscribe'](exports[_0x295820(0x271)],'DELETE_MEDIA_FILE_IF_UPDATED',this[_0x295820(0x255)][_0x295820(0x26b)](this)),this[_0x295820(0x240)]['subscribe'](exports[_0x295820(0x271)],_0x295820(0x23d),this[_0x295820(0x1f4)][_0x295820(0x26b)](this));}async['findById'](_0x5948e3){const _0x26bb70=a173_0x2e0e6f,_0xd1c201=await this['fileModel'][_0x26bb70(0x243)](_0x5948e3);return _0xd1c201?new dtos_3[(_0x26bb70(0x20e))](_0xd1c201):null;}async[a173_0x2e0e6f(0x1ff)](_0x195c33){const _0xcd68dc=a173_0x2e0e6f,_0x64b80f=await this[_0xcd68dc(0x1e7)]['find']({'_id':{'$in':_0x195c33}});return _0x64b80f[_0xcd68dc(0x24c)](_0xca5d76=>new dtos_3[(_0xcd68dc(0x20e))](_0xca5d76));}async[a173_0x2e0e6f(0x232)](_0x45222f,_0x89d6c6,_0x259825){const _0x238880=a173_0x2e0e6f,_0x313e48=Object[_0x238880(0x273)]({},_0x259825)||{},_0x383788=this[_0x238880(0x209)][_0x238880(0x25f)](_0x238880(0x1f5));if(_0x313e48[_0x238880(0x22d)]){const _0x39eb2d=await this[_0x238880(0x264)][_0x238880(0x22d)](_0x89d6c6[_0x238880(0x222)]);fs_1['unlinkSync'](_0x89d6c6[_0x238880(0x222)]),fs_1['writeFileSync'](_0x89d6c6['path'],_0x39eb2d);}if(_0x313e48[_0x238880(0x234)]&&_0x313e48[_0x238880(0x270)]&&_0x313e48[_0x238880(0x1dc)]){const _0x50aed3=await this[_0x238880(0x264)][_0x238880(0x22e)](_0x89d6c6[_0x238880(0x222)],_0x313e48['thumbnailSize']);fs_1[_0x238880(0x202)](_0x89d6c6[_0x238880(0x222)]),fs_1['writeFileSync'](_0x89d6c6[_0x238880(0x222)],_0x50aed3);}const _0x189c13={'type':_0x45222f,'name':_0x89d6c6[_0x238880(0x218)],'description':'','mimeType':_0x89d6c6[_0x238880(0x1f7)],'server':_0x313e48['server']||'local','path':_0x89d6c6[_0x238880(0x222)][_0x238880(0x22c)](_0x383788,''),'absolutePath':_0x89d6c6[_0x238880(0x222)],'size':_0x89d6c6[_0x238880(0x22a)],'createdAt':new Date(),'updatedAt':new Date(),'createdBy':_0x313e48['uploader']?_0x313e48[_0x238880(0x259)][_0x238880(0x266)]:null,'updatedBy':_0x313e48[_0x238880(0x259)]?_0x313e48[_0x238880(0x259)][_0x238880(0x266)]:null},_0x4d84d9=await this[_0x238880(0x1e7)][_0x238880(0x1e1)](_0x189c13);return dtos_3[_0x238880(0x20e)]['fromModel'](_0x4d84d9);}async['addRef'](_0x22c4fb,_0x11a1f3){const _0x11fa4c=a173_0x2e0e6f;return this[_0x11fa4c(0x1e7)]['updateOne']({'_id':_0x22c4fb},{'$addToSet':{'refItems':_0x11a1f3}});}async[a173_0x2e0e6f(0x206)](_0x5e34c0){const _0x4b2ba9=a173_0x2e0e6f,_0x2eaedf=await this['fileModel'][_0x4b2ba9(0x26a)]({'_id':_0x5e34c0});if(!_0x2eaedf)throw new kernel_1[(_0x4b2ba9(0x246))]();const _0x2f49c2=[{'absolutePath':_0x2eaedf['absolutePath'],'path':_0x2eaedf[_0x4b2ba9(0x222)]}][_0x4b2ba9(0x200)](_0x2eaedf[_0x4b2ba9(0x254)]||[]);return _0x2f49c2['forEach'](_0x1cac40=>{const _0x3d4aeb=_0x4b2ba9;if(fs_1[_0x3d4aeb(0x220)](_0x1cac40[_0x3d4aeb(0x20b)]))fs_1['unlinkSync'](_0x1cac40[_0x3d4aeb(0x20b)]);else{const _0x68febe=this[_0x3d4aeb(0x209)][_0x3d4aeb(0x25f)](_0x3d4aeb(0x1f5)),_0x188509=path_1[_0x3d4aeb(0x251)](_0x68febe,_0x1cac40['path']);fs_1['existsSync'](_0x188509)&&fs_1['unlinkSync'](_0x188509);}}),!![];}async[a173_0x2e0e6f(0x249)](_0x23f559){const _0x3d2644=a173_0x2e0e6f,_0xaa3dd8=await this[_0x3d2644(0x1e7)]['findOne']({'_id':_0x23f559});if(!_0xaa3dd8)throw new kernel_1[(_0x3d2644(0x246))]();if(_0xaa3dd8[_0x3d2644(0x20d)]&&!_0xaa3dd8[_0x3d2644(0x20d)][_0x3d2644(0x25b)])return![];if(fs_1[_0x3d2644(0x220)](_0xaa3dd8['absolutePath']))fs_1[_0x3d2644(0x202)](_0xaa3dd8[_0x3d2644(0x20b)]);else{const _0x1074bb=this[_0x3d2644(0x209)][_0x3d2644(0x25f)](_0x3d2644(0x1f5)),_0x414658=path_1[_0x3d2644(0x251)](_0x1074bb,_0xaa3dd8[_0x3d2644(0x222)]);fs_1[_0x3d2644(0x220)](_0x414658)&&fs_1[_0x3d2644(0x202)](_0x414658);}return!![];}async[a173_0x2e0e6f(0x1fa)](_0x553218){const _0xf6459=a173_0x2e0e6f;if(_0x553218['eventName']!=='processVideo')return;const _0x5d100e=_0x553218[_0xf6459(0x257)][_0xf6459(0x238)],_0x1ad3d0=_0x553218[_0xf6459(0x257)][_0xf6459(0x217)]||{};try{await this[_0xf6459(0x1e7)][_0xf6459(0x20f)]({'_id':_0x5d100e['_id']},{'$set':{'status':'processing'}});const _0x3af9f3=this['config']['get']('file.publicDir'),_0x14595a=this[_0xf6459(0x209)][_0xf6459(0x25f)](_0xf6459(0x230));let _0x27df44;if(fs_1[_0xf6459(0x220)](_0x5d100e[_0xf6459(0x20b)]))_0x27df44=_0x5d100e[_0xf6459(0x20b)];else fs_1[_0xf6459(0x220)](path_1[_0xf6459(0x251)](_0x3af9f3,_0x5d100e[_0xf6459(0x222)]))&&(_0x27df44=path_1[_0xf6459(0x251)](_0x3af9f3,_0x5d100e[_0xf6459(0x222)]));if(!_0x27df44)throw new no_file_exception_1[(_0xf6459(0x24a))]();const _0x586f48=await this['videoService'][_0xf6459(0x253)](_0x27df44),_0x4cb53c=_0x586f48[_0xf6459(0x260)],_0x6c025f=_0x586f48[_0xf6459(0x260)]['replace'](_0x3af9f3,''),_0x175cb1=await this['videoService'][_0xf6459(0x262)](_0x27df44,{'toFolder':_0x14595a}),_0x48b6d4=_0x175cb1[_0xf6459(0x24c)](_0x58c8a9=>({'absolutePath':path_1['join'](_0x14595a,_0x58c8a9),'path':path_1['join'](_0x14595a,_0x58c8a9)['replace'](_0x3af9f3,'')})),_0x1ff5d7=await this[_0xf6459(0x203)][_0xf6459(0x268)](_0x27df44);fs_1['existsSync'](_0x27df44)&&fs_1['unlinkSync'](_0x27df44),await this[_0xf6459(0x1e7)][_0xf6459(0x20f)]({'_id':_0x5d100e[_0xf6459(0x266)]},{'$set':{'status':'finished','absolutePath':_0x4cb53c,'path':_0x6c025f,'thumbnails':_0x48b6d4,'duration':_0x1ff5d7}});}catch(_0x5e7cf3){await this[_0xf6459(0x1e7)][_0xf6459(0x20f)]({'_id':_0x5d100e['_id']},{'$set':{'status':'error'}});throw _0x5e7cf3;}finally{_0x1ad3d0[_0xf6459(0x26f)]&&await this['queueEventService'][_0xf6459(0x211)](new kernel_1[(_0xf6459(0x23a))]({'channel':_0x1ad3d0['publishChannel'],'eventName':exports[_0xf6459(0x1e5)][_0xf6459(0x1ee)],'data':{'meta':_0x1ad3d0[_0xf6459(0x212)],'fileId':_0x5d100e[_0xf6459(0x266)]}}));}}async[a173_0x2e0e6f(0x228)](_0x3523df,_0x27477c){const _0x8163ec=a173_0x2e0e6f,_0x28644b=await this[_0x8163ec(0x1e7)][_0x8163ec(0x26a)]({'_id':_0x3523df});if(!_0x28644b||_0x28644b[_0x8163ec(0x242)]===_0x8163ec(0x1df))return![];return await this[_0x8163ec(0x240)][_0x8163ec(0x211)](new kernel_1[(_0x8163ec(0x23a))]({'channel':VIDEO_QUEUE_CHANNEL,'eventName':'processVideo','data':{'file':new dtos_3[(_0x8163ec(0x20e))](_0x28644b),'options':_0x27477c}})),!![];}async['queueProcessPhoto'](_0x386e3e,_0x28e718){const _0x46cea0=a173_0x2e0e6f,_0x5571ab=await this[_0x46cea0(0x1e7)]['findOne']({'_id':_0x386e3e});if(!_0x5571ab||_0x5571ab[_0x46cea0(0x242)]===_0x46cea0(0x1df))return![];return await this[_0x46cea0(0x240)][_0x46cea0(0x211)](new kernel_1[(_0x46cea0(0x23a))]({'channel':PHOTO_QUEUE_CHANNEL,'eventName':_0x46cea0(0x1dd),'data':{'file':new dtos_3['FileDto'](_0x5571ab),'options':_0x28e718}})),!![];}async['_processPhoto'](_0x2c8369){const _0x189c19=a173_0x2e0e6f;if(_0x2c8369[_0x189c19(0x252)]!==_0x189c19(0x1dd))return;const _0x3bad50=_0x2c8369[_0x189c19(0x257)][_0x189c19(0x238)],_0x3b6e65=_0x2c8369['data'][_0x189c19(0x217)]||{};try{await this[_0x189c19(0x1e7)][_0x189c19(0x20f)]({'_id':_0x3bad50['_id']},{'$set':{'status':_0x189c19(0x1df)}});const _0x1ca27c=this['config'][_0x189c19(0x25f)](_0x189c19(0x1f5)),_0x32c3bf=this['config']['get'](_0x189c19(0x272));let _0x12541e;if(fs_1[_0x189c19(0x220)](_0x3bad50[_0x189c19(0x20b)]))_0x12541e=_0x3bad50[_0x189c19(0x20b)];else fs_1[_0x189c19(0x220)](path_1['join'](_0x1ca27c,_0x3bad50[_0x189c19(0x222)]))&&(_0x12541e=path_1[_0x189c19(0x251)](_0x1ca27c,_0x3bad50[_0x189c19(0x222)]));if(!_0x12541e)throw new no_file_exception_1[(_0x189c19(0x24a))]();const _0x2449d3=await this[_0x189c19(0x264)][_0x189c19(0x1f6)](_0x12541e),_0x3318de=await this['imageService']['createThumbnail'](_0x12541e,_0x3b6e65['thumbnailSize']||{'width':0xfa,'height':0xfa}),_0x1d2c09=kernel_1[_0x189c19(0x24b)][_0x189c19(0x1f1)](0x5)+_0x189c19(0x1de)+kernel_1[_0x189c19(0x24b)][_0x189c19(0x208)](_0x12541e);fs_1[_0x189c19(0x25c)](path_1[_0x189c19(0x251)](_0x32c3bf,_0x1d2c09),_0x3318de),await this[_0x189c19(0x1e7)][_0x189c19(0x20f)]({'_id':_0x3bad50[_0x189c19(0x266)]},{'$set':{'status':_0x189c19(0x226),'width':_0x2449d3[_0x189c19(0x1fc)],'height':_0x2449d3[_0x189c19(0x223)],'thumbnails':[{'path':path_1[_0x189c19(0x251)](_0x32c3bf,_0x1d2c09)[_0x189c19(0x22c)](_0x1ca27c,''),'absolutePath':path_1[_0x189c19(0x251)](_0x32c3bf,_0x1d2c09)}]}});}catch(_0x48070c){await this[_0x189c19(0x1e7)][_0x189c19(0x20f)]({'_id':_0x3bad50[_0x189c19(0x266)]},{'$set':{'status':'error'}});throw _0x48070c;}finally{_0x3b6e65[_0x189c19(0x26f)]&&await this[_0x189c19(0x240)][_0x189c19(0x211)](new kernel_1[(_0x189c19(0x23a))]({'channel':_0x3b6e65[_0x189c19(0x26f)],'eventName':exports[_0x189c19(0x1e5)][_0x189c19(0x23e)],'data':{'meta':_0x3b6e65[_0x189c19(0x212)],'fileId':_0x3bad50[_0x189c19(0x266)]}}));}}[a173_0x2e0e6f(0x213)](_0x5389b7){const _0x4185ec=a173_0x2e0e6f,_0x4ba7e8=0x3c*0x3c*0x3;return jwt[_0x4185ec(0x225)]({'fileId':_0x5389b7},process[_0x4185ec(0x267)][_0x4185ec(0x1eb)],{'expiresIn':_0x4ba7e8});}async[a173_0x2e0e6f(0x216)](_0x558331){const _0x448284=a173_0x2e0e6f,_0x1034a7=new URL(_0x448284(0x269),kernel_1[_0x448284(0x263)](_0x448284(0x204))[_0x448284(0x215)]);return _0x1034a7[_0x448284(0x23b)][_0x448284(0x207)](_0x448284(0x1e0),this[_0x448284(0x213)](_0x558331)),_0x1034a7[_0x448284(0x1e3)];}async[a173_0x2e0e6f(0x201)](_0x506c75){const _0x1d0f97=a173_0x2e0e6f;try{const _0xd0d54e=jwt[_0x1d0f97(0x205)](_0x506c75,process[_0x1d0f97(0x267)][_0x1d0f97(0x1eb)]),_0x2c72c3=await this[_0x1d0f97(0x1e7)][_0x1d0f97(0x243)](_0xd0d54e[_0x1d0f97(0x25d)]);if(!_0x2c72c3)throw new kernel_1['EntityNotFoundException']();let _0x2f31a7;const _0x4c7c7=this['config']['get'](_0x1d0f97(0x1f5));if(fs_1[_0x1d0f97(0x220)](_0x2c72c3[_0x1d0f97(0x20b)]))_0x2f31a7=_0x2c72c3[_0x1d0f97(0x20b)];else{if(fs_1[_0x1d0f97(0x220)](path_1[_0x1d0f97(0x251)](_0x4c7c7,_0x2c72c3[_0x1d0f97(0x222)])))_0x2f31a7=path_1['join'](_0x4c7c7,_0x2c72c3[_0x1d0f97(0x222)]);else throw new kernel_1[(_0x1d0f97(0x246))]();}return{'file':_0x2c72c3,'stream':fs_1[_0x1d0f97(0x1fd)](_0x2f31a7)};}catch(_0x2c2ef5){throw new kernel_1[(_0x1d0f97(0x246))]();}}async[a173_0x2e0e6f(0x255)](_0x4a301a){const _0x2d348e=a173_0x2e0e6f;try{const {data:_0x1bc50a,eventName:_0x1f2655}=_0x4a301a;if(_0x1f2655!==exports['FILE_EVENT'][_0x2d348e(0x23f)])return;const {type:_0x47f61f,currentFile:_0x1a571b,newFile:_0x156dea}=_0x1bc50a;if(''+_0x1a571b===''+_0x156dea)return;if(_0x47f61f===exports[_0x2d348e(0x24f)][_0x2d348e(0x237)]){const _0x31e5c3=await this[_0x2d348e(0x243)](_0x1a571b);if(!_0x31e5c3)return;this[_0x2d348e(0x206)](_0x31e5c3[_0x2d348e(0x266)]);}else{if(_0x47f61f===exports[_0x2d348e(0x24f)][_0x2d348e(0x224)]){if(fs_1[_0x2d348e(0x220)](_0x1a571b))fs_1[_0x2d348e(0x202)](_0x1a571b);else{const _0x5422b7=this[_0x2d348e(0x209)][_0x2d348e(0x25f)](_0x2d348e(0x1f5)),_0xcdb2f1=path_1[_0x2d348e(0x251)](_0x5422b7,_0x1a571b);fs_1[_0x2d348e(0x220)](_0xcdb2f1)&&fs_1[_0x2d348e(0x202)](_0xcdb2f1);}}}}catch(_0x188d69){this['logger'][_0x2d348e(0x210)](_0x188d69);}}async[a173_0x2e0e6f(0x1f4)](_0x19dbdd){const _0x10bf76=a173_0x2e0e6f;try{const {data:_0x3cadfc,eventName:_0x43854b}=_0x19dbdd;if(_0x43854b!==exports[_0x10bf76(0x1e5)]['ASSETS_ITEM_DELETED'])return;const {type:_0x55a77f,metadata:_0x40266f}=_0x3cadfc;if(_0x55a77f===_0x10bf76(0x239)){const _0x53962c=new dtos_1[(_0x10bf76(0x1e9))](_0x40266f),{fileId:_0x569b6c,thumbnailId:_0x139bcc,trailerId:_0xd77ee6}=_0x53962c;await Promise[_0x10bf76(0x21c)]([_0x569b6c&&this['remove'](_0x569b6c),_0x139bcc&&this['remove'](_0x139bcc),_0xd77ee6&&this['remove'](_0xd77ee6)]);}else{if(_0x55a77f===_0x10bf76(0x21e)){}else{if(_0x55a77f===_0x10bf76(0x22f)){const _0x2ffbcb=new dtos_1[(_0x10bf76(0x1f0))](_0x40266f),{fileId:_0x130bce}=_0x2ffbcb;_0x130bce&&await this['remove'](_0x130bce);}else{if(_0x55a77f==='digital_product'){const _0x510794=new dtos_1[(_0x10bf76(0x21f))](_0x40266f),{digitalFileId:_0x314163,imageId:_0xbf9808}=_0x510794;await Promise['all']([_0x314163&&this[_0x10bf76(0x206)](_0x314163),_0xbf9808&&this[_0x10bf76(0x206)](_0xbf9808)]);}else{if(_0x55a77f===_0x10bf76(0x1ec)){const {fileId:_0x7ada79}=new dtos_2[(_0x10bf76(0x231))](_0x40266f);_0x7ada79&&await this[_0x10bf76(0x206)](_0x7ada79);}}}}}}catch(_0x275469){this[_0x10bf76(0x245)][_0x10bf76(0x210)](_0x275469);}}};FileService=__decorate([common_1[a173_0x2e0e6f(0x1ed)](),__param(0x1,common_1[a173_0x2e0e6f(0x25a)](providers_1[a173_0x2e0e6f(0x21d)])),__metadata(a173_0x2e0e6f(0x1f8),[nestjs_config_1[a173_0x2e0e6f(0x22b)],mongoose_1[a173_0x2e0e6f(0x26c)],image_service_1[a173_0x2e0e6f(0x26d)],video_service_1[a173_0x2e0e6f(0x250)],kernel_1[a173_0x2e0e6f(0x227)]])],FileService),exports[a173_0x2e0e6f(0x24e)]=FileService;