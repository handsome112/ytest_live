'use strict';const a118_0x4ec5=['FILEID','publish','../constants','height','../dtos','523525qPYxhR','all','isImage','removeIfNotHaveRef','photo','2474395HEVyUu','toObject','BannerDto','updatedBy','findOne','details','829258qGsyXJ','__param','EntityNotFoundException','merge','../../file/services','fileId','1kbmpdO','name','status','decorate','save','design:paramtypes','title','fileService','set','banner','function','@nestjs/common','FILE_EVENT','439372qWmvMz','34832dthflj','bannerModel','Model','Inject','getThumbnails','BANNER_STATUS','defineProperty','FILE_RELATED_MODULE_UPDATED','object','processing','1qMfWsi','remove','FileService','length','1156787bAvpbI','_id','10mbMGSO','updateInfo','FILE_ERROR','7Tymlee','QueueEventService','createdBy','updatedAt','MEDIA_FILE_CHANNEL','BannerService','getUrl','../../file','addRef','179022kBZAKU','../providers','metadata','mongoose','queueEventService','findById','DELETE_FILE_TYPE','BANNER_PROVIDER','forwardRef'];const a118_0x4ddf80=a118_0x24fe;function a118_0x24fe(_0x2ac12d,_0x54fd4b){return a118_0x24fe=function(_0x4ec581,_0x24fe01){_0x4ec581=_0x4ec581-0x1ad;let _0x477630=a118_0x4ec5[_0x4ec581];return _0x477630;},a118_0x24fe(_0x2ac12d,_0x54fd4b);}(function(_0x1c5d8d,_0x4f0fe3){const _0x1f9bbf=a118_0x24fe;while(!![]){try{const _0x1d314a=parseInt(_0x1f9bbf(0x1e7))*-parseInt(_0x1f9bbf(0x1ae))+parseInt(_0x1f9bbf(0x1d9))*-parseInt(_0x1f9bbf(0x1e6))+parseInt(_0x1f9bbf(0x1b1))*-parseInt(_0x1f9bbf(0x1ba))+parseInt(_0x1f9bbf(0x1c8))+parseInt(_0x1f9bbf(0x1f1))*-parseInt(_0x1f9bbf(0x1f5))+parseInt(_0x1f9bbf(0x1d3))+parseInt(_0x1f9bbf(0x1cd));if(_0x1d314a===_0x4f0fe3)break;else _0x1c5d8d['push'](_0x1c5d8d['shift']());}catch(_0xd08acd){_0x1c5d8d['push'](_0x1c5d8d['shift']());}}}(a118_0x4ec5,0x99b29));var __decorate=this&&this['__decorate']||function(_0x299abc,_0x612e30,_0x5d5c22,_0xa774b6){const _0x4441a3=a118_0x24fe;var _0x1902e3=arguments[_0x4441a3(0x1f4)],_0x4e1066=_0x1902e3<0x3?_0x612e30:_0xa774b6===null?_0xa774b6=Object['getOwnPropertyDescriptor'](_0x612e30,_0x5d5c22):_0xa774b6,_0x40093f;if(typeof Reflect===_0x4441a3(0x1ef)&&typeof Reflect[_0x4441a3(0x1dc)]==='function')_0x4e1066=Reflect['decorate'](_0x299abc,_0x612e30,_0x5d5c22,_0xa774b6);else{for(var _0x26631d=_0x299abc['length']-0x1;_0x26631d>=0x0;_0x26631d--)if(_0x40093f=_0x299abc[_0x26631d])_0x4e1066=(_0x1902e3<0x3?_0x40093f(_0x4e1066):_0x1902e3>0x3?_0x40093f(_0x612e30,_0x5d5c22,_0x4e1066):_0x40093f(_0x612e30,_0x5d5c22))||_0x4e1066;}return _0x1902e3>0x3&&_0x4e1066&&Object[_0x4441a3(0x1ed)](_0x612e30,_0x5d5c22,_0x4e1066),_0x4e1066;},__metadata=this&&this['__metadata']||function(_0x49afce,_0x5c8a6b){const _0x41c0bc=a118_0x24fe;if(typeof Reflect===_0x41c0bc(0x1ef)&&typeof Reflect[_0x41c0bc(0x1bc)]===_0x41c0bc(0x1e3))return Reflect[_0x41c0bc(0x1bc)](_0x49afce,_0x5c8a6b);},__param=this&&this[a118_0x4ddf80(0x1d4)]||function(_0x5eafd3,_0x1d1226){return function(_0x52cf4,_0x48c03c){_0x1d1226(_0x52cf4,_0x48c03c,_0x5eafd3);};};Object['defineProperty'](exports,'__esModule',{'value':!![]}),exports[a118_0x4ddf80(0x1b6)]=void 0x0;const common_1=require(a118_0x4ddf80(0x1e4)),mongoose_1=require(a118_0x4ddf80(0x1bd)),kernel_1=require('../../../kernel'),file_1=require(a118_0x4ddf80(0x1b8)),dtos_1=require('../../user/dtos'),services_1=require(a118_0x4ddf80(0x1d7)),lodash_1=require('lodash'),constants_1=require(a118_0x4ddf80(0x1c5)),dtos_2=require(a118_0x4ddf80(0x1c7)),providers_1=require(a118_0x4ddf80(0x1bb));let BannerService=class BannerService{constructor(_0xee1ee7,_0x24d399,_0x37d985){const _0x54f5c2=a118_0x4ddf80;this[_0x54f5c2(0x1e8)]=_0xee1ee7,this[_0x54f5c2(0x1e0)]=_0x24d399,this[_0x54f5c2(0x1be)]=_0x37d985;}async['upload'](_0x23d134,_0x8e55ce,_0x140935){const _0x336243=a118_0x4ddf80;if(!_0x23d134)throw new Error('File\x20is\x20valid!');if(!_0x23d134[_0x336243(0x1ca)]()){await this[_0x336243(0x1e0)][_0x336243(0x1cb)](_0x23d134[_0x336243(0x1ad)]);throw new Error('Invalid\x20image!');}const _0x3c5f5f=new this[(_0x336243(0x1e8))](_0x8e55ce);if(!_0x3c5f5f[_0x336243(0x1df)])_0x3c5f5f[_0x336243(0x1df)]=_0x23d134[_0x336243(0x1da)];_0x3c5f5f[_0x336243(0x1d8)]=_0x23d134['_id'],_0x3c5f5f['createdAt']=new Date(),_0x3c5f5f['updatedAt']=new Date();_0x140935&&(_0x3c5f5f[_0x336243(0x1b3)]=_0x140935[_0x336243(0x1ad)],_0x3c5f5f[_0x336243(0x1d0)]=_0x140935[_0x336243(0x1ad)]);_0x3c5f5f['processing']=![],await _0x3c5f5f['save'](),await Promise[_0x336243(0x1c9)]([this[_0x336243(0x1e0)][_0x336243(0x1b9)](_0x23d134[_0x336243(0x1ad)],{'itemType':'banner','itemId':_0x3c5f5f['_id']})]);const _0x508579=new dtos_2[(_0x336243(0x1cf))](_0x3c5f5f);return _0x508579;}async['create'](_0x4de189,_0x385c8a){const _0x5900c8=a118_0x4ddf80,_0x12b079=new this[(_0x5900c8(0x1e8))](_0x4de189);_0x385c8a&&(_0x12b079[_0x5900c8(0x1b3)]=_0x385c8a['_id'],_0x12b079[_0x5900c8(0x1d0)]=_0x385c8a[_0x5900c8(0x1ad)]);_0x12b079[_0x5900c8(0x1f0)]=![],await _0x12b079[_0x5900c8(0x1dd)]();const _0x4e0e62=new dtos_2['BannerDto'](_0x12b079);return _0x4e0e62;}async[a118_0x4ddf80(0x1af)](_0x15a4a8,_0x4f933d,_0x1cf8ee){const _0x5eb0f9=a118_0x4ddf80,_0x54b1e3=await this['bannerModel'][_0x5eb0f9(0x1bf)](_0x15a4a8);if(!_0x54b1e3)throw new kernel_1[(_0x5eb0f9(0x1d5))]();const {fileId:_0x54fce4}=_0x54b1e3;lodash_1[_0x5eb0f9(0x1d6)](_0x54b1e3,_0x4f933d);_0x54b1e3[_0x5eb0f9(0x1db)]!==constants_1[_0x5eb0f9(0x1ec)][_0x5eb0f9(0x1b0)]&&_0x4f933d['status']!==constants_1[_0x5eb0f9(0x1ec)][_0x5eb0f9(0x1b0)]&&(_0x54b1e3['status']=_0x4f933d['status']);_0x1cf8ee&&_0x54b1e3[_0x5eb0f9(0x1e1)](_0x5eb0f9(0x1d0),_0x1cf8ee[_0x5eb0f9(0x1ad)]),_0x54b1e3[_0x5eb0f9(0x1b4)]=new Date(),await _0x54b1e3['save']();_0x54fce4&&_0x4f933d[_0x5eb0f9(0x1d8)]&&await this['queueEventService']['publish']({'channel':services_1[_0x5eb0f9(0x1b5)],'eventName':services_1[_0x5eb0f9(0x1e5)][_0x5eb0f9(0x1ee)],'data':{'type':services_1[_0x5eb0f9(0x1c0)][_0x5eb0f9(0x1c3)],'currentFile':_0x54fce4,'newFile':_0x4f933d[_0x5eb0f9(0x1d8)]}});const _0x21be46=new dtos_2['BannerDto'](_0x54b1e3);return _0x21be46;}async[a118_0x4ddf80(0x1d2)](_0x2ec7c9,_0x318ecd){const _0x245482=a118_0x4ddf80,_0x50ba06=await this[_0x245482(0x1e8)][_0x245482(0x1d1)]({'_id':_0x2ec7c9});if(!_0x50ba06)throw new kernel_1[(_0x245482(0x1d5))]();const _0xeb1864=new dtos_2[(_0x245482(0x1cf))](_0x50ba06),[_0x38c660]=await Promise[_0x245482(0x1c9)]([_0x50ba06[_0x245482(0x1d8)]?this[_0x245482(0x1e0)][_0x245482(0x1bf)](_0x50ba06['fileId']):null]);return _0x38c660&&(_0xeb1864[_0x245482(0x1cc)]={'url':_0x38c660[_0x245482(0x1b7)](),'thumbnails':_0x38c660[_0x245482(0x1eb)](),'width':_0x38c660['width'],'height':_0x38c660[_0x245482(0x1c6)]}),_0xeb1864;}async['delete'](_0x3901a8){const _0x248173=a118_0x4ddf80,_0x59482b=await this[_0x248173(0x1e8)][_0x248173(0x1bf)](_0x3901a8);if(!_0x59482b)throw new kernel_1['EntityNotFoundException']();return await _0x59482b[_0x248173(0x1f2)](),await this['queueEventService'][_0x248173(0x1c4)]({'channel':services_1[_0x248173(0x1b5)],'eventName':services_1['FILE_EVENT']['ASSETS_ITEM_DELETED'],'data':{'type':_0x248173(0x1e2),'metadata':_0x59482b[_0x248173(0x1ce)]()}}),!![];}};BannerService=__decorate([common_1['Injectable'](),__param(0x0,common_1[a118_0x4ddf80(0x1ea)](providers_1[a118_0x4ddf80(0x1c1)])),__param(0x1,common_1[a118_0x4ddf80(0x1ea)](common_1[a118_0x4ddf80(0x1c2)](()=>services_1['FileService']))),__metadata(a118_0x4ddf80(0x1de),[mongoose_1[a118_0x4ddf80(0x1e9)],services_1[a118_0x4ddf80(0x1f3)],kernel_1[a118_0x4ddf80(0x1b2)]])],BannerService),exports['BannerService']=BannerService;