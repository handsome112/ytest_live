'use strict';const a386_0x5140=['FILE_EVENT','deleteManyByIds','../constants','subscribe','3WBULMw','../providers','MEDIA_FILE_CHANNEL','981793MbYICJ','PERFORMER_PHOTO_CHANNEL','queueEventService','38645qbrxSw','includes','CREATED','3LfqTkC','error','mongoose','__metadata','__esModule','handleDeleteGallery','length','all','249168PVfsVO','toString','Model','PhotoService','publish','Injectable','QueueEvent','1441493ofyzdm','galleryModel','decorate','@nestjs/common','handlePhotoCount','defineProperty','design:paramtypes','../../file/services','ACTIVE','map','DELETE_FILE_TYPE','../../../kernel','logger','data','19LKEDGL','_id','__decorate','function','15lcmvZJ','PHOTO_STATUS','log','find','44008KabvXd','460246NeXhLN','FILE_RELATED_MODULE_UPDATED','object','FileService','DELETED','UPDATED','221689jUSZgN','photoService','EVENT','HANDLE_DELETE_GALLERY','updateOne','PerformerAssetsListener','Logger','metadata'];const a386_0x17f16c=a386_0xb4d4;(function(_0x20ca49,_0x244214){const _0x2fd8fe=a386_0xb4d4;while(!![]){try{const _0xd574da=-parseInt(_0x2fd8fe(0x118))+-parseInt(_0x2fd8fe(0x10f))*parseInt(_0x2fd8fe(0xef))+-parseInt(_0x2fd8fe(0xec))+-parseInt(_0x2fd8fe(0xfa))+parseInt(_0x2fd8fe(0x113))*-parseInt(_0x2fd8fe(0x117))+parseInt(_0x2fd8fe(0xf2))*-parseInt(_0x2fd8fe(0x11e))+parseInt(_0x2fd8fe(0xe9))*parseInt(_0x2fd8fe(0x101));if(_0xd574da===_0x244214)break;else _0x20ca49['push'](_0x20ca49['shift']());}catch(_0x4b2475){_0x20ca49['push'](_0x20ca49['shift']());}}}(a386_0x5140,0x8c186));function a386_0xb4d4(_0x1ec0c1,_0x413e59){return a386_0xb4d4=function(_0x5140dc,_0xb4d464){_0x5140dc=_0x5140dc-0xde;let _0x52b1a7=a386_0x5140[_0x5140dc];return _0x52b1a7;},a386_0xb4d4(_0x1ec0c1,_0x413e59);}var __decorate=this&&this[a386_0x17f16c(0x111)]||function(_0x1c09c2,_0x36edd0,_0x98490e,_0x198241){const _0x2447c9=a386_0x17f16c;var _0x3d6ffc=arguments[_0x2447c9(0xf8)],_0x3695a0=_0x3d6ffc<0x3?_0x36edd0:_0x198241===null?_0x198241=Object['getOwnPropertyDescriptor'](_0x36edd0,_0x98490e):_0x198241,_0x3f6bd7;if(typeof Reflect===_0x2447c9(0x11a)&&typeof Reflect[_0x2447c9(0x103)]==='function')_0x3695a0=Reflect['decorate'](_0x1c09c2,_0x36edd0,_0x98490e,_0x198241);else{for(var _0x2a8e0e=_0x1c09c2[_0x2447c9(0xf8)]-0x1;_0x2a8e0e>=0x0;_0x2a8e0e--)if(_0x3f6bd7=_0x1c09c2[_0x2a8e0e])_0x3695a0=(_0x3d6ffc<0x3?_0x3f6bd7(_0x3695a0):_0x3d6ffc>0x3?_0x3f6bd7(_0x36edd0,_0x98490e,_0x3695a0):_0x3f6bd7(_0x36edd0,_0x98490e))||_0x3695a0;}return _0x3d6ffc>0x3&&_0x3695a0&&Object[_0x2447c9(0x106)](_0x36edd0,_0x98490e,_0x3695a0),_0x3695a0;},__metadata=this&&this[a386_0x17f16c(0xf5)]||function(_0x360cc3,_0x55bb6c){const _0x13002f=a386_0x17f16c;if(typeof Reflect===_0x13002f(0x11a)&&typeof Reflect['metadata']===_0x13002f(0x112))return Reflect[_0x13002f(0xe4)](_0x360cc3,_0x55bb6c);},__param=this&&this['__param']||function(_0x3fe4a4,_0x8fceab){return function(_0x54d863,_0x28eac8){_0x8fceab(_0x54d863,_0x28eac8,_0x3fe4a4);};};Object[a386_0x17f16c(0x106)](exports,a386_0x17f16c(0xf6),{'value':!![]}),exports[a386_0x17f16c(0xe2)]=void 0x0;const common_1=require(a386_0x17f16c(0x104)),kernel_1=require(a386_0x17f16c(0x10c)),constants_1=require(a386_0x17f16c(0xe7)),constants_2=require('../../../kernel/constants'),mongoose_1=require(a386_0x17f16c(0xf4)),services_1=require(a386_0x17f16c(0x108)),constants_3=require('../constants'),providers_1=require(a386_0x17f16c(0xea)),services_2=require('../services'),HANDLE_PHOTO_COUNT_FOR_GALLERY='HANDLE_PHOTO_COUNT_FOR_GALLERY',HANDLE_DELETE_GALLERY=a386_0x17f16c(0xe0);let PerformerAssetsListener=class PerformerAssetsListener{constructor(_0x354368,_0xadd39,_0x34a1f6){const _0xeef61e=a386_0x17f16c;this[_0xeef61e(0xee)]=_0x354368,this[_0xeef61e(0xde)]=_0xadd39,this['galleryModel']=_0x34a1f6,this[_0xeef61e(0x10d)]=new common_1[(_0xeef61e(0xe3))](_0xeef61e(0x11b)),this['queueEventService'][_0xeef61e(0xe8)](constants_3[_0xeef61e(0xed)],HANDLE_PHOTO_COUNT_FOR_GALLERY,this[_0xeef61e(0x105)]['bind'](this)),this['queueEventService']['subscribe'](constants_3['PERFORMER_GALLERY_CHANNEL'],HANDLE_DELETE_GALLERY,this['handleDeleteGallery']['bind'](this));}async[a386_0x17f16c(0x105)](_0x3a4ca0){const _0x5b859b=a386_0x17f16c;try{const {eventName:_0x3d732f}=_0x3a4ca0;if(![constants_2['EVENT'][_0x5b859b(0xf1)],constants_2[_0x5b859b(0xdf)][_0x5b859b(0x11c)],constants_2['EVENT'][_0x5b859b(0x11d)]][_0x5b859b(0xf0)](_0x3d732f))return;const {galleryId:_0x3f167d,status:_0x464642,oldStatus:_0x4d7a8f,oldGallery:_0x22c0d0}=_0x3a4ca0[_0x5b859b(0x10e)],_0x1eb03f=_0x22c0d0&&_0x22c0d0[_0x5b859b(0xfb)]()!==_0x3f167d[_0x5b859b(0xfb)]();let _0x4fae7b=0x0;switch(_0x3d732f){case constants_2['EVENT'][_0x5b859b(0xf1)]:if(_0x464642===constants_1[_0x5b859b(0x114)][_0x5b859b(0x109)])_0x4fae7b=0x1;break;case constants_2[_0x5b859b(0xdf)][_0x5b859b(0x11d)]:if(_0x1eb03f)return;if(_0x4d7a8f!==constants_1[_0x5b859b(0x114)][_0x5b859b(0x109)]&&_0x464642===constants_1[_0x5b859b(0x114)]['ACTIVE'])_0x4fae7b=0x1;if(_0x4d7a8f===constants_1[_0x5b859b(0x114)][_0x5b859b(0x109)]&&_0x464642!==constants_1[_0x5b859b(0x114)][_0x5b859b(0x109)])_0x4fae7b=-0x1;break;case constants_2['EVENT']['DELETED']:if(_0x464642===constants_1[_0x5b859b(0x114)][_0x5b859b(0x109)])_0x4fae7b=-0x1;break;default:break;}_0x1eb03f&&_0x3d732f===constants_2[_0x5b859b(0xdf)][_0x5b859b(0x11d)]&&await Promise[_0x5b859b(0xf9)]([_0x4d7a8f===constants_1[_0x5b859b(0x114)][_0x5b859b(0x109)]?this[_0x5b859b(0x102)][_0x5b859b(0xe1)]({'_id':_0x22c0d0},{'$inc':{'numOfItems':-0x1}}):null,_0x464642===constants_1[_0x5b859b(0x114)][_0x5b859b(0x109)]?this['galleryModel']['updateOne']({'_id':_0x3f167d},{'$inc':{'numOfItems':0x1}}):null]),_0x4fae7b&&await this[_0x5b859b(0x102)][_0x5b859b(0xe1)]({'_id':_0x3f167d},{'$inc':{'numOfItems':_0x4fae7b}});}catch(_0x26d3b8){console[_0x5b859b(0x115)](_0x26d3b8);}}async[a386_0x17f16c(0xf7)](_0x1219c9){const _0x22c314=a386_0x17f16c;try{const {eventName:_0x4d526a,data:_0xe80193}=_0x1219c9;if(![constants_2[_0x22c314(0xdf)][_0x22c314(0x11c)]]['includes'](_0x4d526a))return;const {galleryId:_0x2b2a77}=_0xe80193;if(!_0x2b2a77)return;const _0x4a61bd=await this['photoService'][_0x22c314(0x116)]({'galleryId':_0x2b2a77});if(_0x4a61bd[_0x22c314(0xf8)]){const _0x15a9aa=_0x4a61bd[_0x22c314(0x10a)](_0x3632ec=>_0x3632ec[_0x22c314(0x110)]),_0x451813=_0x4a61bd[_0x22c314(0x10a)](_0x28e881=>_0x28e881['fileId']);await this['photoService'][_0x22c314(0xe6)](_0x15a9aa);for(const _0x3b48f0 of _0x451813){this[_0x22c314(0xee)][_0x22c314(0xfe)](new kernel_1[(_0x22c314(0x100))]({'channel':services_1[_0x22c314(0xeb)],'eventName':services_1[_0x22c314(0xe5)][_0x22c314(0x119)],'data':{'type':services_1[_0x22c314(0x10b)]['FILEID'],'currentFile':_0x3b48f0}}));}}}catch(_0x4d0ef7){this[_0x22c314(0x10d)][_0x22c314(0xf3)](_0x4d0ef7);}}};PerformerAssetsListener=__decorate([common_1[a386_0x17f16c(0xff)](),__param(0x2,common_1['Inject'](providers_1['PERFORMER_GALLERY_MODEL_PROVIDER'])),__metadata(a386_0x17f16c(0x107),[kernel_1['QueueEventService'],services_2[a386_0x17f16c(0xfd)],mongoose_1[a386_0x17f16c(0xfc)]])],PerformerAssetsListener),exports[a386_0x17f16c(0xe2)]=PerformerAssetsListener;