'use strict';const a189_0x5b44=['existsSync','359113UaHXJb','1ysFmNV','emails','save','MailerService','readFileSync','template','settingService','mailerQueue','init','452863NIhDaF','user','render','utf8','ADMIN_EMAIL','createInstance','Inject','2GMhXbC','subject','bind','47XcQkYb','data','content','log','createTransport','259423eidFCD','mail_error','Hello,\x20this\x20is\x20test\x20email!','findOne','../../settings/constants','findById','layouts/','path','replace','EmailTemplate','function','pass','defineProperty','../../../kernel','getTemplate','1043463mXDKDV','MAILER_CONCURRENCY','verify','length','EmailVerificationFailureException','EMAIL_TEMPLATE_PROVIDER','MAILER_QUEUE','_settingCache','[[BODY]]','isArray','mongoose','SITENAME','Injectable','process','SettingService','object','createJob','getTransport','@nestjs/common','design:paramtypes','decorate','Model','sendMail','__decorate','__metadata','DOMAIN','join','SITE_NAME','find','updateTemplate','getKeyValue','EntityNotFoundException','../../settings','.html','layout','env','port','auth','1PDvHPC','mustache','__param','QueueService','assign','StringHelper','6502rVHIRT','queueService','layouts','550666yEaWzV','metadata','host','__esModule','1068260SyJAdb','SETTING_KEYS'];const a189_0x421a01=a189_0x4187;function a189_0x4187(_0x5525c0,_0x324300){return a189_0x4187=function(_0x5b4402,_0x418759){_0x5b4402=_0x5b4402-0xab;let _0x5e11a6=a189_0x5b44[_0x5b4402];return _0x5e11a6;},a189_0x4187(_0x5525c0,_0x324300);}(function(_0x5de254,_0x38679b){const _0x54797f=a189_0x4187;while(!![]){try{const _0x4216dc=-parseInt(_0x54797f(0xdd))+-parseInt(_0x54797f(0xe1))+-parseInt(_0x54797f(0xe4))+-parseInt(_0x54797f(0xe5))*parseInt(_0x54797f(0xfd))+-parseInt(_0x54797f(0xf8))*-parseInt(_0x54797f(0xda))+-parseInt(_0x54797f(0xd4))*-parseInt(_0x54797f(0xee))+-parseInt(_0x54797f(0xf5))*-parseInt(_0x54797f(0xae));if(_0x4216dc===_0x38679b)break;else _0x5de254['push'](_0x5de254['shift']());}catch(_0x5abf50){_0x5de254['push'](_0x5de254['shift']());}}}(a189_0x5b44,0x946b1));var __decorate=this&&this[a189_0x421a01(0xc5)]||function(_0x45f868,_0x2b35c1,_0x5c9e28,_0x2ec2dc){const _0x9c8a18=a189_0x421a01;var _0x1555eb=arguments[_0x9c8a18(0xb1)],_0x529a9c=_0x1555eb<0x3?_0x2b35c1:_0x2ec2dc===null?_0x2ec2dc=Object['getOwnPropertyDescriptor'](_0x2b35c1,_0x5c9e28):_0x2ec2dc,_0x5a564d;if(typeof Reflect===_0x9c8a18(0xbd)&&typeof Reflect['decorate']==='function')_0x529a9c=Reflect[_0x9c8a18(0xc2)](_0x45f868,_0x2b35c1,_0x5c9e28,_0x2ec2dc);else{for(var _0x4300de=_0x45f868[_0x9c8a18(0xb1)]-0x1;_0x4300de>=0x0;_0x4300de--)if(_0x5a564d=_0x45f868[_0x4300de])_0x529a9c=(_0x1555eb<0x3?_0x5a564d(_0x529a9c):_0x1555eb>0x3?_0x5a564d(_0x2b35c1,_0x5c9e28,_0x529a9c):_0x5a564d(_0x2b35c1,_0x5c9e28))||_0x529a9c;}return _0x1555eb>0x3&&_0x529a9c&&Object[_0x9c8a18(0xab)](_0x2b35c1,_0x5c9e28,_0x529a9c),_0x529a9c;},__metadata=this&&this[a189_0x421a01(0xc6)]||function(_0x2420d8,_0x488222){const _0x214c87=a189_0x421a01;if(typeof Reflect===_0x214c87(0xbd)&&typeof Reflect[_0x214c87(0xde)]===_0x214c87(0x107))return Reflect['metadata'](_0x2420d8,_0x488222);},__param=this&&this[a189_0x421a01(0xd6)]||function(_0x4eb4d2,_0x186d0f){return function(_0x132f08,_0x3749b9){_0x186d0f(_0x132f08,_0x3749b9,_0x4eb4d2);};};Object[a189_0x421a01(0xab)](exports,a189_0x421a01(0xe0),{'value':!![]}),exports[a189_0x421a01(0xe8)]=void 0x0;const common_1=require(a189_0x421a01(0xc0)),kernel_1=require(a189_0x421a01(0xac)),nodemailer_1=require('nodemailer'),settings_1=require(a189_0x421a01(0xce)),fs_1=require('fs'),path_1=require(a189_0x421a01(0x104)),mustache_1=require(a189_0x421a01(0xd5)),constants_1=require(a189_0x421a01(0x101)),mongoose_1=require(a189_0x421a01(0xb8)),exceptions_1=require('../exceptions'),providers_1=require('../providers'),TEMPLATE_DIR=path_1['join'](process[a189_0x421a01(0xd1)]['TEMPLATE_DIR'],a189_0x421a01(0xe6));let MailerService=class MailerService{constructor(_0x29c075,_0x5f0cf6,_0xa0effe){const _0x3f7f36=a189_0x421a01;this[_0x3f7f36(0xdb)]=_0x29c075,this[_0x3f7f36(0xeb)]=_0x5f0cf6,this[_0x3f7f36(0x106)]=_0xa0effe,this[_0x3f7f36(0xed)]();}async['init'](){const _0x5e8522=a189_0x421a01;this[_0x5e8522(0xec)]=this['queueService'][_0x5e8522(0xf3)](_0x5e8522(0xb4)),this[_0x5e8522(0xec)][_0x5e8522(0xbb)](process[_0x5e8522(0xd1)][_0x5e8522(0xaf)]||0x1,this[_0x5e8522(0xbb)][_0x5e8522(0xf7)](this));}async[a189_0x421a01(0xbf)](){const _0x21afb2=a189_0x421a01,_0x5bc7f5=await this[_0x21afb2(0xeb)]['getKeyValue'](constants_1[_0x21afb2(0xe2)]['SMTP_TRANSPORTER']);if(!_0x5bc7f5||!_0x5bc7f5[_0x21afb2(0xdf)]||!_0x5bc7f5[_0x21afb2(0xd3)]||!_0x5bc7f5[_0x21afb2(0xd2)]||!_0x5bc7f5[_0x21afb2(0xd3)][_0x21afb2(0xef)]||!_0x5bc7f5[_0x21afb2(0xd3)][_0x21afb2(0x108)])throw new common_1['HttpException']('Invalid\x20confirguration!',0x190);return _0x5bc7f5[_0x21afb2(0xd2)]=parseInt(_0x5bc7f5[_0x21afb2(0xd2)],0xa),nodemailer_1[_0x21afb2(0xfc)](_0x5bc7f5);}async['getTemplate'](_0x15e266='default',_0x4ea0b6=![]){const _0x4aea8b=a189_0x421a01,_0x24f2fa=await this[_0x4aea8b(0x106)][_0x4aea8b(0x100)]({'key':_0x4ea0b6?_0x4aea8b(0x103)+_0x15e266:_0x15e266});if(_0x24f2fa)return _0x24f2fa[_0x4aea8b(0xfa)];_0x15e266=kernel_1[_0x4aea8b(0xd9)]['getFileName'](_0x15e266,!![]);if(_0x15e266==='blank')return _0x4ea0b6?_0x4aea8b(0xb6):'';const _0x4ddded=_0x4ea0b6?path_1[_0x4aea8b(0xc8)](TEMPLATE_DIR,_0x4aea8b(0xdc),_0x15e266+_0x4aea8b(0xcf)):path_1[_0x4aea8b(0xc8)](TEMPLATE_DIR,_0x15e266+_0x4aea8b(0xcf));if(!fs_1[_0x4aea8b(0xe3)](_0x4ddded))return _0x4ea0b6?_0x4aea8b(0xb6):'';return fs_1[_0x4aea8b(0xe9)](_0x4ddded,_0x4aea8b(0xf1));}async['process'](_0x52ff9e,_0x343db3){const _0x3abf8d=a189_0x421a01;try{const _0x33bbd3=await this[_0x3abf8d(0xbf)](),_0x499516=_0x52ff9e[_0x3abf8d(0xf9)];let {html:_0x20cff9}=_0x499516,_0x3352ec=_0x3abf8d(0xb6),_0x57c8c6='';if(!_0x20cff9&&_0x499516[_0x3abf8d(0xea)]){const _0x56a247=await this[_0x3abf8d(0x106)][_0x3abf8d(0x100)]({'key':{'$in':[_0x499516[_0x3abf8d(0xea)],_0x499516[_0x3abf8d(0xea)]+_0x3abf8d(0xcf)]}});!_0x56a247?(_0x20cff9='',_0x3352ec=await this[_0x3abf8d(0xad)](_0x499516['layout'],!![])):(_0x20cff9=_0x56a247['content'],_0x57c8c6=_0x56a247[_0x3abf8d(0xf6)],_0x3352ec=_0x56a247[_0x3abf8d(0xd0)]?await this[_0x3abf8d(0xad)](_0x56a247[_0x3abf8d(0xd0)],!![]):'[[BODY]]');}const _0x37fd9f=settings_1[_0x3abf8d(0xbc)][_0x3abf8d(0xb5)],_0x2e8661=_0x20cff9?mustache_1[_0x3abf8d(0xf0)](_0x20cff9,Object['assign'](Object[_0x3abf8d(0xd8)]({},_0x499516[_0x3abf8d(0xf9)]),{'settings':_0x37fd9f})):'',_0x52bc6d=await this[_0x3abf8d(0xeb)][_0x3abf8d(0xcc)](constants_1['SETTING_KEYS'][_0x3abf8d(0xc9)]),_0x44a221=await this[_0x3abf8d(0xeb)][_0x3abf8d(0xcc)](constants_1[_0x3abf8d(0xe2)]['LOGO_URL']);_0x20cff9=mustache_1[_0x3abf8d(0xf0)](_0x3352ec,{'siteName':_0x52bc6d||process['env'][_0x3abf8d(0xb9)]||process[_0x3abf8d(0xd1)][_0x3abf8d(0xc7)],'logoUrl':_0x44a221,'subject':_0x57c8c6||_0x499516[_0x3abf8d(0xf6)]})[_0x3abf8d(0x105)](_0x3abf8d(0xb6),_0x2e8661);const _0x40972a=await this[_0x3abf8d(0xeb)]['getKeyValue'](constants_1[_0x3abf8d(0xe2)]['SENDER_EMAIL']),_0x7ca527=_0x40972a||process[_0x3abf8d(0xd1)]['SENDER_EMAIL'];await _0x33bbd3[_0x3abf8d(0xc4)]({'from':_0x7ca527,'to':Array[_0x3abf8d(0xb7)](_0x499516['to'])?_0x499516['to']['join'](','):_0x499516['to'],'cc':Array[_0x3abf8d(0xb7)](_0x499516['cc'])?_0x499516['cc'][_0x3abf8d(0xc8)](','):_0x499516['cc'],'bcc':Array[_0x3abf8d(0xb7)](_0x499516['cc'])?_0x499516['cc']['join'](','):_0x499516['cc'],'subject':_0x57c8c6||_0x499516[_0x3abf8d(0xf6)],'html':_0x20cff9});}catch(_0x122ade){console[_0x3abf8d(0xfb)](_0x3abf8d(0xfe),_0x122ade);}finally{_0x343db3();}}async['send'](_0x1b0a01){const _0x4d997a=a189_0x421a01;await this[_0x4d997a(0xec)][_0x4d997a(0xbe)](_0x1b0a01)[_0x4d997a(0xe7)]();}async[a189_0x421a01(0xb0)](){const _0x4a2adb=a189_0x421a01;try{const _0x1624f3=await this[_0x4a2adb(0xbf)](),_0x151944=await this[_0x4a2adb(0xeb)][_0x4a2adb(0xcc)](constants_1[_0x4a2adb(0xe2)][_0x4a2adb(0xc9)])||process[_0x4a2adb(0xd1)][_0x4a2adb(0xc7)],_0x276f71=await this[_0x4a2adb(0xeb)][_0x4a2adb(0xcc)](constants_1[_0x4a2adb(0xe2)]['SENDER_EMAIL'])||process['env']['SENDER_EMAIL'],_0x4955ea=await this[_0x4a2adb(0xeb)]['getKeyValue'](constants_1[_0x4a2adb(0xe2)]['ADMIN_EMAIL'])||process['env'][_0x4a2adb(0xf2)];return _0x1624f3[_0x4a2adb(0xc4)]({'from':_0x276f71,'to':_0x4955ea,'subject':'Test\x20email\x20'+_0x151944,'html':_0x4a2adb(0xff)});}catch(_0x207797){throw new exceptions_1[(_0x4a2adb(0xb2))](_0x207797);}}async['getAllTemplates'](){const _0x19c5e8=a189_0x421a01;return this[_0x19c5e8(0x106)][_0x19c5e8(0xca)]();}async['findOne'](_0x45e987){return this['EmailTemplate']['findById'](_0x45e987);}async[a189_0x421a01(0xcb)](_0x1412c1,_0x5805a6){const _0x267266=a189_0x421a01,_0x57c09e=await this['EmailTemplate'][_0x267266(0x102)](_0x1412c1);if(!_0x57c09e)throw new kernel_1[(_0x267266(0xcd))]();return _0x57c09e['subject']=_0x5805a6[_0x267266(0xf6)],_0x57c09e[_0x267266(0xfa)]=_0x5805a6[_0x267266(0xfa)],_0x57c09e[_0x267266(0xd0)]=_0x5805a6[_0x267266(0xd0)],_0x57c09e['save']();}};MailerService=__decorate([common_1[a189_0x421a01(0xba)](),__param(0x2,common_1[a189_0x421a01(0xf4)](providers_1[a189_0x421a01(0xb3)])),__metadata(a189_0x421a01(0xc1),[kernel_1[a189_0x421a01(0xd7)],settings_1['SettingService'],mongoose_1[a189_0x421a01(0xc3)]])],MailerService),exports['MailerService']=MailerService;