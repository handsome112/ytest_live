'use strict';const a516_0x4635=['design:paramtypes','function','defineProperty','room-','getClient','isArray','@nestjs/common','CONNECTED_ROOM_REDIS_KEY','getUserSocketIds','9WSaXpc','__esModule','Injectable','hdel','srem','527wLzChA','1841738wEHdtT','@nestjs/websockets','SocketUserService','nestjs-redis','smembers','1462168aPdWgb','metadata','WebSocketGateway','emitToRoom','all','2152PwlETX','1360VWFNET','design:type','toString','countRoomUserConnections','CONNECTED_USER_REDIS_KEY','getConnectionValue','length','emit','1535408rOdDRq','getTime','clients','uniq','hlen','getOwnPropertyDescriptor','1MTxlPh','1503680XKtLBl','__metadata','redisService','CHECK_ONLINE_STATUS_SCHEDULE','forEach','connected','map','object','RedisService','addConnectionToRoom','lodash','getConnectedSocket','scard','emitToUsers','hmget','sadd','hgetall','addConnection','118425YJPLip','server'];const a516_0x434edc=a516_0x8f98;function a516_0x8f98(_0x3448c9,_0x1c9553){return a516_0x8f98=function(_0x4635d7,_0x8f98e8){_0x4635d7=_0x4635d7-0x17e;let _0x4e938f=a516_0x4635[_0x4635d7];return _0x4e938f;},a516_0x8f98(_0x3448c9,_0x1c9553);}(function(_0x43fb87,_0x266a62){const _0x1ac062=a516_0x8f98;while(!![]){try{const _0x210374=-parseInt(_0x1ac062(0x181))+-parseInt(_0x1ac062(0x1ae))*-parseInt(_0x1ac062(0x1a3))+parseInt(_0x1ac062(0x193))+parseInt(_0x1ac062(0x1a9))+-parseInt(_0x1ac062(0x1b7))*-parseInt(_0x1ac062(0x180))+-parseInt(_0x1ac062(0x19e))*-parseInt(_0x1ac062(0x1af))+-parseInt(_0x1ac062(0x1a4));if(_0x210374===_0x266a62)break;else _0x43fb87['push'](_0x43fb87['shift']());}catch(_0x363746){_0x43fb87['push'](_0x43fb87['shift']());}}}(a516_0x4635,0xdfdbf));var __decorate=this&&this['__decorate']||function(_0x49894c,_0x4e7cb3,_0x368e9f,_0x5e9878){const _0x407ddd=a516_0x8f98;var _0x52f758=arguments[_0x407ddd(0x1b5)],_0x1f339a=_0x52f758<0x3?_0x4e7cb3:_0x5e9878===null?_0x5e9878=Object[_0x407ddd(0x17f)](_0x4e7cb3,_0x368e9f):_0x5e9878,_0x1167a2;if(typeof Reflect===_0x407ddd(0x188)&&typeof Reflect['decorate']===_0x407ddd(0x196))_0x1f339a=Reflect['decorate'](_0x49894c,_0x4e7cb3,_0x368e9f,_0x5e9878);else{for(var _0x4455ad=_0x49894c[_0x407ddd(0x1b5)]-0x1;_0x4455ad>=0x0;_0x4455ad--)if(_0x1167a2=_0x49894c[_0x4455ad])_0x1f339a=(_0x52f758<0x3?_0x1167a2(_0x1f339a):_0x52f758>0x3?_0x1167a2(_0x4e7cb3,_0x368e9f,_0x1f339a):_0x1167a2(_0x4e7cb3,_0x368e9f))||_0x1f339a;}return _0x52f758>0x3&&_0x1f339a&&Object[_0x407ddd(0x197)](_0x4e7cb3,_0x368e9f,_0x1f339a),_0x1f339a;},__metadata=this&&this[a516_0x434edc(0x182)]||function(_0x29bf44,_0x4c0ef1){const _0x3144e5=a516_0x434edc;if(typeof Reflect==='object'&&typeof Reflect[_0x3144e5(0x1aa)]===_0x3144e5(0x196))return Reflect[_0x3144e5(0x1aa)](_0x29bf44,_0x4c0ef1);};Object[a516_0x434edc(0x197)](exports,a516_0x434edc(0x19f),{'value':!![]}),exports[a516_0x434edc(0x1a6)]=exports[a516_0x434edc(0x184)]=exports[a516_0x434edc(0x19c)]=exports[a516_0x434edc(0x1b3)]=void 0x0;const common_1=require(a516_0x434edc(0x19b)),nestjs_redis_1=require(a516_0x434edc(0x1a7)),lodash_1=require(a516_0x434edc(0x18b)),websockets_1=require(a516_0x434edc(0x1a5));exports[a516_0x434edc(0x1b3)]='connected_users',exports[a516_0x434edc(0x19c)]='user:',exports['CHECK_ONLINE_STATUS_SCHEDULE']='CHECK_ONLINE_STATUS_SCHEDULE';let SocketUserService=class SocketUserService{constructor(_0x5a7e31){const _0x13b44a=a516_0x434edc;this[_0x13b44a(0x183)]=_0x5a7e31;}async[a516_0x434edc(0x192)](_0x266d2a,_0x4c1b49){const _0x3f116e=a516_0x434edc,_0x2048f5=this[_0x3f116e(0x183)][_0x3f116e(0x199)]();await _0x2048f5[_0x3f116e(0x190)](exports[_0x3f116e(0x1b3)],_0x266d2a[_0x3f116e(0x1b1)]()),await _0x2048f5[_0x3f116e(0x190)](_0x266d2a[_0x3f116e(0x1b1)](),_0x4c1b49);}async[a516_0x434edc(0x19d)](_0x1d319c){const _0x494584=a516_0x434edc,_0x572a74=this[_0x494584(0x183)]['getClient'](),_0x7932db=await _0x572a74[_0x494584(0x1a8)](_0x1d319c);return _0x7932db;}async['userGetAllConnectedRooms'](_0x1e00c7){const _0x34aec4=a516_0x434edc,_0x1ce083=this[_0x34aec4(0x183)][_0x34aec4(0x199)](),_0x24f277=await _0x1ce083[_0x34aec4(0x1a8)](exports['CONNECTED_ROOM_REDIS_KEY']+_0x1e00c7);return _0x24f277;}async['removeConnection'](_0x5a4ef3,_0x549658){const _0x84afbd=a516_0x434edc,_0xe700f9=this[_0x84afbd(0x183)]['getClient']();await _0xe700f9[_0x84afbd(0x1a2)](_0x5a4ef3[_0x84afbd(0x1b1)](),_0x549658);const _0x2e37ae=await _0xe700f9[_0x84afbd(0x18d)](_0x5a4ef3[_0x84afbd(0x1b1)]());return!_0x2e37ae&&await _0xe700f9[_0x84afbd(0x1a2)](exports[_0x84afbd(0x1b3)],_0x5a4ef3[_0x84afbd(0x1b1)]()),_0x2e37ae;}async[a516_0x434edc(0x18a)](_0x1328bd,_0x5da2e0,_0x5767d3){const _0x1456a3=a516_0x434edc,_0xa7310d=this[_0x1456a3(0x183)][_0x1456a3(0x199)]();await _0xa7310d['hset'](_0x1456a3(0x198)+_0x1328bd,_0x5da2e0,_0x5767d3+','+new Date()[_0x1456a3(0x1b8)]()),await _0xa7310d['sadd'](exports[_0x1456a3(0x19c)]+_0x5da2e0,_0x1328bd);}async['removeConnectionFromRoom'](_0x332c89,_0x46c30b){const _0x3ce246=a516_0x434edc,_0x5c39df=this[_0x3ce246(0x183)][_0x3ce246(0x199)]();await _0x5c39df[_0x3ce246(0x1a1)]('room-'+_0x332c89,_0x46c30b),await _0x5c39df['srem'](exports[_0x3ce246(0x19c)]+_0x46c30b,_0x332c89);}async[a516_0x434edc(0x1b4)](_0x4e4224,_0x2b5d51){const _0x5204a0=a516_0x434edc,_0x5005a5=this[_0x5204a0(0x183)][_0x5204a0(0x199)](),_0x2cbaa7=await _0x5005a5[_0x5204a0(0x18f)](_0x5204a0(0x198)+_0x4e4224,...[_0x2b5d51]);return _0x2cbaa7[0x0];}async['getRoomUserConnections'](_0x11444a){const _0xdbddf4=a516_0x434edc,_0x295e5d=this[_0xdbddf4(0x183)][_0xdbddf4(0x199)](),_0xa79df8=await _0x295e5d[_0xdbddf4(0x191)]('room-'+_0x11444a);return _0xa79df8;}async[a516_0x434edc(0x1b2)](_0x12a334){const _0x5700fd=a516_0x434edc,_0x1477bf=this['redisService'][_0x5700fd(0x199)](),_0x2a27e8=await _0x1477bf[_0x5700fd(0x17e)](_0x5700fd(0x198)+_0x12a334);return _0x2a27e8;}async[a516_0x434edc(0x18e)](_0x2aab5a,_0x30e739,_0x1060c7){const _0x13aaea=a516_0x434edc,_0x4e3105=lodash_1[_0x13aaea(0x1ba)](Array[_0x13aaea(0x19a)](_0x2aab5a)?_0x2aab5a:[_0x2aab5a])['map'](_0x1578bf=>_0x1578bf['toString']()),_0x3f553a=this[_0x13aaea(0x183)][_0x13aaea(0x199)]();Promise[_0x13aaea(0x1ad)](_0x4e3105['map'](async _0x54885b=>{const _0x538080=_0x13aaea,_0x35d229=await _0x3f553a[_0x538080(0x1a8)](_0x54885b);(_0x35d229||[])[_0x538080(0x185)](_0xa3ee78=>this[_0x538080(0x194)]['to'](_0xa3ee78)[_0x538080(0x1b6)](_0x30e739,_0x1060c7));}));}async[a516_0x434edc(0x1ac)](_0x8eff24,_0x316788,_0x27a46a){const _0x1fd7d9=a516_0x434edc;this[_0x1fd7d9(0x194)]['to'](_0x8eff24)[_0x1fd7d9(0x1b6)](_0x316788,_0x27a46a);}async['emitToConnectedUsers'](_0x3a67d3,_0x181f48){const _0x59c354=a516_0x434edc,_0xb50276=this[_0x59c354(0x194)][_0x59c354(0x1b9)]()[_0x59c354(0x186)],_0xb93877=Object['keys'](_0xb50276)['map'](_0x425d4c=>_0x425d4c);if(!_0xb93877[_0x59c354(0x1b5)])return;await Promise[_0x59c354(0x1ad)](_0xb93877[_0x59c354(0x187)](_0x2a7386=>this[_0x59c354(0x194)]['to'](_0x2a7386)['emit'](_0x3a67d3,_0x181f48)));}async[a516_0x434edc(0x18c)](){const _0x5e158a=a516_0x434edc;return this[_0x5e158a(0x194)][_0x5e158a(0x1b9)]()['connected'];}};__decorate([websockets_1['WebSocketServer'](),__metadata(a516_0x434edc(0x1b0),Object)],SocketUserService['prototype'],'server',void 0x0),SocketUserService=__decorate([common_1[a516_0x434edc(0x1a0)](),websockets_1[a516_0x434edc(0x1ab)](),__metadata(a516_0x434edc(0x195),[nestjs_redis_1[a516_0x434edc(0x189)]])],SocketUserService),exports[a516_0x434edc(0x1a6)]=SocketUserService;