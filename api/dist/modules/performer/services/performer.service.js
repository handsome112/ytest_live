'use strict';const a362_0x4827=['filter','usersInfo','updateVerificationStatus','countDocuments','totalOnlineTodayStat','PerformerService','update','indexOf','UPDATED','releaseFormId','studioId','moment','email','function','updateBroadcastSetting','uniq','toDate','firstName','checkBlock','path','PERFORMER_STEAMING_STATUS_CHANNEL','EmailExistedException','../../stream/constant','__metadata','categories','publish','toSearchResponse','MEDIA_FILE_CHANNEL','setStreamingStatus','PERFORMER_COMMISSION_MODEL_PROVIDER','performer-document-verification','EntityNotFoundException','lastName','QueueEvent','assign','USER_SOCKET_EVENT','metadata','$stats.totalProducts','Avatar\x20not\x20found!','FILEID','SocketUserService','toLowerCase','Model','username','../dtos','$stats.totalTokenEarned','userIds','updateSteamingStatus','../constants','idVerificationId','performer-avatar','updateBlockSetting','admin','PERFORMER_CHANNEL','PERFORMER_BLOCK_SETTING_MODEL_PROVIDER','1069420VgSnJW','documentVerificationId','roles','privateCallPrice','INACTIVE','&token=','join','stats','PerformerDto','commissionSetting','decorate','findByIds','495586SwADsK','performerCommissionService','updateAvatar','../../../kernel','forwardRef','getOwnPropertyDescriptor','checkAuthDocument','PERFORMER_MODEL_PROVIDER','1djHtnd','find','viewProfile','../../socket/constants','performer-release-form','map','../../socket/services/socket-user.service','countries','userService','remove','checkBlockedByIp','EVENT','CREATED','$stats.totalGalleries','getBlockSetting','CategoryService','../../../kernel/helpers/string.helper','toString','FileService','findByUsername','602627ODWaqE','1IVjHji','trim','$stats.totalStreamTime','replace','updateOne','__decorate','1118509qDHvlo','../../studio/payloads','237611STTnPk','findById','./category.service','QueueEventService','addRef','DISCONNECTED','socketUserService','FILE_RELATED_MODULE_UPDATED','356452CadHFS','BLOCK_USERS_CHANNEL','ForbiddenException','performerCommissionModel','emitToConnectedUsers','updateBalance','exec','FileDto','performerModel','../exceptions','../providers','ModelNotFoundException','defineProperty','documentVerification','studioUpdate','blockSettingModel','UsernameExistedException','BlockSettingDto','name','mongoose','DELETE_FILE_TYPE','create','@nestjs/common','performer-id-verification','fileService','streamingStatus','set','lodash','avatar','UserService','register','idVerification','length','queueEventService','findOne','isBlocked','mimeType','../../../kernel/constants','464420twGeqO','avatarPath','../../studio/exceptions/model-not-found.exception','getPublicUrl','updateLastStreamingTime','aggregate','_id','goLive','documentId','Inject','__esModule','avatarId','offline','updateDefaultPrice','BLOCK_ACTION','categoryService','design:paramtypes','total','groupCallPrice','OFFLINE','../../user/dtos','STATUS','__param','FILE_EVENT','../../file/services','Injectable','all','type','ACTIVE','1xUFIlm','toResponse','PerformerCommissionService','toObject','refItems','includes','company-registration-certificate','?documentId='];function a362_0x1fda(_0x331595,_0x25561f){return a362_0x1fda=function(_0x4827d2,_0x1fda6b){_0x4827d2=_0x4827d2-0x95;let _0x37328b=a362_0x4827[_0x4827d2];return _0x37328b;},a362_0x1fda(_0x331595,_0x25561f);}const a362_0x5c7b66=a362_0x1fda;(function(_0x3b4fc1,_0x578f70){const _0x47f633=a362_0x1fda;while(!![]){try{const _0x5156fa=parseInt(_0x47f633(0xcb))+parseInt(_0x47f633(0x11f))*-parseInt(_0x47f633(0xdc))+parseInt(_0x47f633(0xaf))+parseInt(_0x47f633(0xcc))*-parseInt(_0x47f633(0xa3))+-parseInt(_0x47f633(0x102))+parseInt(_0x47f633(0xd4))+parseInt(_0x47f633(0xd2))*parseInt(_0x47f633(0xb7));if(_0x5156fa===_0x578f70)break;else _0x3b4fc1['push'](_0x3b4fc1['shift']());}catch(_0x2756c6){_0x3b4fc1['push'](_0x3b4fc1['shift']());}}}(a362_0x4827,0x89b49));var __decorate=this&&this[a362_0x5c7b66(0xd1)]||function(_0x58f18d,_0x3c2fde,_0xf7c3bc,_0x3c7e58){const _0x1be3d9=a362_0x5c7b66;var _0x116f29=arguments[_0x1be3d9(0xfc)],_0x3b2773=_0x116f29<0x3?_0x3c2fde:_0x3c7e58===null?_0x3c7e58=Object[_0x1be3d9(0xb4)](_0x3c2fde,_0xf7c3bc):_0x3c7e58,_0x41e2ad;if(typeof Reflect==='object'&&typeof Reflect[_0x1be3d9(0xad)]===_0x1be3d9(0x134))_0x3b2773=Reflect['decorate'](_0x58f18d,_0x3c2fde,_0xf7c3bc,_0x3c7e58);else{for(var _0x11b30f=_0x58f18d[_0x1be3d9(0xfc)]-0x1;_0x11b30f>=0x0;_0x11b30f--)if(_0x41e2ad=_0x58f18d[_0x11b30f])_0x3b2773=(_0x116f29<0x3?_0x41e2ad(_0x3b2773):_0x116f29>0x3?_0x41e2ad(_0x3c2fde,_0xf7c3bc,_0x3b2773):_0x41e2ad(_0x3c2fde,_0xf7c3bc))||_0x3b2773;}return _0x116f29>0x3&&_0x3b2773&&Object['defineProperty'](_0x3c2fde,_0xf7c3bc,_0x3b2773),_0x3b2773;},__metadata=this&&this[a362_0x5c7b66(0x13e)]||function(_0x3d0ace,_0x8f59d5){const _0x40604a=a362_0x5c7b66;if(typeof Reflect==='object'&&typeof Reflect[_0x40604a(0x14b)]===_0x40604a(0x134))return Reflect[_0x40604a(0x14b)](_0x3d0ace,_0x8f59d5);},__param=this&&this[a362_0x5c7b66(0x118)]||function(_0x5658c2,_0x355e79){return function(_0x5336fe,_0x515309){_0x355e79(_0x5336fe,_0x515309,_0x5658c2);};};Object[a362_0x5c7b66(0xe8)](exports,a362_0x5c7b66(0x10c),{'value':!![]}),exports[a362_0x5c7b66(0x12c)]=void 0x0;const common_1=require(a362_0x5c7b66(0xf2)),mongoose_1=require(a362_0x5c7b66(0xef)),dtos_1=require(a362_0x5c7b66(0x116)),kernel_1=require(a362_0x5c7b66(0xb2)),services_1=require(a362_0x5c7b66(0x11a)),file_1=require('../../file'),constants_1=require(a362_0x5c7b66(0x101)),services_2=require('../../user/services'),lodash_1=require(a362_0x5c7b66(0xf7)),socket_user_service_1=require(a362_0x5c7b66(0xbd)),payloads_1=require(a362_0x5c7b66(0xd3)),model_not_found_exception_1=require(a362_0x5c7b66(0x104)),moment=require(a362_0x5c7b66(0x132)),constants_2=require(a362_0x5c7b66(0x9c)),constants_3=require(a362_0x5c7b66(0xba)),constant_1=require(a362_0x5c7b66(0x13d)),string_helper_1=require(a362_0x5c7b66(0xc7)),constants_4=require(a362_0x5c7b66(0x9c)),index_1=require('./index'),dtos_2=require(a362_0x5c7b66(0x98)),exceptions_1=require(a362_0x5c7b66(0xe5)),providers_1=require(a362_0x5c7b66(0xe6)),category_service_1=require(a362_0x5c7b66(0xd6));let PerformerService=class PerformerService{constructor(_0x20df76,_0x5c2846,_0x1598f1,_0x44869c,_0x555e95,_0x5320b8,_0xdd61fd,_0x10cb01,_0x277e3b){const _0x4a8767=a362_0x5c7b66;this[_0x4a8767(0xe4)]=_0x20df76,this['userService']=_0x5c2846,this['queueEventService']=_0x1598f1,this[_0x4a8767(0x111)]=_0x44869c,this[_0x4a8767(0xda)]=_0x555e95,this[_0x4a8767(0xeb)]=_0x5320b8,this[_0x4a8767(0xdf)]=_0xdd61fd,this[_0x4a8767(0xf4)]=_0x10cb01,this[_0x4a8767(0xb0)]=_0x277e3b;}[a362_0x5c7b66(0xfe)](_0x13cf1b){const _0x379b96=a362_0x5c7b66;return this[_0x379b96(0xe4)][_0x379b96(0xfe)](_0x13cf1b);}async['findById'](_0x5f9f90){const _0x1324b9=a362_0x5c7b66,_0x37b3e4=await this['performerModel']['findById'](_0x5f9f90);if(!_0x37b3e4)return null;const _0x49ee68=new dtos_2[(_0x1324b9(0xab))](_0x37b3e4);if(_0x37b3e4[_0x1324b9(0x10d)]){const _0x31a4a6=await this[_0x1324b9(0xf4)]['findById'](_0x37b3e4[_0x1324b9(0x10d)]);_0x49ee68['avatarPath']=_0x31a4a6?file_1['FileDto'][_0x1324b9(0x105)](_0x31a4a6['path']):null;}return new dtos_2[(_0x1324b9(0xab))](_0x49ee68);}async['checkBlockedByIp'](_0x27a5a2,_0x9f14fc){const _0x47d818=a362_0x5c7b66;if(_0x27a5a2&&_0x27a5a2[_0x47d818(0xbe)]&&_0x27a5a2[_0x47d818(0xbe)]['length'])return _0x27a5a2['countries']['indexOf'](_0x9f14fc)>-0x1;return![];}async['checkBlockedByPerformer'](_0x430181,_0x18c454){const _0xed1b44=a362_0x5c7b66;if(_0x430181&&_0x430181[_0xed1b44(0x9a)]&&_0x430181[_0xed1b44(0x9a)][_0xed1b44(0xfc)])return _0x430181[_0xed1b44(0x9a)]['indexOf'](_0x18c454)>-0x1;return![];}async[a362_0x5c7b66(0xca)](_0x17e645,_0x3922e3,_0x3a7b7a){const _0xc4e597=a362_0x5c7b66,_0x57d78a=_0x17e645[_0xc4e597(0xcf)](/[^a-zA-Z0-9]/g,''),_0x111151=await this[_0xc4e597(0xe4)][_0xc4e597(0xfe)]({'username':_0x57d78a});if(!_0x111151)return null;const _0x1ab294=new dtos_2[(_0xc4e597(0xab))](_0x111151);let _0x240ea9=![];const _0x27fc88=await this[_0xc4e597(0xeb)][_0xc4e597(0xfe)]({'performerId':_0x111151[_0xc4e597(0x108)]});_0x3922e3&&_0x27fc88&&(_0x240ea9=await this[_0xc4e597(0xc1)](_0x27fc88,_0x3922e3));let _0x5eca9a=![];_0x3a7b7a&&_0x27fc88&&(_0x5eca9a=await this['checkBlockedByPerformer'](_0x27fc88,_0x3a7b7a[_0xc4e597(0x108)]));_0x1ab294[_0xc4e597(0xff)]=!!(_0x240ea9||_0x5eca9a);if(_0x111151['avatarId']){const _0x5f1510=await this[_0xc4e597(0xf4)][_0xc4e597(0xd5)](_0x111151['avatarId']);_0x1ab294[_0xc4e597(0x103)]=_0x5f1510?_0x5f1510['path']:null;}return _0x1ab294;}async['findByEmail'](_0x2f7ff0){const _0x478881=a362_0x5c7b66,_0xd53b71=await this[_0x478881(0xe4)][_0x478881(0xfe)]({'email':_0x2f7ff0[_0x478881(0x95)]()});if(!_0xd53b71)return null;return new dtos_2[(_0x478881(0xab))](_0xd53b71);}async[a362_0x5c7b66(0xb8)](_0xc772ba={}){const _0x4d7df5=a362_0x5c7b66,_0x136108=await this['performerModel'][_0x4d7df5(0xb8)](_0xc772ba)[_0x4d7df5(0xe2)]();return _0x136108;}async['findByIds'](_0x263c66){const _0x1f2996=a362_0x5c7b66,_0x29e26e=await this[_0x1f2996(0xe4)][_0x1f2996(0xb8)]({'_id':{'$in':_0x263c66}})['lean']()[_0x1f2996(0xe2)]();return _0x29e26e[_0x1f2996(0xbc)](_0xf09ed2=>new dtos_2[(_0x1f2996(0xab))](_0xf09ed2));}async[a362_0x5c7b66(0xfa)](_0x396fc8){const _0x1006c5=a362_0x5c7b66,_0x1f397f=Object['assign'](Object[_0x1006c5(0x149)]({},_0x396fc8),{'updatedAt':new Date(),'createdAt':new Date()}),_0x66af17=await this[_0x1006c5(0xe4)][_0x1006c5(0x12a)]({'username':_0x396fc8['username'][_0x1006c5(0xcd)]()});if(_0x66af17)throw new exceptions_1[(_0x1006c5(0xec))]();const _0x29e813=await this[_0x1006c5(0xe4)][_0x1006c5(0x12a)]({'email':_0x396fc8[_0x1006c5(0x133)]['toLowerCase']()['trim']()});if(_0x29e813)throw new exceptions_1[(_0x1006c5(0x13c))]();if(_0x396fc8['avatarId']){const _0x538dfa=await this[_0x1006c5(0xf4)][_0x1006c5(0xd5)](_0x396fc8[_0x1006c5(0x10d)]);if(!_0x538dfa)throw new kernel_1[(_0x1006c5(0x146))](_0x1006c5(0x14d));_0x1f397f[_0x1006c5(0x103)]=_0x538dfa['path'];}const _0x3d5b11=await this[_0x1006c5(0xe4)][_0x1006c5(0xf1)](_0x1f397f);return await Promise[_0x1006c5(0x11c)]([_0x396fc8[_0x1006c5(0x9d)]&&this[_0x1006c5(0xf4)][_0x1006c5(0xd8)](_0x396fc8[_0x1006c5(0x9d)],{'itemId':_0x3d5b11[_0x1006c5(0x108)],'itemType':_0x1006c5(0xf3)}),_0x396fc8[_0x1006c5(0xa4)]&&this['fileService'][_0x1006c5(0xd8)](_0x396fc8[_0x1006c5(0xa4)],{'itemId':_0x3d5b11[_0x1006c5(0x108)],'itemType':_0x1006c5(0x145)}),_0x396fc8[_0x1006c5(0x10d)]&&this['fileService'][_0x1006c5(0xd8)](_0x396fc8[_0x1006c5(0x10d)],{'itemId':_0x3d5b11['_id'],'itemType':_0x1006c5(0x9e)})]),await this[_0x1006c5(0xfd)][_0x1006c5(0x140)](new kernel_1[(_0x1006c5(0x148))]({'channel':constants_2[_0x1006c5(0xa1)],'eventName':constants_1[_0x1006c5(0xc2)]['CREATED'],'data':{'id':_0x3d5b11[_0x1006c5(0x108)]}})),new dtos_2[(_0x1006c5(0xab))](_0x3d5b11);}async['getDetails'](_0x357dfb,_0x4a4c9e){const _0x146701=a362_0x5c7b66,_0x4da96c=await this['performerModel']['findById'](_0x357dfb);if(!_0x4da96c)throw new kernel_1[(_0x146701(0x146))]();const {avatarId:_0x29efb9,documentVerificationId:_0x25d2bf,idVerificationId:_0x387b83,releaseFormId:_0x5cc50e,categoryIds:_0xb8c472}=_0x4da96c,[_0x552fc3,_0x29fd37,_0xd827fd,_0x504e4b,_0x13f0f5,_0x20c928]=await Promise[_0x146701(0x11c)]([_0x29efb9&&this[_0x146701(0xf4)][_0x146701(0xd5)](_0x29efb9),_0x25d2bf&&this[_0x146701(0xf4)][_0x146701(0xd5)](_0x25d2bf),_0x387b83&&this['fileService'][_0x146701(0xd5)](_0x387b83),_0x5cc50e&&this[_0x146701(0xf4)]['findById'](_0x5cc50e),this[_0x146701(0xdf)][_0x146701(0xfe)]({'performerId':_0x357dfb}),_0xb8c472?this['categoryService'][_0x146701(0xb8)]({'_id':{'$in':_0xb8c472}}):[]]),_0x1b5f30=new dtos_2['PerformerDto'](_0x4da96c);return _0x1b5f30[_0x146701(0x13f)]=_0x20c928?_0x20c928[_0x146701(0xbc)](_0x499921=>_0x499921['name']):[],_0x1b5f30[_0x146701(0xf8)]=_0x552fc3?file_1['FileDto'][_0x146701(0x105)](_0x552fc3[_0x146701(0x13a)]):null,_0x1b5f30[_0x146701(0xfb)]=_0xd827fd?{'_id':_0xd827fd[_0x146701(0x108)],'name':_0xd827fd[_0x146701(0xee)],'url':_0x4a4c9e?file_1[_0x146701(0xe3)]['getPublicUrl'](_0xd827fd[_0x146701(0x13a)])+'?documentId='+_0xd827fd[_0x146701(0x108)]+_0x146701(0xa8)+_0x4a4c9e:file_1[_0x146701(0xe3)][_0x146701(0x105)](_0xd827fd[_0x146701(0x13a)]),'mimeType':_0xd827fd[_0x146701(0x100)]}:null,_0x1b5f30[_0x146701(0xe9)]=_0x29fd37?{'_id':_0x29fd37[_0x146701(0x108)],'name':_0x29fd37[_0x146701(0xee)],'url':_0x4a4c9e?file_1[_0x146701(0xe3)][_0x146701(0x105)](_0x29fd37[_0x146701(0x13a)])+'?documentId='+_0x29fd37['_id']+_0x146701(0xa8)+_0x4a4c9e:file_1['FileDto'][_0x146701(0x105)](_0x29fd37[_0x146701(0x13a)]),'mimeType':_0x29fd37[_0x146701(0x100)]}:null,_0x1b5f30['releaseForm']=_0x504e4b?{'_id':_0x504e4b['_id'],'name':_0x504e4b[_0x146701(0xee)],'url':_0x4a4c9e?file_1[_0x146701(0xe3)][_0x146701(0x105)](_0x504e4b[_0x146701(0x13a)])+_0x146701(0x126)+_0x504e4b[_0x146701(0x108)]+'&token='+_0x4a4c9e:file_1[_0x146701(0xe3)]['getPublicUrl'](_0x504e4b[_0x146701(0x13a)]),'mimeType':_0x504e4b['mimeType']}:null,_0x1b5f30[_0x146701(0xac)]=_0x13f0f5,_0x1b5f30;}async[a362_0x5c7b66(0xf1)](_0x4582c6,_0xf8b0be){const _0x34914a=a362_0x5c7b66,_0x7d6076=Object[_0x34914a(0x149)](Object[_0x34914a(0x149)]({},_0x4582c6),{'updatedAt':new Date(),'createdAt':new Date()}),_0x17ed5d=await this[_0x34914a(0xe4)]['countDocuments']({'username':_0x4582c6['username'][_0x34914a(0xcd)]()});if(_0x17ed5d)throw new exceptions_1[(_0x34914a(0xec))]();const _0x2ada18=await this['performerModel'][_0x34914a(0x12a)]({'email':_0x4582c6[_0x34914a(0x133)][_0x34914a(0x95)]()['trim']()});if(_0x2ada18)throw new exceptions_1['EmailExistedException']();if(_0x4582c6[_0x34914a(0x10d)]){const _0x4dc58e=await this['fileService'][_0x34914a(0xd5)](_0x4582c6[_0x34914a(0x10d)]);if(!_0x4dc58e)throw new kernel_1['EntityNotFoundException'](_0x34914a(0x14d));_0x7d6076[_0x34914a(0x103)]=_0x4dc58e[_0x34914a(0x13a)];}_0xf8b0be&&(_0x7d6076['createdBy']=_0xf8b0be[_0x34914a(0x108)]);const _0x1d87c7=await this[_0x34914a(0xe4)]['create'](_0x7d6076);return await Promise['all']([_0x4582c6['idVerificationId']&&this[_0x34914a(0xf4)][_0x34914a(0xd8)](_0x4582c6[_0x34914a(0x9d)],{'itemId':_0x1d87c7[_0x34914a(0x108)],'itemType':'performer-id-verification'}),_0x4582c6[_0x34914a(0xa4)]&&this[_0x34914a(0xf4)][_0x34914a(0xd8)](_0x4582c6[_0x34914a(0xa4)],{'itemId':_0x1d87c7['_id'],'itemType':_0x34914a(0x145)}),_0x4582c6[_0x34914a(0x130)]&&this[_0x34914a(0xf4)]['addRef'](_0x4582c6[_0x34914a(0x130)],{'itemId':_0x1d87c7[_0x34914a(0x108)],'itemType':_0x34914a(0xbb)}),_0x4582c6[_0x34914a(0x10d)]&&this[_0x34914a(0xf4)][_0x34914a(0xd8)](_0x4582c6[_0x34914a(0x10d)],{'itemId':_0x1d87c7[_0x34914a(0x108)],'itemType':'performer-avatar'})]),_0x4582c6['commissionSetting']&&await this[_0x34914a(0xb0)]['update'](_0x4582c6['commissionSetting'],_0x1d87c7['_id']),await this[_0x34914a(0xfd)]['publish'](new kernel_1[(_0x34914a(0x148))]({'channel':constants_2[_0x34914a(0xa1)],'eventName':constants_1[_0x34914a(0xc2)]['CREATED'],'data':{'id':_0x1d87c7[_0x34914a(0x108)]}})),new dtos_2[(_0x34914a(0xab))](_0x1d87c7);}async['adminUpdate'](_0x57867e,_0x35e96b){const _0x2d8a15=a362_0x5c7b66,_0x2df997=await this[_0x2d8a15(0xe4)][_0x2d8a15(0xd5)](_0x57867e);if(!_0x2df997)throw new kernel_1[(_0x2d8a15(0x146))]();const _0x4d20b9=Object[_0x2d8a15(0x149)]({},_0x35e96b),{studioId:_0x1670aa}=_0x2df997;!_0x2df997['name']&&(_0x4d20b9[_0x2d8a15(0xee)]=[_0x2df997['firstName']||'',_0x2df997['lastName']||''][_0x2d8a15(0xa9)]('\x20')[_0x2d8a15(0xcd)]());if(_0x4d20b9[_0x2d8a15(0x133)]&&_0x4d20b9[_0x2d8a15(0x133)]['toLowerCase']()!==_0x2df997[_0x2d8a15(0x133)][_0x2d8a15(0x95)]()){const _0x33eb01=await this[_0x2d8a15(0xe4)][_0x2d8a15(0x12a)]({'email':_0x4d20b9['email']['toLowerCase'](),'_id':{'$ne':_0x2df997['_id']}});if(_0x33eb01)throw new exceptions_1[(_0x2d8a15(0x13c))]();}if(_0x4d20b9[_0x2d8a15(0x97)]&&_0x4d20b9[_0x2d8a15(0x97)]!==_0x2df997[_0x2d8a15(0x97)]){const _0x21058a=await this[_0x2d8a15(0xe4)][_0x2d8a15(0x12a)]({'username':_0x2df997[_0x2d8a15(0x97)],'_id':{'$ne':_0x2df997['_id']}});if(_0x21058a)throw new exceptions_1['UsernameExistedException']();}if(_0x35e96b[_0x2d8a15(0x10d)]&&!_0x2df997[_0x2d8a15(0x10d)]||_0x2df997[_0x2d8a15(0x10d)]&&_0x35e96b[_0x2d8a15(0x10d)]&&_0x35e96b[_0x2d8a15(0x10d)]!==_0x2df997[_0x2d8a15(0x10d)]['toString']()){const _0x4983d4=await this[_0x2d8a15(0xf4)][_0x2d8a15(0xd5)](_0x35e96b[_0x2d8a15(0x10d)]);if(!_0x4983d4)throw new kernel_1['EntityNotFoundException'](_0x2d8a15(0x14d));_0x4d20b9[_0x2d8a15(0x103)]=_0x4983d4['path'];}await this['performerModel'][_0x2d8a15(0xd0)]({'_id':_0x57867e},_0x4d20b9),await Promise[_0x2d8a15(0x11c)]([_0x35e96b[_0x2d8a15(0x10d)]&&this[_0x2d8a15(0xf4)]['addRef'](_0x35e96b[_0x2d8a15(0x10d)],{'itemId':_0x2df997[_0x2d8a15(0x108)],'itemType':_0x2d8a15(0x9e)}),_0x35e96b[_0x2d8a15(0xa4)]&&this[_0x2d8a15(0xf4)][_0x2d8a15(0xd8)](_0x35e96b[_0x2d8a15(0xa4)],{'itemId':_0x2df997[_0x2d8a15(0x108)],'itemType':_0x2d8a15(0x145)}),_0x35e96b[_0x2d8a15(0x130)]&&this[_0x2d8a15(0xf4)][_0x2d8a15(0xd8)](_0x35e96b[_0x2d8a15(0x130)],{'itemId':_0x2df997[_0x2d8a15(0x108)],'itemType':'performer-release-form'}),_0x35e96b[_0x2d8a15(0x9d)]&&this['fileService'][_0x2d8a15(0xd8)](_0x35e96b['idVerificationId'],{'itemId':_0x2df997[_0x2d8a15(0x108)],'itemType':_0x2d8a15(0xf3)})]);_0x35e96b[_0x2d8a15(0xa4)]&&''+_0x35e96b['documentVerificationId']!==''+_0x2df997[_0x2d8a15(0xa4)]&&(_0x2df997[_0x2d8a15(0xa4)]&&await this[_0x2d8a15(0xf4)][_0x2d8a15(0xc0)](_0x2df997[_0x2d8a15(0xa4)]));_0x35e96b[_0x2d8a15(0x9d)]&&''+_0x35e96b['idVerificationId']!==''+_0x2df997['idVerificationId']&&(_0x2df997['idVerificationId']&&await this[_0x2d8a15(0xf4)]['remove'](_0x2df997[_0x2d8a15(0x9d)]));_0x35e96b[_0x2d8a15(0x130)]&&''+_0x35e96b[_0x2d8a15(0x130)]!==''+_0x2df997[_0x2d8a15(0x130)]&&(_0x2df997[_0x2d8a15(0x130)]&&await this[_0x2d8a15(0xf4)][_0x2d8a15(0xc0)](_0x2df997[_0x2d8a15(0x130)]));lodash_1['merge'](_0x2df997,_0x4d20b9);const _0x6ed179={'channel':constants_2[_0x2d8a15(0xa1)],'eventName':constants_1[_0x2d8a15(0xc2)][_0x2d8a15(0x12f)],'data':{'performer':_0x2df997,'oldStudioId':_0x1670aa}};return await this['queueEventService'][_0x2d8a15(0x140)](_0x6ed179),_0x2df997;}async[a362_0x5c7b66(0xea)](_0x389a82,_0x5bd1b6,_0x3162c4){const _0xef3815=a362_0x5c7b66,_0x33b24b=await this[_0xef3815(0xd5)](_0x389a82);if(!_0x33b24b)throw new kernel_1[(_0xef3815(0x146))]();if(_0x33b24b[_0xef3815(0x131)][_0xef3815(0xc8)]()!==_0x3162c4[_0xef3815(0xc8)]())throw new model_not_found_exception_1[(_0xef3815(0xe7))]();return this[_0xef3815(0xe4)][_0xef3815(0xd0)]({'_id':_0x389a82},{'$set':{'status':_0x5bd1b6['status']}},{'new':!![]});}async[a362_0x5c7b66(0x12d)](_0x584cc5,_0x4f7b02){const _0x2903aa=a362_0x5c7b66,_0x3beb59=await this[_0x2903aa(0xe4)][_0x2903aa(0xfe)]({'_id':_0x584cc5});if(!_0x3beb59)throw new kernel_1[(_0x2903aa(0x146))]();const _0x14a8eb=Object['assign']({},_0x4f7b02);_0x3beb59&&''+_0x3beb59[_0x2903aa(0x108)]!==''+_0x584cc5&&(delete _0x14a8eb[_0x2903aa(0x133)],delete _0x14a8eb[_0x2903aa(0x97)]);const {avatarId:_0x5dcfff,documentVerificationId:_0x47b8f1,idVerificationId:_0x1c524f,releaseFormId:_0x147865}=_0x3beb59;return _0x14a8eb[_0x2903aa(0xee)]=[_0x3beb59[_0x2903aa(0x138)]||'',_0x3beb59[_0x2903aa(0x147)]||''][_0x2903aa(0xa9)]('\x20')['trim'](),await this['performerModel'][_0x2903aa(0xd0)]({'_id':_0x584cc5},_0x14a8eb),await Promise[_0x2903aa(0x11c)]([_0x4f7b02[_0x2903aa(0x10d)]&&this[_0x2903aa(0xf4)][_0x2903aa(0xd8)](_0x4f7b02[_0x2903aa(0x10d)],{'itemId':_0x3beb59['_id'],'itemType':'performer-avatar'}),_0x4f7b02[_0x2903aa(0xa4)]&&this['fileService']['addRef'](_0x4f7b02[_0x2903aa(0xa4)],{'itemId':_0x3beb59[_0x2903aa(0x108)],'itemType':'performer-document-verification'}),_0x4f7b02[_0x2903aa(0x130)]&&this[_0x2903aa(0xf4)][_0x2903aa(0xd8)](_0x4f7b02[_0x2903aa(0x130)],{'itemId':_0x3beb59[_0x2903aa(0x108)],'itemType':_0x2903aa(0xbb)}),_0x4f7b02[_0x2903aa(0x9d)]&&this[_0x2903aa(0xf4)][_0x2903aa(0xd8)](_0x4f7b02[_0x2903aa(0x9d)],{'itemId':_0x3beb59[_0x2903aa(0x108)],'itemType':_0x2903aa(0xf3)})]),await Promise[_0x2903aa(0x11c)]([_0x4f7b02[_0x2903aa(0x10d)]&&this[_0x2903aa(0xfd)][_0x2903aa(0x140)](new kernel_1[(_0x2903aa(0x148))]({'channel':services_1[_0x2903aa(0x142)],'eventName':services_1['FILE_EVENT'][_0x2903aa(0xdb)],'data':{'type':services_1[_0x2903aa(0xf0)]['FILEID'],'currentFile':_0x5dcfff,'newFile':_0x4f7b02[_0x2903aa(0x10d)]}})),_0x4f7b02[_0x2903aa(0xa4)]&&this[_0x2903aa(0xfd)][_0x2903aa(0x140)](new kernel_1[(_0x2903aa(0x148))]({'channel':services_1[_0x2903aa(0x142)],'eventName':services_1[_0x2903aa(0x119)]['FILE_RELATED_MODULE_UPDATED'],'data':{'type':services_1[_0x2903aa(0xf0)][_0x2903aa(0x14e)],'currentFile':_0x47b8f1,'newFile':_0x4f7b02['documentVerificationId']}})),_0x4f7b02[_0x2903aa(0x130)]&&this[_0x2903aa(0xfd)]['publish'](new kernel_1['QueueEvent']({'channel':services_1['MEDIA_FILE_CHANNEL'],'eventName':services_1[_0x2903aa(0x119)][_0x2903aa(0xdb)],'data':{'type':services_1[_0x2903aa(0xf0)]['FILEID'],'currentFile':_0x147865,'newFile':_0x4f7b02[_0x2903aa(0x130)]}})),_0x4f7b02['idVerificationId']&&this['queueEventService']['publish'](new kernel_1[(_0x2903aa(0x148))]({'channel':services_1[_0x2903aa(0x142)],'eventName':services_1['FILE_EVENT'][_0x2903aa(0xdb)],'data':{'type':services_1[_0x2903aa(0xf0)][_0x2903aa(0x14e)],'currentFile':_0x1c524f,'newFile':_0x4f7b02[_0x2903aa(0x9d)]}}))]),!![];}async[a362_0x5c7b66(0xb9)](_0x378648){const _0x2b6108=a362_0x5c7b66;return this[_0x2b6108(0xe4)][_0x2b6108(0xd0)]({'_id':_0x378648},{'$inc':{'stats.views':0x1}},{'new':!![]});}async[a362_0x5c7b66(0x9f)](_0x375971,_0x57d41c){const _0x36b1d6=a362_0x5c7b66;let _0x30cf8a=await this[_0x36b1d6(0xeb)]['findOne']({'performerId':_0x375971});if(_0x30cf8a){_0x30cf8a[_0x36b1d6(0xbe)]=lodash_1[_0x36b1d6(0x136)](_0x57d41c[_0x36b1d6(0xbe)]),_0x30cf8a[_0x36b1d6(0x9a)]=lodash_1[_0x36b1d6(0x136)](_0x57d41c[_0x36b1d6(0x9a)]);const _0x5b2173=_0x30cf8a[_0x36b1d6(0x122)](),_0x4403ae=_0x5b2173['userIds']['length']?_0x5b2173['userIds'][_0x36b1d6(0xbc)](_0x16fa25=>_0x16fa25[_0x36b1d6(0xc8)]())[_0x36b1d6(0x127)](_0x50d1c6=>!_0x57d41c[_0x36b1d6(0x9a)][_0x36b1d6(0x124)](_0x50d1c6)):[];return _0x57d41c[_0x36b1d6(0x9a)]&&await this[_0x36b1d6(0xfd)][_0x36b1d6(0x140)]({'channel':constants_4[_0x36b1d6(0xdd)],'eventName':constants_4[_0x36b1d6(0x110)][_0x36b1d6(0xc3)],'data':{'userIds':_0x4403ae,'performerId':_0x30cf8a['performerId']}}),await _0x30cf8a['save'](),_0x30cf8a;}return _0x30cf8a=new this[(_0x36b1d6(0xeb))](),_0x30cf8a['performerId']=_0x375971,_0x30cf8a['userIds']=lodash_1[_0x36b1d6(0x136)](_0x57d41c[_0x36b1d6(0x9a)]),_0x30cf8a[_0x36b1d6(0xbe)]=lodash_1[_0x36b1d6(0x136)](_0x57d41c['countries']),_0x57d41c[_0x36b1d6(0x9a)]&&await this[_0x36b1d6(0xfd)][_0x36b1d6(0x140)]({'channel':constants_4['BLOCK_USERS_CHANNEL'],'eventName':constants_4[_0x36b1d6(0x110)][_0x36b1d6(0xc3)],'data':{'userIds':_0x30cf8a[_0x36b1d6(0x9a)],'performerId':_0x30cf8a['performerId']}}),await _0x30cf8a['save'](),_0x30cf8a;}async[a362_0x5c7b66(0xc5)](_0x1be041){const _0x2c22fc=a362_0x5c7b66,_0xbe2574=await this['blockSettingModel'][_0x2c22fc(0xfe)]({'performerId':_0x1be041});if(!_0xbe2574){const _0x49ec32=await this[_0x2c22fc(0xeb)][_0x2c22fc(0xf1)]({'performerId':_0x1be041,'userIds':[],'createdAt':new Date(),'updatedAt':new Date(),'countries':[]});return _0x49ec32;}const _0x5bcd01=_0xbe2574[_0x2c22fc(0x9a)]['length']?await this[_0x2c22fc(0xbf)][_0x2c22fc(0xae)](_0xbe2574[_0x2c22fc(0x9a)]):[],_0x122111=new dtos_2[(_0x2c22fc(0xed))](_0xbe2574);return _0x122111[_0x2c22fc(0x128)]=_0x5bcd01?_0x5bcd01[_0x2c22fc(0xbc)](_0x1d0b88=>_0x1d0b88['_id']&&_0x1d0b88[_0x2c22fc(0x120)](![])):null,_0x122111;}async[a362_0x5c7b66(0x139)](_0x1335fe,_0x7477e3,_0x286ea9){const _0x3bdf4d=a362_0x5c7b66;let _0x32ad7d=![];const _0x1b092b=await this[_0x3bdf4d(0xeb)][_0x3bdf4d(0xfe)]({'performerId':_0x1335fe});_0x7477e3&&_0x1b092b&&(_0x32ad7d=await this[_0x3bdf4d(0xc1)](_0x1b092b,_0x7477e3));let _0x28c41f=![];_0x286ea9&&_0x1b092b&&(_0x28c41f=await this['checkBlockedByPerformer'](_0x1b092b,_0x286ea9[_0x3bdf4d(0x108)]));const _0x4fb30b=!!(_0x28c41f||_0x32ad7d);return{'blocked':_0x4fb30b};}async[a362_0x5c7b66(0x9b)](_0x256c32,_0x516c3b){const _0x127a94=a362_0x5c7b66;return this['performerModel'][_0x127a94(0xd0)]({'_id':_0x256c32},{'$set':{'streamingTitle':_0x516c3b}});}async[a362_0x5c7b66(0x106)](_0x19babb,_0x41d93f){const _0x1701ad=a362_0x5c7b66,_0x286e6a={'channel':constants_2[_0x1701ad(0x13b)],'eventName':constant_1[_0x1701ad(0x115)],'data':{'id':_0x19babb}};return await this[_0x1701ad(0xfd)][_0x1701ad(0x140)](_0x286e6a),this[_0x1701ad(0xe4)][_0x1701ad(0xd0)]({'_id':_0x19babb},{'$set':{'lastStreamingTime':new Date(),'live':![],'streamingStatus':constant_1[_0x1701ad(0x115)]},'$inc':{'stats.totalStreamTime':_0x41d93f}});}async[a362_0x5c7b66(0x10e)](_0x60f39c){const _0x29f961=a362_0x5c7b66,_0x484889=await this[_0x29f961(0xd5)](_0x60f39c);if(!_0x484889)return;await this[_0x29f961(0xe4)]['updateOne']({'_id':_0x60f39c},{'$set':{'isOnline':![],'streamingStatus':constant_1['OFFLINE'],'onlineAt':null,'offlineAt':new Date()}}),await this['socketUserService'][_0x29f961(0xe0)]('modelUpdateStatus',{'id':_0x60f39c,'performer':new dtos_2['PerformerDto'](Object[_0x29f961(0x149)](Object['assign']({},_0x484889),{'streamingStatus':constant_1[_0x29f961(0x115)]}))[_0x29f961(0x141)](),'status':constants_3[_0x29f961(0x14a)][_0x29f961(0xd9)]});}async[a362_0x5c7b66(0x129)](_0x58264a){const _0x5b8166=a362_0x5c7b66;return this[_0x5b8166(0xe4)][_0x5b8166(0xd0)]({'_id':_0x58264a},{'status':constants_1[_0x5b8166(0x117)][_0x5b8166(0x11e)],'emailVerified':!![]},{'new':!![]});}async[a362_0x5c7b66(0xe1)](_0x56611c,_0x41511b){const _0x485779=a362_0x5c7b66;return this[_0x485779(0xe4)][_0x485779(0xd0)]({'_id':_0x56611c},{'$inc':{'balance':_0x41511b,'stats.totalTokenEarned':_0x41511b>0x0?_0x41511b:0x0,'stats.totalTokenSpent':_0x41511b<=0x0?_0x41511b:0x0}});}async['updateStats'](_0x489643,_0x56fe80){return this['performerModel']['updateOne']({'_id':_0x489643},{'$inc':_0x56fe80});}async[a362_0x5c7b66(0x109)](_0x164145){const _0x1a2213=a362_0x5c7b66;return this[_0x1a2213(0xe4)][_0x1a2213(0xd0)]({'_id':_0x164145},{'$set':{'live':!![]}});}async[a362_0x5c7b66(0x143)](_0x34f5b9,_0x288339){const _0x28f4ec=a362_0x5c7b66,_0x3ffec3=await this['performerModel'][_0x28f4ec(0xfe)]({'_id':_0x34f5b9});if(!_0x3ffec3)return;if(_0x288339===_0x3ffec3[_0x28f4ec(0xf5)])return;const _0x24d02d={'channel':constants_2['PERFORMER_STEAMING_STATUS_CHANNEL'],'eventName':_0x288339,'data':{'id':_0x34f5b9,'oldStreamingStatus':_0x3ffec3[_0x28f4ec(0xf5)]}};await this[_0x28f4ec(0xfd)][_0x28f4ec(0x140)](_0x24d02d),await this[_0x28f4ec(0xe4)]['updateOne']({'_id':string_helper_1['toObjectId'](_0x34f5b9)},{'$set':{'streamingStatus':_0x288339}});}async[a362_0x5c7b66(0xb1)](_0x215906,_0x1ab108){const _0x370c38=a362_0x5c7b66,_0x4cdc1f=await this[_0x370c38(0xe4)][_0x370c38(0xd5)](_0x215906);if(!_0x4cdc1f){await this[_0x370c38(0xf4)][_0x370c38(0xc0)](_0x1ab108[_0x370c38(0x108)]);throw new kernel_1[(_0x370c38(0x146))]();}const {avatarId:_0x13989d}=_0x4cdc1f;return await this['performerModel'][_0x370c38(0xd0)]({'_id':_0x215906},{'avatarId':_0x1ab108['_id'],'avatarPath':_0x1ab108[_0x370c38(0x13a)]}),_0x13989d!==_0x1ab108['_id']&&await this[_0x370c38(0xf4)][_0x370c38(0xc0)](_0x13989d),_0x1ab108;}async[a362_0x5c7b66(0x10f)](_0x682490,_0x5b911b){const _0x2541a5=a362_0x5c7b66;return this[_0x2541a5(0xe4)]['updateOne']({'_id':_0x682490},{'$set':{'privateCallPrice':_0x5b911b[_0x2541a5(0xa6)],'groupCallPrice':_0x5b911b[_0x2541a5(0x114)]}});}async[a362_0x5c7b66(0x135)](_0x45154a,_0x5c4825){const _0x5c8f9d=a362_0x5c7b66;return this['performerModel'][_0x5c8f9d(0xd0)]({'_id':_0x45154a},_0x5c4825);}async['selfSuspendAccount'](_0x16c239,_0xe89bdf){const _0x2f412e=a362_0x5c7b66;if(_0x16c239['toString']()!==_0xe89bdf[_0x2f412e(0x108)][_0x2f412e(0xc8)]())throw new common_1[(_0x2f412e(0xde))]();return await this['performerModel'][_0x2f412e(0xd0)]({'_id':_0x16c239},{'status':constants_4['PERFORMER_STATUSES'][_0x2f412e(0xa7)]}),{'success':!![]};}async[a362_0x5c7b66(0xaa)](){const _0x67e806=a362_0x5c7b66,[_0x4c34ba,_0x188beb,_0x29d76e,_0x147d8f,_0x6747d1,_0x1bdd28]=await Promise[_0x67e806(0x11c)]([this[_0x67e806(0xe4)][_0x67e806(0x107)]([{'$group':{'_id':null,'total':{'$sum':'$stats.totalVideos'}}}]),this[_0x67e806(0xe4)][_0x67e806(0x107)]([{'$group':{'_id':null,'total':{'$sum':'$stats.totalPhotos'}}}]),this[_0x67e806(0xe4)][_0x67e806(0x107)]([{'$group':{'_id':null,'total':{'$sum':_0x67e806(0xc4)}}}]),this['performerModel'][_0x67e806(0x107)]([{'$group':{'_id':null,'total':{'$sum':_0x67e806(0x14c)}}}]),this['performerModel'][_0x67e806(0x107)]([{'$group':{'_id':null,'total':{'$sum':'$stats.totalStreamTime'}}}]),this[_0x67e806(0xe4)][_0x67e806(0x107)]([{'$group':{'_id':null,'total':{'$sum':_0x67e806(0x99)}}}])]);return{'totalVideos':_0x4c34ba[_0x67e806(0xfc)]&&_0x4c34ba[0x0][_0x67e806(0x113)]||0x0,'totalPhotos':_0x188beb[_0x67e806(0xfc)]&&_0x188beb[0x0]['total']||0x0,'totalGalleries':_0x29d76e[_0x67e806(0xfc)]&&_0x29d76e[0x0][_0x67e806(0x113)]||0x0,'totalProducts':_0x147d8f[_0x67e806(0xfc)]&&_0x147d8f[0x0][_0x67e806(0x113)]||0x0,'totalStreamTime':_0x6747d1[_0x67e806(0xfc)]&&_0x6747d1[0x0]['total']||0x0,'totalTokenEarned':_0x1bdd28['length']&&_0x1bdd28[0x0][_0x67e806(0x113)]||0x0};}async[a362_0x5c7b66(0x12b)](_0x149eee){const _0x1ca681=a362_0x5c7b66,_0x420882=await this[_0x1ca681(0xe4)][_0x1ca681(0x107)]([{'$match':{'studioId':_0x149eee,'lastStreamingTime':{'$gt':moment()[_0x1ca681(0xf6)]({'hour':0x0,'minute':0x0})[_0x1ca681(0x137)]()}}},{'$group':{'_id':null,'total':{'$sum':0x1}}}]);return _0x420882[_0x1ca681(0xfc)]&&_0x420882[0x0][_0x1ca681(0x113)]||0x0;}async['totalHoursOnlineStat'](_0x1e4f60){const _0x1e1cba=a362_0x5c7b66,_0x1cb4fe=await this[_0x1e1cba(0xe4)]['aggregate']([{'$match':{'studioId':_0x1e4f60}},{'$group':{'_id':null,'total':{'$sum':_0x1e1cba(0xce)}}}]);return _0x1cb4fe[_0x1e1cba(0xfc)]&&_0x1cb4fe[0x0][_0x1e1cba(0x113)]||0x0;}async[a362_0x5c7b66(0xb5)](_0x216db8,_0x5983c8){const _0x2ecd25=a362_0x5c7b66,{query:_0xad5b60}=_0x216db8;if(!_0xad5b60[_0x2ecd25(0x10a)])return![];const _0x55ab10=await this[_0x2ecd25(0xf4)][_0x2ecd25(0xd5)](_0xad5b60[_0x2ecd25(0x10a)]);if(!_0x55ab10||!_0x55ab10['refItems']||!_0x55ab10[_0x2ecd25(0x123)][_0x2ecd25(0xfc)])return![];if(_0x5983c8['roles']&&_0x5983c8[_0x2ecd25(0xa5)][_0x2ecd25(0x124)](_0x2ecd25(0xa0)))return!![];const {itemId:_0x228ffa}=_0x55ab10[_0x2ecd25(0x123)][0x0];if(_0x5983c8[_0x2ecd25(0x108)]['toString']()!==_0x228ffa[_0x2ecd25(0xc8)]())return![];if(_0x55ab10[_0x2ecd25(0x11d)]&&['performer-document',_0x2ecd25(0x125),'performer-release-form'][_0x2ecd25(0x12e)](_0x55ab10['type'])!==-0x1)return!![];return![];}};PerformerService=__decorate([common_1[a362_0x5c7b66(0x11b)](),__param(0x0,common_1['Inject'](providers_1[a362_0x5c7b66(0xb6)])),__param(0x5,common_1[a362_0x5c7b66(0x10b)](providers_1[a362_0x5c7b66(0xa2)])),__param(0x6,common_1[a362_0x5c7b66(0x10b)](providers_1[a362_0x5c7b66(0x144)])),__param(0x7,common_1[a362_0x5c7b66(0x10b)](common_1[a362_0x5c7b66(0xb3)](()=>services_1[a362_0x5c7b66(0xc9)]))),__param(0x8,common_1['Inject'](common_1['forwardRef'](()=>index_1['PerformerCommissionService']))),__metadata(a362_0x5c7b66(0x112),[mongoose_1['Model'],services_2[a362_0x5c7b66(0xf9)],kernel_1[a362_0x5c7b66(0xd7)],category_service_1[a362_0x5c7b66(0xc6)],socket_user_service_1[a362_0x5c7b66(0x14f)],mongoose_1[a362_0x5c7b66(0x96)],mongoose_1['Model'],services_1[a362_0x5c7b66(0xc9)],index_1[a362_0x5c7b66(0x121)]])],PerformerService),exports['PerformerService']=PerformerService;