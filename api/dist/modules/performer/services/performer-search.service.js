'use strict';const a361_0x556e=['getOwnPropertyDescriptor','167843ixlGTR','categoryIds','PerformerDto','StudioService','toString','status','searchByKeyword','PERFORMER_BLOCK_SETTING_MODEL_PROVIDER','category','find','FavouriteService','performerId','findByIds','../constants','PERFORMER_STATUSES','Model','map','Injectable','../dtos','1894HCONTQ','length','Inject','studioId','isOnline','tags','894fNkjUo','17gdvUtk','gender','admin','push','assign','limit','toLowerCase','__decorate','PERFORMER_MODEL_PROVIDER','decorate','object','$or','__metadata','__param','sortBy','offset','_id','toResponse','@nestjs/common','PENDING','310yubTvn','mongoose','9359FDonSu','replace','function','12157ZXKdPo','skip','country','sort','excludedId','blockSettingModel','toSearchResponse','performerModel','includes','97IytJOU','269415nWPxzC','countDocuments','mongodb','$and','17RoWOOE','ObjectId','346fxvrRt','metadata','roles','PerformerSearchService','favoriteService','search','favoriteId','lean','studio','defineProperty','all','studioService'];const a361_0x5dc738=a361_0x55b0;(function(_0x27912b,_0x160ff3){const _0x586bf5=a361_0x55b0;while(!![]){try{const _0x4b563d=parseInt(_0x586bf5(0x225))+parseInt(_0x586bf5(0x229))*parseInt(_0x586bf5(0x218))+parseInt(_0x586bf5(0x1fb))*-parseInt(_0x586bf5(0x224))+-parseInt(_0x586bf5(0x216))+parseInt(_0x586bf5(0x22b))*parseInt(_0x586bf5(0x201))+-parseInt(_0x586bf5(0x21b))*parseInt(_0x586bf5(0x202))+-parseInt(_0x586bf5(0x1e8));if(_0x4b563d===_0x160ff3)break;else _0x27912b['push'](_0x27912b['shift']());}catch(_0x8fd459){_0x27912b['push'](_0x27912b['shift']());}}}(a361_0x556e,0x2bc66));var __decorate=this&&this[a361_0x5dc738(0x209)]||function(_0x50658f,_0x39a7d8,_0x38596a,_0x591e0e){const _0x2b52d1=a361_0x5dc738;var _0x257e12=arguments[_0x2b52d1(0x1fc)],_0x54084b=_0x257e12<0x3?_0x39a7d8:_0x591e0e===null?_0x591e0e=Object[_0x2b52d1(0x1e7)](_0x39a7d8,_0x38596a):_0x591e0e,_0x59c971;if(typeof Reflect===_0x2b52d1(0x20c)&&typeof Reflect['decorate']==='function')_0x54084b=Reflect[_0x2b52d1(0x20b)](_0x50658f,_0x39a7d8,_0x38596a,_0x591e0e);else{for(var _0x341a68=_0x50658f['length']-0x1;_0x341a68>=0x0;_0x341a68--)if(_0x59c971=_0x50658f[_0x341a68])_0x54084b=(_0x257e12<0x3?_0x59c971(_0x54084b):_0x257e12>0x3?_0x59c971(_0x39a7d8,_0x38596a,_0x54084b):_0x59c971(_0x39a7d8,_0x38596a))||_0x54084b;}return _0x257e12>0x3&&_0x54084b&&Object[_0x2b52d1(0x1e4)](_0x39a7d8,_0x38596a,_0x54084b),_0x54084b;},__metadata=this&&this[a361_0x5dc738(0x20e)]||function(_0x229d01,_0x3a280d){const _0x4b4170=a361_0x5dc738;if(typeof Reflect==='object'&&typeof Reflect[_0x4b4170(0x1dc)]===_0x4b4170(0x21a))return Reflect[_0x4b4170(0x1dc)](_0x229d01,_0x3a280d);},__param=this&&this[a361_0x5dc738(0x20f)]||function(_0x297a9e,_0x133d3b){return function(_0x52fc4e,_0x404428){_0x133d3b(_0x52fc4e,_0x404428,_0x297a9e);};};Object[a361_0x5dc738(0x1e4)](exports,'__esModule',{'value':!![]}),exports['PerformerSearchService']=void 0x0;function a361_0x55b0(_0x35d3c3,_0x5d02dc){return a361_0x55b0=function(_0x556e4b,_0x55b084){_0x556e4b=_0x556e4b-0x1dc;let _0x43476c=a361_0x556e[_0x556e4b];return _0x43476c;},a361_0x55b0(_0x35d3c3,_0x5d02dc);}const common_1=require(a361_0x5dc738(0x214)),mongoose_1=require(a361_0x5dc738(0x217)),common_2=require('../../../kernel/common'),mongodb_1=require(a361_0x5dc738(0x227)),services_1=require('../../favourite/services'),dtos_1=require('../../user/dtos'),services_2=require('../../studio/services'),dtos_2=require(a361_0x5dc738(0x1fa)),providers_1=require('../providers'),constants_1=require(a361_0x5dc738(0x1f5));let PerformerSearchService=class PerformerSearchService{constructor(_0x220fe1,_0x787fa2,_0x4d1445,_0x208e36){const _0x8f8ec1=a361_0x5dc738;this[_0x8f8ec1(0x222)]=_0x220fe1,this[_0x8f8ec1(0x1df)]=_0x787fa2,this['blockSettingModel']=_0x4d1445,this[_0x8f8ec1(0x1e6)]=_0x208e36;}async[a361_0x5dc738(0x1e0)](_0x121da6,_0x119eac){const _0x12a717=a361_0x5dc738,_0x157a52={};if(_0x121da6['q']){const _0x48bfea=new RegExp(_0x121da6['q'][_0x12a717(0x208)]()[_0x12a717(0x219)](/[^a-zA-Z0-9]/g,''),'i');!_0x157a52['$and']&&(_0x157a52[_0x12a717(0x228)]=[]),_0x157a52['$and'][_0x12a717(0x205)]({'$or':[{'name':{'$regex':_0x48bfea}},{'username':{'$regex':_0x48bfea}},{'email':{'$regex':_0x48bfea}}]});}_0x121da6[_0x12a717(0x1ed)]&&(_0x121da6[_0x12a717(0x1ed)]===constants_1[_0x12a717(0x1f6)][_0x12a717(0x215)]?(!_0x157a52['$and']&&(_0x157a52[_0x12a717(0x228)]=[]),_0x157a52[_0x12a717(0x228)][_0x12a717(0x205)]({'$or':[{'status':_0x121da6['status']},{'emailVerified':![]}]})):_0x157a52['status']=_0x121da6[_0x12a717(0x1ed)]);_0x121da6['gender']&&(_0x157a52[_0x12a717(0x203)]=_0x121da6[_0x12a717(0x203)]);_0x121da6['category']&&(_0x157a52[_0x12a717(0x1e9)]=new mongodb_1[(_0x12a717(0x22a))](_0x121da6[_0x12a717(0x1f0)]));_0x121da6[_0x12a717(0x21d)]&&(_0x157a52[_0x12a717(0x21d)]=_0x121da6[_0x12a717(0x21d)]);_0x121da6['tags']&&(_0x157a52['tags']=_0x121da6[_0x12a717(0x200)]);_0x121da6['studioId']&&(_0x157a52['studioId']=_0x121da6[_0x12a717(0x1fe)]);_0x121da6[_0x12a717(0x1ff)]&&(_0x157a52[_0x12a717(0x1ff)]=!![]);let _0x2747a5={};_0x121da6[_0x12a717(0x21e)]&&_0x121da6[_0x12a717(0x210)]&&(_0x2747a5={[_0x121da6[_0x12a717(0x210)]]:_0x121da6[_0x12a717(0x21e)]});const [_0x7e0bff,_0x511b8a]=await Promise['all']([this['performerModel'][_0x12a717(0x1f1)](_0x157a52)[_0x12a717(0x21e)](_0x2747a5)[_0x12a717(0x1e2)]()['limit'](parseInt(_0x121da6[_0x12a717(0x207)],0xa))[_0x12a717(0x21c)](parseInt(_0x121da6[_0x12a717(0x211)],0xa)),this[_0x12a717(0x222)][_0x12a717(0x226)](_0x157a52)]),_0x396a84=_0x119eac&&_0x119eac[_0x12a717(0x1dd)]&&(_0x119eac[_0x12a717(0x1dd)]['includes'](_0x12a717(0x204))||_0x119eac[_0x12a717(0x1dd)][_0x12a717(0x223)](_0x12a717(0x1e3))),_0x220f5e=_0x7e0bff[_0x12a717(0x1f8)](_0x476d1e=>_0x476d1e[_0x12a717(0x212)]),_0x9b05bc=_0x7e0bff[_0x12a717(0x1f8)](_0x37e1ce=>_0x37e1ce[_0x12a717(0x1fe)]),[_0x14b38b,_0x2707eb]=await Promise[_0x12a717(0x1e5)]([_0x9b05bc['length']?this['studioService'][_0x12a717(0x1f4)](_0x9b05bc):[],_0x119eac&&_0x220f5e[_0x12a717(0x1fc)]?this[_0x12a717(0x1df)][_0x12a717(0x1f1)]({'favoriteId':{'$in':_0x220f5e},'ownerId':_0x119eac[_0x12a717(0x212)]}):[]]),_0x4b9bcc=_0x7e0bff['map'](_0x1870e5=>{const _0x45e500=_0x12a717,_0x51a144=_0x2707eb['find'](_0x12ca3b=>_0x12ca3b[_0x45e500(0x1e1)][_0x45e500(0x1ec)]()===_0x1870e5[_0x45e500(0x212)][_0x45e500(0x1ec)]()),_0x23cbf6=_0x14b38b[_0x45e500(0x1f1)](_0x4fdd64=>_0x1870e5[_0x45e500(0x1fe)]&&_0x4fdd64[_0x45e500(0x212)]['toString']()===_0x1870e5['studioId'][_0x45e500(0x1ec)]());return Object['assign'](Object['assign']({},_0x1870e5),{'studio':_0x23cbf6&&_0x23cbf6[_0x45e500(0x213)](),'isFavorite':!!_0x51a144});});return{'total':_0x511b8a,'data':_0x4b9bcc[_0x12a717(0x1f8)](_0x16575a=>new dtos_2['PerformerDto'](_0x16575a)[_0x12a717(0x213)](_0x396a84))};}async['advancedSearch'](_0x1c0a2c,_0x5af562,_0x45100d){const _0x357c50=a361_0x5dc738;var _0x37b480;const _0x2699ac={},_0x49247f=(_0x37b480=_0x5af562===null||_0x5af562===void 0x0?void 0x0:_0x5af562[_0x357c50(0x1dd)])===null||_0x37b480===void 0x0?void 0x0:_0x37b480[_0x357c50(0x223)](_0x357c50(0x204));if(_0x1c0a2c['q']){!_0x2699ac[_0x357c50(0x228)]&&(_0x2699ac['$and']=[]);const _0x5f24e6=[{'username':{'$regex':_0x1c0a2c['q'],'$options':'i'}}];_0x49247f&&_0x5f24e6[_0x357c50(0x205)]({'name':{'$regex':_0x1c0a2c['q'],'$options':'i'}},{'email':{'$regex':_0x1c0a2c['q'],'$options':'i'}}),_0x2699ac[_0x357c50(0x228)][_0x357c50(0x205)]({'$or':_0x5f24e6});}_0x1c0a2c[_0x357c50(0x1ed)]&&(_0x1c0a2c['status']===constants_1['PERFORMER_STATUSES']['PENDING']?(!_0x2699ac['$and']&&(_0x2699ac[_0x357c50(0x228)]=[]),_0x2699ac['$and'][_0x357c50(0x205)]({'$or':[{'status':_0x1c0a2c[_0x357c50(0x1ed)]},{'emailVerified':![]}]})):_0x2699ac[_0x357c50(0x1ed)]=_0x1c0a2c[_0x357c50(0x1ed)]);_0x1c0a2c[_0x357c50(0x203)]&&(_0x2699ac['gender']=_0x1c0a2c[_0x357c50(0x203)]);_0x1c0a2c[_0x357c50(0x1f0)]&&(_0x2699ac['categoryIds']=new mongodb_1['ObjectId'](_0x1c0a2c[_0x357c50(0x1f0)]));_0x1c0a2c['country']&&(_0x2699ac[_0x357c50(0x21d)]=_0x1c0a2c[_0x357c50(0x21d)]);_0x1c0a2c[_0x357c50(0x200)]&&(_0x2699ac[_0x357c50(0x200)]=_0x1c0a2c[_0x357c50(0x200)]);_0x1c0a2c[_0x357c50(0x21f)]&&(_0x2699ac[_0x357c50(0x212)]={'$ne':_0x1c0a2c[_0x357c50(0x21f)]});let _0x589507={'isOnline':-0x1,'stats.totalTokenEarned':-0x1,'onlineAt':-0x1,'createdAt':-0x1};_0x1c0a2c['sort']&&_0x1c0a2c[_0x357c50(0x210)]&&(_0x589507={[_0x1c0a2c['sortBy']]:_0x1c0a2c[_0x357c50(0x21e)],'isOnline':-0x1,'onlineAt':-0x1,'balance':-0x1});const [_0x4fa4ff,_0x38f368]=await Promise['all']([this[_0x357c50(0x222)][_0x357c50(0x1f1)](_0x2699ac)[_0x357c50(0x1e2)]()[_0x357c50(0x21e)](_0x589507)[_0x357c50(0x207)](parseInt(_0x1c0a2c[_0x357c50(0x207)],0xa))[_0x357c50(0x21c)](parseInt(_0x1c0a2c[_0x357c50(0x211)],0xa)),this[_0x357c50(0x222)][_0x357c50(0x226)](_0x2699ac)]),_0x4095d5=_0x4fa4ff['map'](_0x42e7d2=>_0x42e7d2[_0x357c50(0x212)]),[_0x405166,_0x52af7c]=await Promise[_0x357c50(0x1e5)]([_0x5af562?this[_0x357c50(0x1df)][_0x357c50(0x1f1)]({'favoriteId':{'$in':_0x4095d5},'ownerId':_0x5af562[_0x357c50(0x212)]}):[],_0x5af562?this[_0x357c50(0x220)]['find']({'performerId':{'$in':_0x4095d5},'$or':[{'userIds':{'$in':[_0x5af562[_0x357c50(0x212)]]}},{'countries':{'$in':[_0x45100d]}}]}):this[_0x357c50(0x220)][_0x357c50(0x1f1)]({'performerId':{'$in':_0x4095d5},'countries':{'$in':[_0x45100d]}})]),_0x2a71d2=_0x4fa4ff['map'](_0xf7cdcd=>{const _0x28738b=_0x357c50,_0x54de41=_0x405166[_0x28738b(0x1fc)]&&_0x405166[_0x28738b(0x1f1)](_0x10cc92=>_0x10cc92[_0x28738b(0x1e1)]['toString']()===_0xf7cdcd[_0x28738b(0x212)]['toString']()),_0x367a29=_0x52af7c[_0x28738b(0x1fc)]&&_0x52af7c[_0x28738b(0x1f1)](_0x12abf4=>_0x12abf4[_0x28738b(0x1f3)][_0x28738b(0x1ec)]()===_0xf7cdcd[_0x28738b(0x212)][_0x28738b(0x1ec)]());return Object[_0x28738b(0x206)](Object['assign']({},_0xf7cdcd),{'isFavorite':!!_0x54de41,'isBlocked':!!_0x367a29});});return{'total':_0x38f368,'data':_0x2a71d2[_0x357c50(0x1f8)](_0x49eae6=>new dtos_2[(_0x357c50(0x1ea))](_0x49eae6)[_0x357c50(0x221)]())};}async[a361_0x5dc738(0x1ee)](_0x5ee0cd){const _0x2e753d=a361_0x5dc738,_0x523b22={};if(_0x5ee0cd['q']){const _0xe4c4cc=new RegExp(_0x5ee0cd['q'][_0x2e753d(0x208)]()[_0x2e753d(0x219)](/[^a-zA-Z0-9]/g,''),'i');_0x523b22[_0x2e753d(0x20d)]=[{'name':{'$regex':_0xe4c4cc}},{'username':{'$regex':_0xe4c4cc}},{'email':{'$regex':_0xe4c4cc}}];}const _0x4d9300=await this[_0x2e753d(0x222)]['find'](_0x523b22)[_0x2e753d(0x1e2)]();return _0x4d9300;}async['randomSelect'](_0x5a3c06){const _0x57269c=await this['performerModel']['aggregate']([{'$match':{'status':'active'}},{'$sample':{'size':_0x5a3c06}},{'$sort':{'isOnline':-0x1,'onlineAt':-0x1,'balance':-0x1}}]);return{'data':_0x57269c['map'](_0x103cb4=>new dtos_2['PerformerDto'](_0x103cb4)['toSearchResponse']()),'total':_0x57269c['length']};}};PerformerSearchService=__decorate([common_1[a361_0x5dc738(0x1f9)](),__param(0x0,common_1[a361_0x5dc738(0x1fd)](providers_1[a361_0x5dc738(0x20a)])),__param(0x2,common_1['Inject'](providers_1[a361_0x5dc738(0x1ef)])),__metadata('design:paramtypes',[mongoose_1[a361_0x5dc738(0x1f7)],services_1[a361_0x5dc738(0x1f2)],mongoose_1['Model'],services_2[a361_0x5dc738(0x1eb)]])],PerformerSearchService),exports[a361_0x5dc738(0x1de)]=PerformerSearchService;